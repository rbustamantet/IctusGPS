<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<title>ACO Manager</title>
<meta name="theme-color" content="#0f3d83">

<!-- ICONOS -->
<link rel="icon" type="image/png" sizes="192x192" href="../iconos/ictusgps.png">
<link rel="apple-touch-icon" sizes="180x180" href="../iconos/ictusgps.png">

<!-- CSS GLOBAL + CSS ESPEC√çFICO -->
<link rel="stylesheet" href="../css/ictusgps.css">
<link rel="stylesheet" href="../css/switching.css">

</head>

<body>

<!-- ==========================================================
     SAFE TOP INSTITUCIONAL
========================================================== -->
<div class="safe-top">
  <div class="safe-content">
    <div class="safe-left">
      <img src="../iconos/utilidadesico.png" class="safe-mini" alt="">
      <img src="../img/topbar.png" class="safe-logo" alt="Ictus GPS">
    </div>

    <div class="safe-actions">
      <a href="javascript:history.back()" class="safe-btn" title="Volver">
        <img src="../iconos/atrastransparente.png" class="safe-icon" alt="">
      </a>

      <a href="../index.html" class="safe-btn" title="Inicio">
        <img src="../iconos/hometransparente.png" class="safe-icon" alt="">
      </a>
    </div>
  </div>
</div>

<!-- ==========================================================
     HEADER PRINCIPAL
========================================================== -->
<header>
  <div class="title">
    <img src="../iconos/anticoagulacionico.png" alt="">
    ACO Manager
  </div>
</header>

<!-- ==========================================================
     CONTENIDO PRINCIPAL
========================================================== -->
<main class="wrap">
<form id="formSwitching">

  <!-- INTRODUCCI√ìN / DESCRIPCI√ìN -->
  <div class="howto" align="justify">
    Herramienta cl√≠nica avanzada para guiar el <b>cambio entre anticoagulantes</b>, el <b>ajuste por funci√≥n renal</b>, el manejo de <b>interacciones farmacol√≥gicas</b> y la planificaci√≥n de <b>pausas perioperatorias</b> o <b>punci√≥n lumbar</b>. Genera recomendaciones individualizadas y coherentes con el escenario cl√≠nico seleccionado.
  </div>


  <!-- ==========================================================
       SECCI√ìN 1 ‚Äì DATOS B√ÅSICOS DEL PACIENTE
  =========================================================== -->
  <div class="switch-section">

    <h3>üë§ Datos del paciente</h3>

    <div class="switch-grid">

      <div>
        <label class="switch-label">Edad</label>
        <input type="number" id="edad" class="switch-input" placeholder="a√±os">
      </div>

      <div>
        <label class="switch-label">Peso</label>
        <input type="number" id="peso" class="switch-input" placeholder="kg">
      </div>

      <div>
        <label class="switch-label">Sexo</label>
        <select id="sexo" class="switch-input">
          <option value="" disabled selected>Seleccione‚Ä¶</option>
          <option value="h">Hombre</option>
          <option value="m">Mujer</option>
        </select>
      </div>

      <div>
        <label class="switch-label">Creatinina</label>
        <input type="number" id="creat" class="switch-input" placeholder="mg/dL">
      </div>

    </div>
  </div>



  <!-- ==========================================================
       SECCI√ìN 2 ‚Äì ESCENARIO DE SWITCHING
  =========================================================== -->
  <div class="switch-section">

    <h3>üìç Escenario cl√≠nico</h3>

    <label class="switch-label"></label>
    <select id="escenario" class="switch-input">
      <option value="" disabled selected>Seleccione‚Ä¶</option>
      <option value="interaccion">Actitud ante interacci√≥n farmacol√≥gica</option>
      <option value="renal">Ajuste seg√∫n funci√≥n renal</option>
      <option value="acod_acod">Cambio de ACOD a ACOD</option>
      <option value="acod_vka">Cambio de ACOD a AVK</option>
      <option value="vka_acod">Cambio de AVK a ACOD</option>
      <option value="procedimiento">Pausa para Intervenci√≥n quir√∫rgica</option>
      <option value="puncion_lumbar">Pausa para Punci√≥n lumbar</option>
      <option value="sangrado">Reinicio tras sangrado</option>
    </select>

  </div>



  <!-- ==========================================================
       SECCI√ìN 3 ‚Äì MEDICACIONES IMPLICADAS
  =========================================================== -->
  <div class="switch-section">

    <h3>üíä Medicaci√≥n</h3>

    <div class="switch-grid">

      <div>
        <label class="switch-label">F√°rmaco actual</label>
        <select id="ac_actual" class="switch-input">
          <option value="" disabled selected>Seleccione‚Ä¶</option>
          <option value="apixaban">Apixab√°n</option>
          <option value="rivaroxaban">Rivaroxab√°n</option>
          <option value="dabigatran">Dabigatr√°n</option>
          <option value="edoxaban">Edoxab√°n</option>
          <option value="avk">Antivitamina K (AVK)</option>
        </select>
      </div>

      <div>
        <label class="switch-label">Nuevo f√°rmaco</label>
        <select id="ac_nuevo" class="switch-input">
          <option value="" disabled selected>Seleccione‚Ä¶</option>
          <option value="apixaban">Apixab√°n</option>
          <option value="rivaroxaban">Rivaroxab√°n</option>
          <option value="dabigatran">Dabigatr√°n</option>
          <option value="edoxaban">Edoxab√°n</option>
          <option value="avk">Antivitamina K (AVK)</option>
        </select>
      </div>

    </div>

  </div>


<!-- ==========================================================
     SECCI√ìN NUEVA ‚Äì INTERACCIONES (estilo FA)
========================================================== -->
<div class="switch-section">

  <h3>üîÄ Interacciones farmacol√≥gicas</h3>
  <p class="note">Seleccione uno o varios grupos seg√∫n los medicamentos del paciente.</p>

  <div class="switch-chips">

  <div class="switch-chip chip-dual" data-int="dual">
  üî¥ Inhibidor/inductor dual
  <span class="chip-info" data-info="dual">‚ÑπÔ∏è</span>
</div>

<div class="switch-chip chip-pgp" data-int="pgp">
  üü† Inhibidor potente de P-gp
  <span class="chip-info" data-info="pgp">‚ÑπÔ∏è</span>
</div>

<div class="switch-chip chip-cyp" data-int="cyp">
  üü° Inhibidor potente de CYP3A4
  <span class="chip-info" data-info="cyp">‚ÑπÔ∏è</span>
</div>

<div class="switch-chip chip-otros" data-int="otros">
  ‚ö™ Otros
  <span class="chip-info" data-info="otros">‚ÑπÔ∏è</span>
</div>


</div>


</div>


<!-- ==========================================================
     SECCI√ìN BOT√ìN CALCULAR
========================================================== -->
<div class="switch-section" style="text-align:center;">
  <button id="btnCalcular" type="button" class="boton-opcion boton-copy boton-full">
    Generar recomendaci√≥n
  </button>
</div>






  <!-- ==========================================================
       RESULTADO DEL SWITCHING
  =========================================================== -->
  <div class="switch-section switch-result" id="resultado">

    <p id="resultado-texto">
      <!-- Aqu√≠ insertar√° la l√≥gica JS -->
    </p>

    <div class="switch-actions">
<button id="btnCopiar" type="button" class="boton-opcion boton-copy">Copiar</button>
<button id="btnBorrar" type="button" class="boton-opcion boton-clear">Borrar</button>
    </div>

  </div>




  <!-- DISCLAIMER -->
  <section class="disclaimer-red">
    <p align="justify">
      <b>‚ö†Ô∏è Advertencia.</b> Esta herramienta es un <b>apoyo</b> a la decisi√≥n cl√≠nica; no sustituye el juicio profesional, la valoraci√≥n individual del paciente ni los
          <b>protocolos/gu√≠as locales actualizados</b>. Ante discrepancias, <b>prevalecen los protocolos vigentes</b> y el criterio del equipo responsable.
    </p>
  </section>

</form>
</main>



<!-- ==========================================================
     MODAL INSTITUCIONAL  
========================================================== -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <button class="modal-close" id="modal-cerrar">üîô</button>
    <h2 id="modal-titulo">Nota</h2>
    <div id="modal-contenido"></div>
  </div>
</div>



<!-- ==========================================================
     JS (Vac√≠o por ahora)
========================================================== -->

<script>


/* ==========================================================
   UTILIDADES B√ÅSICAS
========================================================== */

function calcClCr(edad, peso, creatinina, sexo){
  if(!edad || !peso || !creatinina) return null;

  let cl = ((140 - edad) * peso) / (72 * creatinina);
  if(sexo === "m") cl = cl * 0.85;

  return Math.round(cl);
}

function obtenerInteracciones() {
  const activos = document.querySelectorAll(".switch-chip.active");
  const lista = [];
  activos.forEach(ch => lista.push(ch.dataset.int));
  return lista;
}

/* ==========================================================
   M√ìDULOS CL√çNICOS
========================================================== */

function moduloRenal(datos){
  const cl = datos.clcr;
  if (cl === null || cl === undefined) return "";


  const esc = datos.escenario || "";
  const esProcedimiento =
    esc === "procedimiento" ||
    esc === "puncion_lumbar" ||
    esc === "sangrado";

  // <15     ‚Üí ACOD desaconsejado
  // 15‚Äì29   ‚Üí evitar dabigatr√°n; retrasos amplios
  // 30‚Äì49   ‚Üí retrasar 12‚Äì24 h
  // ‚â•50     ‚Üí funci√≥n renal aceptable

  if (cl < 15){
    return "Insuficiencia renal grave (ClCr < 15 mL/min) ‚Üí evitar ACOD; preferir AVK o heparina. Reinicio del ACOD no recomendado.";
  }

  if (cl < 30){
    if (esProcedimiento){
      return "ClCr 15‚Äì29 mL/min ‚Üí riesgo muy elevado de acumulaci√≥n del ACOD. No reiniciar antes de 24‚Äì48 h tras el procedimiento, aunque la t√©cnica permitir√≠a un reinicio m√°s precoz. Evitar dabigatr√°n.";
    } else {
      return "ClCr 15‚Äì29 mL/min ‚Üí retrasar el reinicio del ACOD 24‚Äì48 h. Evitar dabigatr√°n por riesgo de acumulaci√≥n.";
    }
  }

  if (cl < 50){
    if (esProcedimiento){
      return "ClCr 30‚Äì49 mL/min ‚Üí aclaramiento enlentecido del ACOD. No reiniciar antes de 12‚Äì24 h, aunque el procedimiento permita reinicio m√°s precoz.";
    } else {
      return "ClCr 30‚Äì49 mL/min ‚Üí retrasar el reinicio del ACOD 12‚Äì24 h por aclaramiento reducido.";
    }
  }

  return "Funci√≥n renal adecuada (ClCr ‚â• 50 mL/min) ‚Üí reinicio est√°ndar seg√∫n procedimiento/escenario.";
}


function moduloInteracciones(datos){
  const ints = datos.interacciones || [];
  if (!ints.length) return "";

  const esc = datos.escenario || "";
  const esProcedimiento = (esc === "procedimiento" || esc === "puncion_lumbar" || esc === "sangrado");

  const rec = [];

  if (ints.includes("dual")) {
    rec.push(
      esProcedimiento
        ? "Interacci√≥n dual potente (CYP3A4 + P-gp) ‚Üí evitar ACOD. Si el f√°rmaco no puede suspenderse, preferir AVK. En contexto de procedimiento, no reiniciar ACOD antes de 24‚Äì48 h aunque el procedimiento permita reinicio m√°s precoz."
        : "Interacci√≥n dual potente (CYP3A4 + P-gp) ‚Üí evitar ACOD y preferir AVK mientras persista la interacci√≥n."
    );
  }

  if (ints.includes("pgp")) {
    rec.push(
      esProcedimiento
        ? "Inhibidor potente y selectivo de P-gp ‚Üí posible aumento de exposici√≥n a ACOD. En contexto de procedimiento, extremar prudencia en el reinicio y vigilancia hemorr√°gica."
        : "Inhibidor potente y selectivo de P-gp ‚Üí posible aumento de exposici√≥n a ACOD; extremar vigilancia hemorr√°gica."
    );
  }

  if (ints.includes("cyp")) {
    rec.push(
      esProcedimiento
        ? "Inhibidor potente y selectivo de CYP3A4 ‚Üí posible aumento de exposici√≥n (sobre todo apixab√°n/rivaroxab√°n). En contexto de procedimiento, extremar prudencia en el reinicio y vigilancia."
        : "Inhibidor potente y selectivo de CYP3A4 ‚Üí considerar preferir dabigatr√°n o edoxab√°n si es cl√≠nicamente apropiado y no hay contraindicaciones; si se mantiene apixab√°n/rivaroxab√°n, reforzar vigilancia."
    );
  }

  if (ints.includes("otros")) {
    rec.push(
      "F√°rmacos con sinergia hemorr√°gica (AINEs, AAS, DAPT, corticoides sist√©micos, ISRS/ISRN) ‚Üí no modifican niveles, pero aumentan riesgo de sangrado. Recomendar gastroprotecci√≥n y vigilancia."
    );
  }

  return rec.join("\n\n");
}



function moduloACODtoACOD(datos){
  if(datos.escenario !== "acod_acod") return "";

  const a = datos.acActual;
  const n = datos.acNuevo;

  if(!a || !n) return "";
  if(a === n)
    return "No existe cambio real de f√°rmaco (mismo ACOD).";

  if(a === "dabigatran" || n === "dabigatran"){
    return "Cambio que implica dabigatr√°n ‚Üí considerar funci√≥n renal. Reiniciar cuando toque la siguiente dosis; si ClCr < 50 mL/min, retrasar 12‚Äì24 h adicionales.";
  }

  return "Cambio ACOD ‚Üí ACOD: iniciar el nuevo anticoagulante cuando corresponda la siguiente dosis del ACOD previo.";
}

function moduloACOD_AVK(datos){
  const esc = datos.escenario;

  if(esc === "acod_vka"){
    return "ACOD ‚Üí AVK:\n‚Ä¢ Iniciar AVK en el momento de la siguiente dosis del ACOD.\n‚Ä¢ Mantener ambos hasta INR terap√©utico (2‚Äì3).\n‚Ä¢ Suspender ACOD cuando INR ‚â• 2 en 2 determinaciones.";
  }

  if(esc === "vka_acod"){
    return "AVK ‚Üí ACOD:\n‚Ä¢ Iniciar ACOD cuando INR < 2 (apixab√°n, dabigatr√°n, edoxab√°n) o < 3 (rivaroxab√°n).";
  }

  return "";
}

/* ==========================================================
   M√ìDULO ‚Äî ESCENARIO: INTERACCI√ìN FARMACOL√ìGICA
========================================================== */

function moduloInteraccionFarmacologica(datos){

  if (datos.escenario !== "interaccion") 
    return { texto: "", alertas: [] };

  const ac    = datos.acActual || "";
  const nuevo = datos.acNuevo || "";
  const cambio = (ac && nuevo && ac !== nuevo);
  const ints   = datos.interacciones || [];

  const hayPK = ints.some(t => t === "dual" || t === "pgp" || t === "cyp");

  const soloOtros = ints.length > 0 && !hayPK && ints.every(t => t === "otros");

  let txt = "Manejo de interacci√≥n farmacol√≥gica relevante" +
            (ac ? " (" + ac + ")" : "") + ":\n\n";

  txt += "‚Ä¢ Confirmar el f√°rmaco responsable de la interacci√≥n (inhibidor, inductor o f√°rmaco con sinergia hemorr√°gica).\n";

  if (hayPK){
    txt +=
      "‚Ä¢ Siempre que sea posible, retirar o sustituir el f√°rmaco que interacciona.\n" +
      "‚Ä¢ Mientras persista una interacci√≥n farmacocin√©tica relevante (inhibidor/inductor potente o moderado), evitar el uso de ACOD o valorar cambio a AVK/heparina en funci√≥n del riesgo tromb√≥tico.\n\n";
  } else if (soloOtros){
    txt +=
      "‚Ä¢ Los f√°rmacos del grupo \"Otros\" aumentan el riesgo hemorr√°gico pero no modifican los niveles del ACOD. No se recomienda suspender sistem√°ticamente el ACOD solo por este motivo; individualizar seg√∫n riesgo tromb√≥tico y hemorr√°gico.\n" +
      "‚Ä¢ Optimizar el tratamiento concomitante (evitar AINEs si es posible, ajustar dosis de AAS/antiagregantes) y reforzar las medidas de gastroprotecci√≥n y la vigilancia cl√≠nica.\n\n";
  } else {
    txt += "‚Ä¢ En ausencia de una interacci√≥n bien caracterizada, individualizar la decisi√≥n seg√∫n riesgo tromb√≥tico y hemorr√°gico.\n\n";
  }

  // Alertas para la caja final (solo PK; el grupo ‚ÄúOtros‚Äù ya queda cubierto por moduloInteracciones)
  const alertas = [];

if (ints.includes("dual")){
  alertas.push("Interacci√≥n dual potente ‚Üí evitar ACOD; preferir AVK mientras persista.");
}

if (ints.includes("pgp")){
  alertas.push("Inhibidor potente y selectivo de P-gp ‚Üí posible aumento de exposici√≥n; extremar vigilancia hemorr√°gica.");
}

if (ints.includes("cyp")){
  alertas.push("Inhibidor potente y selectivo de CYP3A4 ‚Üí considerar ACOD menos dependiente de CYP3A4 si es apropiado; reforzar vigilancia.");
}

  // Reinicio del ACOD
  txt += "Reinicio del ACOD:\n";

  if (ints.includes("dual")){
  txt += "‚Ä¢ Con interacci√≥n dual potente: evitar reinicio de ACOD; preferir AVK mientras persista.\n";
} else if (ints.includes("pgp")){
  txt += "‚Ä¢ Con inhibidor potente y selectivo de P-gp: no modificar sistem√°ticamente el intervalo; prudencia y vigilancia (m√°s efecto si coexiste deterioro renal).\n";
} else if (ints.includes("cyp")){
  txt += "‚Ä¢ Con inhibidor potente y selectivo de CYP3A4: no modificar sistem√°ticamente el intervalo; prudencia si apixab√°n/rivaroxab√°n.\n";
} else if (ints.includes("otros")){
  txt += "‚Ä¢ Con f√°rmacos del grupo \"Otros\" no se modifica el intervalo est√°ndar; reforzar gastroprotecci√≥n/vigilancia.\n";
} else {
  txt += "‚Ä¢ Sin interacci√≥n espec√≠fica, aplicar intervalo est√°ndar seg√∫n procedimiento y funci√≥n renal.\n";
}


  txt += "\n";

  if (cambio){
    txt +=
      "Cambio de anticoagulante:\n" +
      "‚Ä¢ El cambio (" + ac + " ‚Üí " + nuevo + ") debe realizarse una vez resuelta la interacci√≥n farmacol√≥gica y aplicados los intervalos de seguridad correspondientes.\n\n";
  }

  txt += "‚ÑπÔ∏è Nota: si existe discrepancia entre el intervalo recomendado por el procedimiento (punci√≥n lumbar, cirug√≠a‚Ä¶) y el derivado de la interacci√≥n o de la funci√≥n renal, debe aplicarse siempre el intervalo m√°s prolongado.";

  return { texto: txt, alertas };
}


function moduloPuncionLumbar(datos){
  if (datos.escenario !== "puncion_lumbar") return "";

  const f  = datos.acActual;
  const cl = datos.clcr;

  if (!f) return "Indique el anticoagulante actual para calcular la pausa adecuada.";

  if (f === "avk"){
    return `
Punci√≥n lumbar (AVK):
‚Ä¢ Requiere INR < 1.5 antes de la PL.
‚Ä¢ Suspender el AVK 3‚Äì5 d√≠as antes (seg√∫n TTR y dosis).
‚Ä¢ Evitar HBPM terap√©utica previa a la punci√≥n.
‚Ä¢ Reiniciar AVK el mismo d√≠a tras la PL si fue limpia.
`;
  }

  if (["apixaban","rivaroxaban","edoxaban"].includes(f)){
    return `
Punci√≥n lumbar (ACOD):
‚Ä¢ Suspender ${f} 24‚Äì48 h antes de la punci√≥n.
‚Ä¢ Usar 48 h si ‚â•2 factores: edad >80, bajo peso, anemia, o sangrado previo.
‚Ä¢ Reinicio: a las 6 h si punci√≥n limpia; 24 h si traum√°tica o dif√≠cil.
`;
  }

  if (f === "dabigatran"){
    if (!cl) return "Para dabigatr√°n es imprescindible disponer de ClCr.";

    if (cl >= 80){
      return `
Punci√≥n lumbar con dabigatr√°n:
‚Ä¢ Suspender 24 h antes.
‚Ä¢ Reiniciar a las 6 h si punci√≥n limpia; 24 h si traum√°tica.
`;
    }

    if (cl >= 50){
      return `
Punci√≥n lumbar con dabigatr√°n:
‚Ä¢ Suspender 48 h antes.
‚Ä¢ Reiniciar 6‚Äì24 h seg√∫n hemostasia.
`;
    }

    return `
Punci√≥n lumbar con dabigatr√°n (ClCr < 50 mL/min):
‚Ä¢ Suspender 72 h antes.
‚Ä¢ Reiniciar entre 12‚Äì24 h seg√∫n sangrado.
‚ö†Ô∏è Riesgo elevado de acumulaci√≥n.
`;
  }

  return "";
}


function moduloPausaPerioperatoria(datos){
  if(datos.escenario !== "procedimiento") return "";

  const f  = datos.acActual;
  const cl = datos.clcr;
  if(!f) return "";

  let pausa = "24‚Äì48 h";

  if(f === "dabigatran"){
    if(cl >= 80)      pausa = "24 h";
    else if(cl >= 50) pausa = "48 h";
    else              pausa = "72‚Äì96 h";
  }

  return "Pausa perioperatoria:\n‚Ä¢ Suspender " + f + " " + pausa + " antes del procedimiento.\n‚Ä¢ Reiniciar a las 24 h si hemostasia adecuada (48‚Äì72 h si alto riesgo hemorr√°gico).";
}

function moduloSangrado(datos){
  if(datos.escenario !== "sangrado") return "";

  return "Reinicio tras sangrado:\n‚Ä¢ Leve ‚Üí reinicio en 24‚Äì48 h.\n‚Ä¢ Moderado ‚Üí retrasar 48‚Äì72 h.\n‚Ä¢ Grave/cirug√≠a ‚Üí reinicio individualizado, habitualmente 3‚Äì7 d√≠as.";
}

/* ==========================================================
   MOTOR CL√çNICO INTEGRADO
========================================================== */

function motorSwitchingV2(datos){

  // üü° Escenarios NO switching
  if (datos.escenario === "puncion_lumbar") {
    return renderFinal({
      textoPrincipal: "Pausa para punci√≥n lumbar",
      recomendacion: moduloPuncionLumbar(datos),
      notas: []
    });
  }

  if (datos.escenario === "procedimiento") {
    return renderFinal({
      textoPrincipal: "Pausa perioperatoria",
      recomendacion: moduloPausaPerioperatoria(datos),
      notas: []
    });
  }

  if (datos.escenario === "sangrado") {
    return renderFinal({
      textoPrincipal: "Reinicio tras sangrado",
      recomendacion: moduloSangrado(datos),
      notas: []
    });
  }

  if (datos.escenario === "interaccion") {
    const r = moduloInteraccionFarmacologica(datos);
    return renderFinal({
      textoPrincipal: "Actitud ante interacci√≥n farmacol√≥gica",
      recomendacion: r.texto || "Seleccione al menos una interacci√≥n.",
      notas: []
    });
  }

  // üîµ Switching real
  const base = construirSwitchingBase(datos);
  if(base.bloqueado){
    return renderFinal(base);
  }

  const bloqueo = evaluarBloqueosSwitching(datos);
  if(bloqueo){
    return renderFinal(bloqueo);
  }

  const ajustado = aplicarModificadoresSwitching(base, datos);
  return renderFinal(ajustado);
}


function construirSwitchingBase(datos){
  const esc = datos.escenario;
  const a = datos.acActual;
  const n = datos.acNuevo;

  if(!esc) {
    return { bloqueado:true, texto:"Seleccione un escenario cl√≠nico." };
  }

if(esc === "acod_acod"){
  if(!a || !n){
    return { bloqueado:true, texto:"Seleccione f√°rmaco actual y nuevo f√°rmaco." };
  }
  if(a === n){
    return { bloqueado:true, texto:"No existe cambio real (mismo ACOD)." };
  }
  return {
    tipo: "acod_acod",
    textoPrincipal: `Cambiar ${nombreFarmaco(a)} ‚Üí ${nombreFarmaco(n)}`,
    recomendacion: "Iniciar el nuevo ACOD en el momento de la siguiente dosis del f√°rmaco previo.",
    horas: 0
  };
}


if (esc === "vka_acod"){
  if(!n){
    return { bloqueado:true, texto:"Seleccione el ACOD de destino." };
  }
  let umbralINR = "<2";
  if (n === "rivaroxaban") umbralINR = "<3";

  return {
    tipo: "vka_acod",
    textoPrincipal: `Cambiar AVK ‚Üí ${nombreFarmaco(n)}`,
    recomendacion:
      `Suspender AVK y controlar INR cada 24 horas. ` +
      `Iniciar ${nombreFarmaco(n)} cuando el INR sea ${umbralINR}.`
  };
}



if (esc === "acod_vka"){
  if(!a){
    return { bloqueado:true, texto:"Seleccione el ACOD actual." };
  }
  return {
    tipo: "acod_vka",
    textoPrincipal: `Cambiar ${nombreFarmaco(a)} ‚Üí AVK`,
    recomendacion:
      "Iniciar AVK en la siguiente dosis del ACOD y mantener ambos hasta alcanzar INR terap√©utico (2‚Äì3). " +
      "Controlar INR cada 24‚Äì48 horas durante el solapamiento. " +
      "Suspender el ACOD cuando INR ‚â•2 en dos determinaciones consecutivas."
  };
}



  return {
    bloqueado:true,
    texto:"Escenario no compatible con switching."
  };
}

function evaluarBloqueosSwitching(datos){
  const cl = datos.clcr;
  const ints = clasificarInteraccionesV2(datos.interacciones || []);

  // üî¥ BLOQUEO RENAL ABSOLUTO
if (cl !== null && cl < 15) {

  // Si el paciente YA est√° en AVK
if (datos.acActual === "avk") {
    return {
      bloqueado: true,
      textoPrincipal: "Mantener antivitamina K",
      recomendacion:
        "Insuficiencia renal grave (ClCr <15 mL/min). Los ACOD est√°n contraindicados. " +
        "Mantener tratamiento con AVK y realizar control estrecho de INR."
    };
  }

  // Si el paciente est√° en ACOD
  return {
    bloqueado: true,
    textoPrincipal: "ACOD no recomendado",
    recomendacion:
  "Insuficiencia renal grave (ClCr <15 mL/min). Suspender ACOD e iniciar antivitamina K. " +
  "Nota cl√≠nica: la necesidad de terapia puente hasta INR terap√©utico depende del riesgo tromboemb√≥lico. " +
  "En insuficiencia renal grave, si se precisa puente, suele preferirse heparina no fraccionada en entorno monitorizado; " +
  "evitar HBPM terap√©utica por riesgo de acumulaci√≥n."

  };
}


  // üî¥ BLOQUEO POR INTERACCI√ìN DUAL
  if (ints.dual){
    return {
      bloqueado: true,
      textoPrincipal: "ACOD no indicado",
      recomendacion:
        "Presencia de inhibidor o inductor dual potente. Evitar ACOD y utilizar antivitamina K mientras persista la interacci√≥n."
    };
  }

  // üî¥ Dabigatr√°n + ClCr <30
  if (datos.acNuevo === "dabigatran" && cl < 30){
    return {
      bloqueado: true,
      textoPrincipal: "Dabigatr√°n no indicado",
      recomendacion:
        "ClCr <30 mL/min. Suspender dabigatr√°n y utilizar alternativa (AVK o ACOD no dependiente de eliminaci√≥n renal)."
    };
  }

  return null;
}

function aplicarModificadoresSwitching(base, datos){
  let horasExtra = 0;
  const notas = [];

  const cl = datos.clcr;
  // üîµ Modificadores renales SOLO si el inicio depende del intervalo
if (
  cl !== null && cl !== undefined && cl < 50 &&
  !["acod_vka", "vka_acod"].includes(base.tipo)
) {
  notas.push(
    "Se recomienda retrasar el inicio una dosis adicional respecto al intervalo est√°ndar por funci√≥n renal reducida."
  );
}



  const ints = clasificarInteraccionesV2(datos.interacciones || []);

  if(ints.pgp){
    notas.push("Presencia de inhibidor selectivo de P-gp: extremar vigilancia hemorr√°gica.");
  }

  if(ints.cyp){
    notas.push(
      "Inhibidor potente de CYP3A4: considerar preferentemente dabigatr√°n o edoxab√°n si es cl√≠nicamente posible."
    );
  }

  return {
    ...base,
    horas: (base.horas || 0) + horasExtra,
    notas
  };
}

function renderFinal(res){
  if(res.bloqueado){
    return `
      <b>Recomendaci√≥n final:</b><br>
      <div style="margin-top:8px;"><b>${res.textoPrincipal || ""}</b></div>
      <div style="margin-top:8px;">${res.recomendacion || res.texto}</div>
    `;
  }

  return `
  <b>Recomendaci√≥n final:</b><br>
  <div style="margin-top:8px;"><b>${res.textoPrincipal}</b></div>
  <div style="margin-top:8px;">${res.recomendacion}</div>
  ${
    res.notas?.length
      ? `<div style="margin-top:6px; color:#374151;">${res.notas.join(" ")}</div>`
      : ""
  }
`;

}

/* ==========================================================
   RECOGER DATOS DEL FORMULARIO
========================================================== */

function recogerDatos(){

  const edad  = Number(document.getElementById("edad").value);
  const peso  = Number(document.getElementById("peso").value);
  const sexo  = document.getElementById("sexo").value;
  const creat = Number(document.getElementById("creat").value);

  const clcr = calcClCr(edad, peso, creat, sexo);

  return {
    edad,
    peso,
    sexo,
    creatinina: creat,
    clcr,
    acActual: document.getElementById("ac_actual").value,
    acNuevo:  document.getElementById("ac_nuevo").value,
    escenario:    document.getElementById("escenario").value,
    interacciones: obtenerInteracciones()
  };
}

/* ==========================================================
   ACTIVAR/DESACTIVAR CHIPS
========================================================== */

document.querySelectorAll(".switch-chip").forEach(chip => {
  chip.addEventListener("click", () => {
    chip.classList.toggle("active");
  });
});

/* ==========================================================
   CONTROL DE SELECTS SEG√öN ESCENARIO
========================================================== */

function actualizarSelectsPorEscenario() {
  const esc = document.getElementById("escenario").value;
  const selActual = document.getElementById("ac_actual");
  const selNuevo  = document.getElementById("ac_nuevo");

  const opcionesActual = selActual.querySelectorAll("option");
  const opcionesNuevo  = selNuevo.querySelectorAll("option");

  const esACOD = v => ["apixaban","rivaroxaban","dabigatran","edoxaban"].includes(v);
  const esAVK  = v => v === "avk";

  // Reset
  opcionesActual.forEach(o => { o.hidden = false; o.disabled = false; });
  opcionesNuevo.forEach(o  => { o.hidden = false; o.disabled = false; });

  // Escenarios sin switching
  if (
    esc === "renal" ||
    esc === "interaccion" ||
    esc === "puncion_lumbar" ||
    esc === "procedimiento" ||
    esc === "sangrado"
  ) {
    selNuevo.value = "";
    selNuevo.disabled = true;
    selNuevo.classList.add("disabled-select");
    return;
  }

  selNuevo.disabled = false;
  selNuevo.classList.remove("disabled-select");

  if (esc === "acod_acod") {
    opcionesActual.forEach(o => { if (o.value && !esACOD(o.value)) o.hidden = true; });
    opcionesNuevo.forEach(o  => { if (o.value && !esACOD(o.value)) o.hidden = true; });
  }

  if (esc === "acod_vka") {
    opcionesActual.forEach(o => { if (o.value && !esACOD(o.value)) o.hidden = true; });
    opcionesNuevo.forEach(o  => { if (o.value && !esAVK(o.value))  o.hidden = true; });
  }

  if (esc === "vka_acod") {
    opcionesActual.forEach(o => { if (o.value && !esAVK(o.value))  o.hidden = true; });
    opcionesNuevo.forEach(o  => { if (o.value && !esACOD(o.value)) o.hidden = true; });
  }
}

document
  .getElementById("escenario")
  .addEventListener("change", actualizarSelectsPorEscenario);

actualizarSelectsPorEscenario();

/* ==========================================================
   INFO-ICON ‚Üí ABRIR MODAL DE INTERACCIONES
========================================================== */

document.querySelectorAll(".chip-info").forEach(icon => {
  icon.addEventListener("click", (e) => {
    e.stopPropagation();

    const key  = icon.dataset.info;
    const info = infoInteracciones[key];
    if(!info) return;

    document.getElementById("modal-titulo").innerText  = info.titulo;
    document.getElementById("modal-contenido").innerHTML = info.html;

    document.getElementById("modal").style.display = "flex";
  });
});

document.getElementById("modal-cerrar").addEventListener("click", () => {
  document.getElementById("modal").style.display = "none";
});

document.getElementById("modal").addEventListener("click", (e) => {
  if(e.target === document.getElementById("modal")){
    document.getElementById("modal").style.display = "none";
  }
});

/* ==========================================================
   AJUSTE RENAL v2 ‚Äî MOTOR DE DOSIS FINAL (salida √∫nica)
   - Escenario: "renal"
   - Prioridad: bloqueantes (dual/inductor) ‚Üí AVK y FIN
   - Luego: dosis por ClCr + criterios f√°rmaco-espec√≠ficos
   - Luego: ajustes por interacciones no bloqueantes (si aplica)
========================================================== */

/** Devuelve el f√°rmaco a dosificar en escenario renal */
function getFarmacoObjetivoRenal(datos){
  // En "renal" normalmente interesa el f√°rmaco que se pretende mantener/usar.
  // Si el usuario ha puesto "Nuevo f√°rmaco", lo priorizamos; si no, usamos el actual.
  return datos.acNuevo || datos.acActual || "";
}

/** Clasifica interacciones presentes en categor√≠as v2 (con tus chips actuales) */
function clasificarInteraccionesV2(ints){
  const set = new Set(ints || []);
  return {
    dual: set.has("dual"),
    pgp: set.has("pgp"),
    cyp: set.has("cyp"),
    otros: set.has("otros")
  };
}


/** Traducci√≥n corta de f√°rmacos para texto final */
function nombreFarmaco(ac){
  const map = {
    apixaban: "Apixab√°n",
    rivaroxaban: "Rivaroxab√°n",
    dabigatran: "Dabigatr√°n",
    edoxaban: "Edoxab√°n",
    avk: "Antivitamina K (AVK)"
  };
  return map[ac] || ac || "";
}

/** Dosis renal base por f√°rmaco (FA no valvular) */
function dosisRenalBaseFA({ ac, clcr, edad, peso, creatinina_mgdl, sexo }){
  // Devuelve objeto: { ok, contraindicado, dosis, detalle }
  if(!ac) return { ok:false, contraindicado:false, dosis:"", detalle:"Seleccione el anticoagulante a ajustar." };
  if(!clcr && clcr !== 0) return { ok:false, contraindicado:false, dosis:"", detalle:"Para ajuste renal es imprescindible calcular ClCr (edad, peso, sexo y creatinina)." };

  // Bloqueo renal absoluto para ACOD
  if(clcr < 15){
    return {
      ok:true,
      contraindicado:true,
      dosis:"",
      detalle:"ClCr < 15 mL/min: ACOD no recomendado."
    };
  }

  // NOTA: aqu√≠ se implementan reglas habituales en Europa (SmPC/EMA) para FA NV.
  // Revisa y ajusta si deseas alinearlo con tu pol√≠tica local exacta.

  if(ac === "apixaban"){
    // Regla cl√°sica: 2 de 3 criterios (edad‚â•80, peso‚â§60, creat‚â•1.5) ‚Üí 2.5 mg/12h
    const c1 = (edad >= 80);
    const c2 = (peso > 0 && peso <= 60);
    const c3 = (creatinina_mgdl >= 1.5); // mg/dL
    const n = [c1,c2,c3].filter(Boolean).length;

    // Adem√°s, en deterioro renal severo (ClCr 15‚Äì29) suele preferirse 2.5 mg/12h
    const severo = (clcr >= 15 && clcr <= 29);

    if(severo || n >= 2){
      return {
        ok:true,
        contraindicado:false,
        dosis:"2,5 mg cada 12 h",
        detalle: severo
          ? "ClCr 15‚Äì29 mL/min: preferible dosis reducida."
          : "Cumple ‚â•2 criterios (edad ‚â•80, peso ‚â§60, creatinina ‚â•1,5 mg/dL)."
      };
    }

    return {
      ok:true,
      contraindicado:false,
      dosis:"5 mg cada 12 h",
      detalle:"Dosis est√°ndar (no cumple criterios de reducci√≥n)."
    };
  }

  if(ac === "rivaroxaban"){
    // FA NV: 20 mg/24h si ClCr ‚â•50; 15 mg/24h si ClCr 15‚Äì49; evitar <15
    if(clcr >= 50){
      return { ok:true, contraindicado:false, dosis:"20 mg cada 24 h (con comida)", detalle:"ClCr ‚â• 50 mL/min." };
    }
    // 15‚Äì49
    return { ok:true, contraindicado:false, dosis:"15 mg cada 24 h (con comida)", detalle:"ClCr 15‚Äì49 mL/min: dosis reducida." };
  }

  if(ac === "edoxaban"){
    // FA NV: 60 mg/24h; reducir a 30 mg/24h si ClCr 15‚Äì50 o peso‚â§60 o inhibidor P-gp relevante
    // Aqu√≠ hacemos base por renal (15‚Äì50 ‚Üí 30).
    if(clcr >= 51){
      return { ok:true, contraindicado:false, dosis:"60 mg cada 24 h", detalle:"ClCr > 50 mL/min (base renal)." };
    }
    // 15‚Äì50
    return { ok:true, contraindicado:false, dosis:"30 mg cada 24 h", detalle:"ClCr 15‚Äì50 mL/min: dosis reducida." };
  }

  if(ac === "dabigatran"){
    // En Europa: generalmente contraindicado si ClCr <30 (FA NV).
    if(clcr < 30){
      return {
        ok:true,
        contraindicado:true,
        dosis:"",
        detalle:"ClCr < 30 mL/min: dabigatr√°n no recomendado (riesgo de acumulaci√≥n)."
      };
    }

    // Dosis habitual: 150 mg/12h; 110 mg/12h si ‚â•80 a√±os o mayor riesgo hemorr√°gico.
    // Como este m√≥dulo es renal, aplicamos 110 mg/12h en ‚â•80 como regla pr√°ctica (puedes ajustar).
    if(edad >= 80){
      return { ok:true, contraindicado:false, dosis:"110 mg cada 12 h", detalle:"Edad ‚â•80 a√±os: preferible dosis reducida." };
    }

    // 30‚Äì49: muchos protocolos prefieren 110 mg/12h si riesgo; aqu√≠ NO asumimos riesgo hemorr√°gico.
    // Para no inventar, mantenemos 150 mg/12h y dejamos nota si 30‚Äì49 (zona ‚Äúcautela‚Äù).
    if(clcr < 50){
      return { ok:true, contraindicado:false, dosis:"150 mg cada 12 h", detalle:"ClCr 30‚Äì49 mL/min: precauci√≥n; considerar 110 mg/12 h si alto riesgo hemorr√°gico." };
    }

    return { ok:true, contraindicado:false, dosis:"150 mg cada 12 h", detalle:"Dosis est√°ndar." };
  }

  // Si el usuario selecciona AVK en renal, devolvemos plan simple
  if(ac === "avk"){
    return {
      ok:true,
      contraindicado:false,
      dosis:"AVK (ajustar por INR, objetivo 2‚Äì3)",
      detalle:"La funci√≥n renal no limita el uso de AVK; ajustar por INR."
    };
  }

  return { ok:false, contraindicado:false, dosis:"", detalle:"F√°rmaco no reconocido para ajuste." };
}

/** Ajustes por interacciones (v2 con chips actuales) ‚Äî devuelven dosis final o bloqueo */
function aplicarInteraccionesRenalV2({ ac, base, inter }){

  // Si ya est√° contraindicado por funci√≥n renal, no tocar
  if (base.contraindicado) return base;

  // üî¥ BLOQUEO ABSOLUTO: inhibidor o inductor dual
  if (inter.dual){
    return {
      contraindicado: true,
      dosis: "",
      detalle: "Presencia de inhibidor o inductor dual potente (CYP3A4 + P-gp): ACOD no indicado."
    };
  }

// üü† Inhibidor potente y selectivo de P-gp
if (inter.pgp){

  // Edoxab√°n: reducci√≥n obligada
  if (ac === "edoxaban"){
    return {
      ...base,
      dosis: "30 mg cada 24 h",
      detalle:
        (base.detalle ? base.detalle + " " : "") +
        "Inhibidor potente y selectivo de P-gp concomitante: reducci√≥n obligada de edoxab√°n a 30 mg/24 h."
    };
  }

  // Dabigatr√°n: evitar; preferir alternativa ACOD si es posible
  if (ac === "dabigatran"){
 return {
  ok: true,
  contraindicado: true,
  alternativaACOD: true,   // üëà CLAVE
  dosis: "",
  detalle:
    "Inhibidor potente y selectivo de P-gp concomitante: dabigatr√°n no recomendado por riesgo de acumulaci√≥n. " +
    "Si no existe interacci√≥n dual ni otras contraindicaciones, puede considerarse el uso de apixab√°n o rivaroxab√°n " +
    "(menos dependientes de P-gp) como alternativa; si no es posible, preferir AVK."
  };
}

  // Apixab√°n / Rivaroxab√°n: no ajustar dosis autom√°ticamente, pero a√±adir nota contextual
  if (ac === "apixaban" || ac === "rivaroxaban"){
    return {
      ...base,
      detalle:
        (base.detalle ? base.detalle + " " : "") +
        "Inhibidor potente y selectivo de P-gp concomitante: no se recomienda ajuste sistem√°tico de dosis. " +
        "Dabigatr√°n debe evitarse y edoxab√°n requiere reducci√≥n obligada; cuando sea cl√≠nicamente apropiado, " +
        "apixab√°n o rivaroxab√°n pueden ser opciones preferentes en este contexto, si no existen contraindicaciones."
    };
  }

  // Resto: a√±adir aviso general sin modificar dosis
  return {
    ...base,
    detalle:
      (base.detalle ? base.detalle + " " : "") +
      "Inhibidor potente y selectivo de P-gp concomitante: posible aumento de exposici√≥n a ACOD; extremar vigilancia hemorr√°gica."
  };
}

// üü° Inhibidor potente y selectivo de CYP3A4
if (inter.cyp){
  if (ac === "apixaban" || ac === "rivaroxaban"){
    return {
      ...base,
      detalle:
        (base.detalle ? base.detalle + " " : "") +
        "Inhibidor potente y selectivo de CYP3A4 concomitante: aunque no se recomienda ajuste sistem√°tico de dosis, " +
        "puede producir un aumento moderado de la exposici√≥n al f√°rmaco. " +
        "En pacientes con riesgo hemorr√°gico elevado o necesidad de tratamiento concomitante prolongado, " +
        "puede considerarse de forma individualizada el uso de un ACOD menos dependiente de CYP3A4, " +
        "como dabigatr√°n o edoxab√°n, si no existen contraindicaciones."
    };
  }
}

  // ‚ö™ Otros
  if (inter.otros){
    return {
      ...base,
      detalle: (base.detalle || "") +
        " F√°rmacos con sinergia hemorr√°gica: no modifican la dosis, pero aumentan el riesgo de sangrado."
    };
  }

  return base;
}

/** Construye salida final limpia (una sola recomendaci√≥n) */
function motorRenalV2(datos){
  const ac = getFarmacoObjetivoRenal(datos);
  const f  = nombreFarmaco(ac);
  const clcr = datos.clcr;

  // 1Ô∏è‚É£ Clasificar interacciones
  const clasif = clasificarInteraccionesV2(datos.interacciones || []);

  // 2Ô∏è‚É£ Calcular dosis base por funci√≥n renal
  const base = dosisRenalBaseFA({
    ac,
    clcr,
    edad: datos.edad || 0,
    peso: datos.peso || 0,
    creatinina_mgdl: datos.creatinina || 0,
    sexo: datos.sexo || ""
  });

  if (!base.ok){
    return {
      html: `<b>Recomendaci√≥n final:</b><br>${base.detalle || "No se pudo generar la recomendaci√≥n."}`,
      copyText: `Recomendaci√≥n final: ${base.detalle || "No se pudo generar la recomendaci√≥n."}`
    };
  }

  // 3Ô∏è‚É£ Aplicar interacciones (bloqueo o ajuste)
  const final = aplicarInteraccionesRenalV2({
    ac,
    base,
    inter: clasif
  });

  // 4Ô∏è‚É£ Render √∫nico
if(final.contraindicado){

  const principal = final.alternativaACOD
    ? "Anticoagulante actual no recomendado"
    : "ACOD no recomendado ‚Üí preferir AVK";

  const nota = `${final.detalle}${(clcr || clcr === 0) ? ` (ClCr: ${clcr} mL/min).` : ""}`;

  return {
    html:
      `<b>Recomendaci√≥n final:</b><br>` +
      `<div style="margin-top:8px; font-size:1.05em;"><b>${principal}</b></div>` +
      `<div style="margin-top:8px; color:#374151; font-size:0.95em;">${nota}</div>`,
    copyText:
      `Recomendaci√≥n final: ${principal}\n${nota}`
  };
}


  const principal = `${f}: ${final.dosis}`;
  const notas = [];
  if (clcr || clcr === 0) notas.push(`ClCr (Cockcroft-Gault): ${clcr} mL/min.`);
  if (final.detalle) notas.push(final.detalle);

  return {
    html:
      `<b>Recomendaci√≥n final:</b><br>` +
      `<div style="margin-top:8px; font-size:1.05em;"><b>${principal}</b></div>` +
      (notas.length
        ? `<div style="margin-top:8px; color:#374151; font-size:0.95em;">${notas.join(" ")}</div>`
        : ""),
    copyText:
      `Recomendaci√≥n final: ${principal}\n` +
      (notas.length ? notas.join(" ") : "")
  };
}


/* ==========================================================
   BOT√ìN CALCULAR
========================================================== */

document.getElementById("btnCalcular").addEventListener("click", () => {
  const datos = recogerDatos();

  const res = document.getElementById("resultado");
  const out = document.getElementById("resultado-texto");

  // üî∑ v2 ‚Äî Escenario RENAL: salida √∫nica y final
  if(datos.escenario === "renal"){
    const r = motorRenalV2(datos);
    out.innerHTML = r.html;
    out.dataset.copy = r.copyText || out.textContent;
  } else {
    // Resto: motor existente
    const html = motorSwitchingV2(datos);
  out.innerHTML = html;
 out.dataset.copy = out.textContent;
}

  res.style.display = "block";
  res.classList.add("fade-in-switch");
});


/* ==========================================================
   BOT√ìN BORRAR
========================================================== */
document.getElementById("btnBorrar").addEventListener("click", () => {

  document.getElementById("formSwitching").reset?.();

  document.querySelectorAll(".switch-chip.active")
    .forEach(ch => ch.classList.remove("active"));

  const res = document.getElementById("resultado");
  res.style.display = "none";

  document.getElementById("resultado-texto").innerText = "";

  window.scrollTo({ top: 0, behavior: "smooth" });
});

/* ==========================================================
   BOT√ìN COPIAR
========================================================== */
document.getElementById("btnCopiar").addEventListener("click", () => {
  const cont = document.getElementById("resultado-texto");
  const txt  = (cont.dataset.copy || cont.textContent || "").trim();

  if (!txt) return;

  navigator.clipboard.writeText(txt).then(() => {
    const btn = document.getElementById("btnCopiar");
    const oldText = btn.textContent;

    btn.classList.add("copiado");
    btn.textContent = "Copiado";

    setTimeout(() => {
      btn.classList.remove("copiado");
      btn.textContent = oldText;
    }, 1500);
  });
});


/* ==========================================================
   LISTAS PARA LOS MODALES DE INTERACCIONES
========================================================== */

const infoInteracciones = {

  /* ======================================================
     INHIBIDORES / INDUCTORES DUALES (CYP3A4 + P-gp)
     (potentes o moderados)
  ====================================================== */
  dual: {
    titulo: "Inhibidores o inductores duales",
    html: `
      <p>
        F√°rmacos que <b>inhiben o inducen simult√°neamente CYP3A4 y la glicoprote√≠na P (P-gp)</b>,
        produciendo alteraciones farmacocin√©ticas <b>cl√≠nicamente relevantes</b> de los ACOD.
      </p>

      <h4>üî¥ Inhibidores duales</h4>
      <ul>
        <li>Ketoconazol</li>
        <li>Itraconazol</li>
        <li>Posaconazol</li>
        <li>Voriconazol</li>
        <li>Ritonavir</li>
        <li>Cobicistat</li>
        <li>Atazanavir</li>
        <li>Darunavir</li>
        <li>Nelfinavir</li>
        <li>Saquinavir</li>
        <li>Claritromicina</li>
        <li>Eritromicina</li>
      </ul>

      <h4>üîµ Inductores duales</h4>
      <ul>
        <li>Rifampicina</li>
        <li>Rifabutina</li>
        <li>Carbamazepina</li>
        <li>Fenito√≠na</li>
        <li>Fenobarbital</li>
        <li>Primidona</li>
        <li>Hierba de San Juan</li>
      </ul>
<hr>
      <p><b>üö´ ACOD no recomendado</b> mientras persista la interacci√≥n. </p><p>‚≠ê Preferir <b>antagonistas de la vitamina K (AVK)</b>.</p>
      <p class="note">
        ‚ö†Ô∏è El ajuste de dosis o del intervalo <b>no es suficiente</b>.
      </p>
    `
  },

  /* ======================================================
     INHIBIDORES POTENTES Y SELECTIVOS DE P-gp
  ====================================================== */
  pgp: {
    titulo: "Inhibidores potentes y selectivos de P-gp",
    html: `
      <p>
        F√°rmacos que inhiben de forma <b>potente y cl√≠nicamente relevante</b> la glicoprote√≠na P (P-gp),
        <b>sin inhibici√≥n significativa de CYP3A4</b>.
      </p>

      <ul>
        <li>Dronedarona</li>
        <li>Quinidina</li>
        <li>Ciclosporina</li></ul>
<hr>

      <p><b>üö´ Dabigatr√°n:</b> generalmente <b>no recomendado</b>.</p>
        <p><b>‚¨áÔ∏è Edoxab√°n:</b> requiere <b>reducci√≥n a 30 mg/24 h</b>.</p>
        <p><b>‚û°Ô∏è Apixab√°n / Rivaroxab√°n:</b> no suelen requerir ajuste.</p>
      <p class="note">
        ‚ÑπÔ∏è El efecto puede ser mayor si coexiste deterioro renal.
      </p>
    `
  },

  /* ======================================================
     INHIBIDORES POTENTES Y SELECTIVOS DE CYP3A4
  ====================================================== */
  cyp: {
    titulo: "Inhibidores potentes y selectivos de CYP3A4",
    html: `
      <p>
        F√°rmacos que inhiben de forma <b>potente</b> el metabolismo mediado por CYP3A4,
        <b>sin inhibici√≥n relevante de P-gp</b>.
      </p>

      <ul>
        <li>Fluconazol</li>
        <li>Nefazodona</li>
      </ul>
<hr>

      <p><b>üö® Apixab√°n y rivaroxab√°n:</b> aumento significativo del riesgo hemorr√°gico.</p>
        <p><b>ü§è Dabigatr√°n:</b> impacto m√≠nimo.</p>
        <p><b>üîÑ Edoxab√°n:</b> efecto variable.</p>

      <p class="note">
        ‚ÑπÔ∏è No suele contraindicar el ACOD por s√≠ solo, pero puede justificar mayor vigilancia cl√≠nica.
      </p>
    `
  },

  /* ======================================================
     OTROS ‚Äì SINERGIA HEMORR√ÅGICA
  ====================================================== */
  otros: {
    titulo: "F√°rmacos con sinergia hemorr√°gica (sin efecto farmacocin√©tico)",
    html: `
      <p>
        F√°rmacos que <b>no modifican las concentraciones plasm√°ticas</b> del ACOD,
        pero aumentan el riesgo de sangrado por <b>sinergia farmacodin√°mica</b>.
      </p>

      <ul>
        <li>√Åcido acetilsalic√≠lico</li>
        <li>Doble antiagregaci√≥n</li>
        <li>Antiinflamatorios no esteroideos (AINEs)</li>
        <li>Corticoides sist√©micos</li>
        <li>Inhibidores selectivos de la recaptaci√≥n de serotonina (ISRS)</li>
        <li>Inhibidores de la recaptaci√≥n de serotonina y noradrenalina (ISRN)</li>
      </ul>
<hr>

      <p><b>‚û°Ô∏è No modifican dosis ni intervalo</b> del ACOD. </p><p>üö® Valoraci√≥n individual del riesgo hemorr√°gico.</p>
      <p class="note">
        ‚ÑπÔ∏è Gastroprotecci√≥n y vigilancia cl√≠nica estrecha.
      </p>
    `
  }

};


</script>



<!-- TOAST -->
<div id="toast" class="toast"></div>
<footer> <img src="../img/uibanner.png" alt="Ictus GPS"></footer>
</body>
</html>
