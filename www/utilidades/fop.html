<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- ===== META DATA / SEO ===== -->
<meta name="title" content="Foramen oval permeable">
<meta name="description" content="Herramienta cl√≠nica interactiva basada en la escala RoPE, los criterios anat√≥micos y cl√≠nicos (A+C) y la clasificaci√≥n PASCAL para orientar la elecci√≥n de tratamiento en el foramen oval permeable (FOP) tras ictus isqu√©mico.">
<meta name="keywords" content="FOP, foramen oval permeable, RoPE, PASCAL, ictus criptog√©nico, cierre percut√°neo, embolia parad√≥jica, neurolog√≠a vascular, Ictus GPS, tratamiento ictus, prevenci√≥n secundaria, cierre FOP">
<meta name="author" content="Rafael Bustamante Toledo">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Foramen oval permeable">
<meta property="og:description" content="RoPE + A + C + clasificaci√≥n PASCAL para estimar la probabilidad de causalidad del FOP y orientar el manejo.">
<meta property="og:type" content="website">
<meta property="og:image" content="../iconos/ictusgps.png">
<meta property="og:locale" content="es_ES">
<meta name="theme-color" content="#0f3d83">

<title>Foramen oval permeable</title>
<link rel="icon" type="image/png" sizes="192x192" href="../iconos/ictusgps.png">
<link rel="apple-touch-icon" sizes="180x180" href="../iconos/ictusgps.png">

<style>
/* =========================================================
   VARIABLES GLOBALES
========================================================= */
:root{
  --bg:#f8fafc; 
  --ink:#0e1a33;

  --azul:#0f3d83;
  --azul-institucional:#0f3d83;

  --accent-dark:#0f3d83;
  --accent-light:#2563eb;

  --border:#e5e9f2;
  --muted:#64748b;

  --ok:#166534;
  --ok-bg:#e9fce7;
  --ok-ring:#bbf7d0;

  --mid:#92400e;
  --mid-bg:#fff7ed;
  --mid-ring:#fed7aa;

  --bad:#991b1b;
  --bad-bg:#fef2f2;
  --bad-ring:#fecaca;

  --gris:#6b7280;
  --borde:#e5e7eb;
  --error:#b91c1c;
}

*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--ink);
  font-family: Verdana, Geneva, Tahoma, sans-serif
}
.wrap{max-width:1100px;margin:0 auto;padding:.2rem}

/* =========================================================
   SAFE-TOP (FIJO 60 px + notch)
========================================================= */
.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top) + 60px);
  background: var(--azul-institucional);
  z-index: 1001;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: env(safe-area-inset-top);
}

.safe-content{
  width:100%;
  max-width:1080px;
  padding: 6px 16px 8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.safe-left{
  display:flex;
  align-items:center;
  gap:10px;
}

.safe-mini{
  width:44px;
  height:44px;
  object-fit:contain;
  padding:4px;
  box-shadow:0 0 4px rgba(0,0,0,0.1);
}

.safe-logo{
  height:44px;
  width:auto;
}

.safe-actions{
  display:flex;
  gap:10px;
}

.safe-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
  background:rgba(255,255,255,0.15);
  border:1px solid white;
  border-radius:50%;
  transition:background .25s, border-color .25s, transform .1s;
}

.safe-btn:hover{
  background:#01c5fe;
}

.safe-btn:active{
  transform:scale(0.95);
}

.safe-icon{
  width:32px; 
  height:32px;
  object-fit:contain;
}

/* =========================================================
   CABECERA STICKY
========================================================= */
header{
  position:sticky;
  top:calc(env(safe-area-inset-top) + 52px);
  z-index:1002;
  backdrop-filter:blur(6px);
  background:var(--azul-institucional);
  border-bottom:1px solid rgba(255,255,255,.08);
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  color:#fff;
}

.bar{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  height:52px;
  padding:0 16px;
}

.title{
  display:flex;
  align-items:center;
  font-size:1.4rem;
  font-weight:700;
  color:#fff;
}

.title img{
  width:32px;
  height:32px;
  margin-right:8px;
}

.howto{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 2px 2px var(--shadow);
  padding:1rem;
  margin:.3rem 0 1rem;
  font-size:14px
}
.panel{
  background:#fff;
  border:1px solid var(--borde);
  border-radius:16px;
  padding:16px;
  box-shadow:0 2px 10px rgba(15,23,42,.06)
}

.block{
  border-radius:14px;
  padding:14px 16px;
  margin:14px 0;
  transition:background .3s
}

.block h3{
  margin:0 0 8px 0;
  font-size:1.05rem;
  font-weight:800;
  display:flex;
  align-items:center;
  gap:6px
}

.block.rope{
  background:#eff6ff;
  border-left:4px solid #3b82f6
}

.block.anat{
  background:#ecfdf5;
  border-left:4px solid #10b981
}

.block.clin{
  background:#fffbeb;
  border-left:4px solid #f59e0b
}

.block.info{
  background:#ffffff;
  border-left:4px solid #000000
}

.note{
  color:#64748b;
  font-size:12px;
  margin:6px 0 12px
}

label{
  font-weight:400;
  color:#1e293b;
  margin-top:8px;
  display:block
}

select{
  width:100%;
  padding:10px 12px;
  border:1px solid #cbd5e1;
  border-radius:10px;
  background:#fff;
  font-size:14px
}

.grid{
  display:grid;
  gap:10px
}

@media(min-width:860px){
  .grid.cols-2{grid-template-columns:1fr 1fr}
}

/* RESPONSIVE: PASCAL + RECOMENDACI√ìN EN M√ìVIL */
@media(max-width: 640px){
  .kpi.pascal-reco {
    grid-template-columns: 1fr !important;
  }
}

.check{
  display:flex;
  align-items:flex-start;
  gap:8px;
  margin:6px 0;
  color:#1e293b;
  font-weight:400;
  transition:color .2s
}

.check:hover{
  color:#0f3d83
}

.check input{
  margin-top:2px;
  transform:scale(1.05);
  accent-color:#0f3d83
}

/* RESULTADOS */
.kpi{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:10px
}

.box{
  border:1.5px dashed #c7dbff;
  border-radius:14px;
  padding:14px;
  background:#f8fbff;
  text-align:center
}

.ttl{
  font-size:14px;
  color:#334155;
  font-weight:800;
  margin-bottom:2px
}

.val{
  font-size:22px;
  font-weight:900;
  color:#0b2c5f
}

.mini{
  font-size:12px;
  color:#64748b;
  margin-top:4px
}

.hidden-note{
  display:none;
}

.ok{
  background:var(--ok-bg);
  border-color:var(--ok-ring)
}

.warn{
  background:var(--mid-bg);
  border-color:var(--mid-ring)
}

.bad{
  background:var(--bad-bg);
  border-color:var(--bad-ring)
}

.ok .val{color:var(--ok)}
.warn .val{color:var(--mid)}
.bad .val{color:var(--bad)}

.actions{
  margin-left:auto;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:16px;
}

.btn-action{
  flex:1 1 32%;
  border:none;
  border-radius:10px;
  padding:12px;
  font-size:15px;
  font-weight:700;
  cursor:pointer
}

.btn-clear{
  background:#fff;
  color:#0b2c5f;
  border:1px solid #2563eb
}

.btn-clear:hover{
  background:#eff6ff
}

.btn-copy{
  background:#fff;
  color:#0f3d83;
  border:1px solid #2563eb
}

.btn-copy:hover{
  background:#eff6ff
}

.btn-copy.copiado{
  background:#0f3d83!important;
  color:#fff!important
}

.btn-calc{
  background:#0f3d83;
  color:#fff;
  border:1px solid #0f3d83
}

.btn-calc:hover{
  background:#1c60c3
}

#resumenText{
  white-space:pre-wrap;
  font-size:13px;
  color:#0f172a;
  margin-top:12px;
  border:1px dashed var(--borde);
  border-radius:10px;
  padding:10px 12px;
  background:#f8fafc;
  line-height:1.45
}

.advertencia{
  background:#fffbe6;
  border-left:4px solid #f59e0b;
  padding:10px;
  border-radius:10px;
  font-size:13px;
  color:#78350f;
  margin-top:16px;
  line-height:1.5
}

/* DISCLAIMER FINAL */
.disclaimer-red{
  background:#fef2f2;
  border:1px solid #fecaca;
  border-radius:12px;
  padding:14px 16px;
  margin:28px auto 0;
  max-width:960px;
  box-shadow:0 2px 8px rgba(185,28,28,0.05);
}

.disclaimer-red p{
  margin:0;
  color:#7f1d1d;
  font-size:14px;
  line-height:1.5;
  text-align:left;
}

.disclaimer-red b{
  color:#991b1b;
}

.back-btn{
  display:inline-block;
  margin:1.5rem auto 0;
  background:#0f3d83;
  color:#fff;
  text-decoration:none;
  font-weight:700;
  padding:0.7rem 1.4rem;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(15,61,131,.25);
  transition:background .2s, transform .1s, box-shadow .2s;
}

.back-btn:hover{
  background:#1c60c3;
  transform:translateY(-1px);
  box-shadow:0 6px 12px rgba(15,61,131,.35);
}

/* FOOTER */
footer{
  width:100%;
  margin:2rem 0 0;
  padding:1.5rem 0;
  border-top:1px solid #e5e7eb;
  background:#ffffff;
  text-align:center;
  box-shadow:0 -2px 6px rgba(0,0,0,0.04);
}

/* =========================================================
   MEDIA QUERIES
========================================================= */
@media(max-width:768px){
  header{font-size:1.05rem;}
  main{padding:0.9rem 1rem;}
  body{font-size:0.96rem;}
}

/* =========================================================
   PADDING SUPERIOR DEL CONTENIDO
========================================================= */

/* Empuja el contenido real por debajo de la barra superior */
body {
  margin: 0;
  padding-top: calc(env(safe-area-inset-top, 0px) + 52px);
  background-color: #fff;
}
/* =========================================================
   MODAL INFORMATIVA
========================================================= */

.modal-info{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.45);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:3000;
}

.modal-content{
  background:#ffffff;
  border-radius:14px;
  padding:20px;
  max-width:420px;
  width:88%;
  box-shadow:0 6px 20px rgba(0,0,0,0.25);
  position:relative;
  animation:fadeIn .25s ease;
}

.modal-text{
  font-size:14px;
  color:#1e293b;
  line-height:1.5;
  white-space:pre-wrap;
}

.modal-close{
  position:absolute;
  top:2px;
  right:1px;
  background:none;
  border:none;
  font-size:10px;
  cursor:pointer;
  color:#000;
}

.modal-close:hover{
  color:#991b1b;
}

@keyframes fadeIn{
  from{opacity:0; transform:scale(.95)}
  to{opacity:1; transform:scale(1)}
}

/* Icono informativo */
.info-line{
  text-align:center;
  margin-top:4px;
}

.info-icon{
  cursor:pointer;
  font-size:18px;
  color:#000;
  font-weight:700;
  padding:0 2px;
}

.info-icon:hover{
  color:#1c60c3;
}

</style>
</head>

<body>

<!-- SAFE-TOP -->
<div class="safe-top">
  <div class="safe-content">
    <div class="safe-left">
      <img src="../iconos/utilidadesico.png" class="safe-mini" alt="">
      <img src="../img/topbar.png" class="safe-logo" alt="IctusGPS">
    </div>

    <div class="safe-actions">
      <a href="javascript:history.back()" class="safe-btn">
        <img src="../iconos/atrastransparente.png" class="safe-icon" alt="">
      </a>
      <a href="../index.html" class="safe-btn">
        <img src="../iconos/hometransparente.png" class="safe-icon" alt="">
      </a>
    </div>
  </div>
</div>

<!-- CABECERA -->
<header>
  <div class="bar">
    <div class="title">
      <img src="fopico.png" alt="">
      Foramen oval permeable
    </div>
  </div>
</header>

<main class="wrap">
<div class="howto">
    La herramienta calcula autom√°ticamente la puntuaci√≥n <b>RoPE</b> y la clasificaci√≥n <b>PASCAL</b> (RoPE + rasgos anat√≥micos de alto riesgo) para orientar la probabilidad de causalidad del FOP y la recomendaci√≥n final. Las situaciones cl√≠nicas relevantes (C) no modifican la clasificaci√≥n PASCAL, pero pueden ayudar al cl√≠nico a contextualizar el caso y a decidir cuando se precisa <b>discusi√≥n multidisciplinar</b>. El resumen puede copiarse con el bot√≥n correspondiente.
</div>
<section class="panel">

<!-- BLOQUE ROPE -->
<div class="block rope">
  <h3>üßÆ Escala RoPE</h3>
  <div class="grid cols-2">
    <div>
      <label><b>Edad</b></label>
      <select id="age">
        <option value="">Selecciona‚Ä¶</option>
        <option value="5">‚â§30</option>
        <option value="4">31‚Äì40</option>
        <option value="3">41‚Äì50</option>
        <option value="2">51‚Äì60</option>
        <option value="1">61‚Äì70</option>
        <option value="0">&gt;70</option>
      </select>
    </div>
    <div>
      <label><b>Factores cl√≠nicos</b></label>
      <label class="check"><input type="checkbox" id="noHTN"> No HTA</label>
      <label class="check"><input type="checkbox" id="noDM"> No DM</label>
      <label class="check"><input type="checkbox" id="noSmoke"> No tabaco</label>
      <label class="check"><input type="checkbox" id="noPrior"> No ictus/AIT previo</label>
      <label class="check"><input type="checkbox" id="cortical"> Infarto cortical</label>
    </div>
  </div>
</div>

<!-- BLOQUE ANAT√ìMICO -->
<div class="block anat">
  <h3>ü´Ä Caracter√≠sticas anat√≥micas (A)</h3>
  <div class="grid cols-2">
    <label class="check"><input type="checkbox" id="asa"> Aneurisma o movilidad del tabique interauricular (ASA ‚â•10‚Äì15 mm o septo laxo)</label>
    <label class="check"><input type="checkbox" id="largeShunt"> Gran paso D-I / shunt tipo ‚Äúen ducha o cortina‚Äù</label>
    <label class="check"><input type="checkbox" id="longTunnel"> Canal interauricular largo (&gt;8 mm)</label>
    <label class="check"><input type="checkbox" id="eustachian"> V√°lvula de Eustaquio o red de Chiari prominente</label>
    <label class="check"><input type="checkbox" id="pulmShunt"> Shunt pulmonar coexistente</label>
  </div>
</div>

<!-- BLOQUE CL√çNICO -->
<div class="block clin">
  <h3>üë©‚Äç‚öïÔ∏è Situaciones cl√≠nicas relevantes (C)</h3>
  <div class="grid cols-2">
    <label class="check"><input type="checkbox" id="crypt60"> Evento isqu√©mico sin causa alternativa identificada tras estudio completo</label>
    <label class="check"><input type="checkbox" id="noAF"> Sin FA documentada (incluida monitorizaci√≥n prolongada)</label>
    <label class="check"><input type="checkbox" id="embolicMulti"> Patr√≥n emb√≥lico multiterritorial o bilateral</label>
    <label class="check"><input type="checkbox" id="recurOnAP"> Recurrencia bajo antiagregante</label>
    <label class="check"><input type="checkbox" id="lowBleed"> Riesgo hemorr√°gico bajo</label>
    <label class="check"><input type="checkbox" id="contraClose"> <span style="color:#991b1b; font-weight:700;">Contraindicaci√≥n para cierre</span></label>
  </div>
</div>


<!-- BLOQUE INFORMATIVO (incluye PASCAL + explicaci√≥n A/C) -->
<div class="block info">
  <h3>üìä Clasificaci√≥n PASCAL</h3>
  <div class="note" style="margin-bottom:10px;">
    La clasificaci√≥n PASCAL combina la puntuaci√≥n RoPE y la presencia de rasgos anat√≥micos de alto riesgo del FOP (shunt grande y/o aneurisma del septo auricular) para estimar la probabilidad de que el FOP sea causal.
    <br><br>
    ‚Ä¢ RoPE ‚â•7 <b>y</b> shunt grande o ASA ‚Üí <b>Probable</b> (FOP probablemente causal; el cierre ofrece el mayor beneficio absoluto).<br>
    ‚Ä¢ RoPE ‚â•7 sin shunt grande/ASA, o RoPE &lt;7 con shunt grande/ASA ‚Üí <b>Posible</b> (relaci√≥n causal posible; valorar caso a caso).<br>
    ‚Ä¢ RoPE &lt;7 <b>y</b> sin shunt grande/ASA ‚Üí <b>Improbable</b> (FOP probablemente incidental).
  </div>

  <!-- Detalles explicativos originales -->
  <div class="note">
    <details style="margin-top:16px;">
      <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">
        üìã Explicaci√≥n de los factores anat√≥micos y cl√≠nicos
      </summary>
      <div style="margin-top:8px;font-size:13px;line-height:1.5;color:#1e293b;">
        <b>Factores anat√≥micos de alto riesgo:</b>
        <ul>
          <li><b>Aneurisma del septo interauricular (ASA):</b> movilidad septal &gt;10‚Äì15 mm; favorece el paso de √©mbolos.</li>
          <li><b>Septo laxo:</b> variabilidad septal que aumenta riesgo de embolia parad√≥jica.</li>
          <li><b>Gran paso derecha‚Äìizquierda:</b> shunt significativo visible en reposo o con maniobra de Valsalva.</li>
          <li><b>Shunt tipo ‚Äúen ducha o cortina‚Äù:</b> m√∫ltiples microburbujas que indican paso masivo.</li>
          <li><b>Canal largo:</b> t√∫nel interauricular &gt;8 mm, mantiene comunicaci√≥n abierta.</li>
          <li><b>V√°lvula de Eustaquio / red de Chiari:</b> estructuras que dirigen el flujo hacia el FOP.</li>
          <li><b>Shunt pulmonar:</b> paso alternativo de √©mbolos, relevante si coexistente con FOP.</li>
        </ul>

<b>Situaciones cl√≠nicas relevantes:</b>
<ul>
  <li><b>Evento isqu√©mico sin causa alternativa:</b> ictus criptog√©nico tras estudio adecuado.</li>
  <li><b>Sin fibrilaci√≥n auricular documentada:</b> incluida monitorizaci√≥n prolongada.</li>
  <li><b>Patr√≥n emb√≥lico multiterritorial o bilateral:</b> distribuci√≥n de infartos que refuerza origen embol√≠geno.</li>
  <li><b>Recurrencia bajo antiagregante:</b> sugiere fracaso del tratamiento m√©dico y mayor beneficio del cierre.</li>
  <li><b>Riesgo hemorr√°gico bajo:</b> condici√≥n favorable cuando se plantea cierre o intensificaci√≥n terap√©utica.</li>
</ul>

      </div>
    </details>
  </div>
</div>

<!-- BOTONES -->
<div class="actions">
  <button id="btnCalc" class="btn-action btn-calc">Calcular</button>
  <button id="btnClear" class="btn-action btn-clear">Borrar</button>
  <button id="btnCopy" class="btn-action btn-copy">Copiar resumen</button>
</div>

<!-- RESULTADOS -->
<div class="panel" id="resultCard" style="margin-top:16px;display:none;">

  <!-- RoPE -->
  <div class="kpi">
  <div class="box" id="ropeBox">
    <div class="ttl">RoPE <span class="info-icon" data-info="probVal">‚ÑπÔ∏è</span></div>
    <div class="val" id="scoreVal">-</div>
    <!-- contenedor oculto para la probabilidad -->
    <div class="mini hidden-note" id="probVal">-</div>
    <div class="info-line">
    </div>
  </div>
  <div class="box" id="classBox">
    <div class="ttl">Categor√≠a RoPE</div>
    <div class="val" id="classVal">-</div>
    <!-- contenedor oculto para la interpretaci√≥n -->
    <div class="mini hidden-note" id="interpVal">-</div>
  </div>
</div>


  <!-- Anat + Cl√≠nico -->
  <div class="kpi">
    <div class="box" id="aBox">
      <div class="ttl">Anatom√≠a</div>
      <div class="val" id="aVal">0</div>
    </div>
    <div class="box" id="cBox">
      <div class="ttl">Cl√≠nica</div>
      <div class="val" id="cVal">0</div>
    </div>
  </div>

  <!-- PASCAL + Recomendaci√≥n en la misma fila -->
<div class="kpi pascal-reco" style="grid-template-columns:1fr 1.4fr;">

  <!-- PASCAL -->
  <div class="box" id="pascalBox">
    <div class="ttl">Clasificaci√≥n PASCAL <span class="info-icon" data-info="pascalNote">‚ÑπÔ∏è</span>
</div>
    <div class="val" id="pascalVal">-</div>
    <!-- contenedor oculto para la nota PASCAL -->
    <div class="mini hidden-note" id="pascalNote">-</div>
    <div class="info-line">
    </div>
  </div>

  <!-- Recomendaci√≥n orientativa -->
  <div class="box" id="recBox">
    <div class="ttl">Recomendaci√≥n <span class="info-icon" data-info="recNote">‚ÑπÔ∏è</span>
</div>
    <div class="val" id="recVal">-</div>
    <!-- contenedor oculto para la nota de recomendaci√≥n -->
    <div class="mini hidden-note" id="recNote">-</div>
    <div class="info-line">    </div>
  </div>

</div>

  <!-- Resumen -->
  <div id="resumenText"></div>

  <!-- Disclaimer -->
  <div class="disclaimer-red">
    <p>
      <b>Advertencia.</b> Esta herramienta tiene car√°cter orientativo y no sustituye el juicio cl√≠nico del profesional sanitario ni la discusi√≥n multidisciplinar.
      Las recomendaciones deben interpretarse en el contexto individual del paciente y conforme a protocolos y gu√≠as de referencia.
    </p>
  </div>

</div>

</section>
</main>

<footer>
  <img src="uibanner.png" alt="Unidad de Ictus M√°laga" style="max-width:380px;height:auto;opacity:.96">
</footer>
<!-- VENTANA EMERGENTE -->
<div id="modalInfo" class="modal-info">
  <div class="modal-content">
    <button class="modal-close" id="closeModal">‚ùå</button>
    <div id="modalText" class="modal-text"></div>
  </div>
</div>
<script>
/* Probabilidades RoPE */
const PROB={
  0:'28% de probabilidad del FOP como causa del ictus',1:'30% de probabilidad del FOP como causa del ictus',2:'35% de probabilidad del FOP como causa del ictus',3:'44% de probabilidad del FOP como causa del ictus',4:'55% de probabilidad del FOP como causa del ictus',
  5:'61% de probabilidad del FOP como causa del ictus',6:'67% de probabilidad del FOP como causa del ictus',7:'78% de probabilidad del FOP como causa del ictus',8:'84% de probabilidad del FOP como causa del ictus',9:'88% de probabilidad del FOP como causa del ictus',10:'90% de probabilidad del FOP como causa del ictus'
};

/* IDs de campos */
const idsAnat=['asa','largeShunt','longTunnel','eustachian','pulmShunt'];
const idsClin=['crypt60','noAF','embolicMulti','recurOnAP','lowBleed'];

const $=id=>document.getElementById(id);

/* Funciones auxiliares RoPE */
const toneFor=s=>s>=7?'bad':(s>=4?'warn':'ok');
const labelFor=s=>s>=7?'Alta':(s>=4?'Intermedia':'Baja');
const interpFor=s=>s>=7?'Probabilidad alta de FOP causal.':(s>=4?'Probabilidad intermedia.':'Probabilidad baja de FOP causal.');

function getAnat(){return idsAnat.filter(id=>$(id).checked)}
function getClin(){return idsClin.filter(id=>$(id).checked)}

/* PASCAL: usa RoPE + shunt grande / ASA */
function hasHighRiskPascal(){
  return !!($('largeShunt').checked || $('asa').checked);
}

function pascalClass(scoreRoPE){
  const highRisk = hasHighRiskPascal();

  if(scoreRoPE >= 7 && highRisk){
    return {
      label:'Probable',
      tone:'ok',
      note:'RoPE ‚â•7 y presencia de shunt grande y/o ASA: FOP probablemente causal.'
    };
  }

  if(scoreRoPE < 7 && !highRisk){
    return {
      label:'Improbable',
      tone:'bad',
      note:'RoPE <7 y sin shunt grande/ASA: el FOP probablemente es un hallazgo incidental.'
    };
  }

  if(scoreRoPE > 7 && !highRisk){
    return {
      label:'Posible',
      tone:'warn',
      note:'RoPE >7 y sin shunt grande/ASA: relaci√≥n causal posible.'
    };
  }


  if(scoreRoPE < 7 && highRisk){
    return {
      label:'Posible',
      tone:'warn',
      note:'RoPE <7 y presencia de shunt grande y/o ASA: relaci√≥n causal posible.'
    };
  }


  return {
    label:'Posible',
    tone:'warn',
    note:'Perfil intermedio (Posible): relaci√≥n causal posible.'
  };
}

/* Decisi√≥n terap√©utica basada en PASCAL + contraindicaciones */
function decideReco(score,A,C,pascal,contra){
  if(contra){
    return {
      rec:'Evitar cierre percut√°neo',
      note:'Existe contraindicaci√≥n o riesgo inaceptable para el procedimiento; optar por manejo m√©dico individualizado.',
      tone:'bad'
    };
  }

  if(pascal.label === 'Probable'){
    return {
      rec:'Cierre percut√°neo recomendado',
      note:'Clasificaci√≥n PASCAL ‚ÄúProbable‚Äù: FOP probablemente causal; mayor beneficio absoluto del cierre frente al manejo m√©dico.',
      tone:'ok'
    };
  }

  if(pascal.label === 'Posible'){
    return {
      rec:'Valorar cierre en consenso multidisciplinar',
      note:'Clasificaci√≥n PASCAL ‚ÄúPosible‚Äù: la relaci√≥n causal es posible; integrar edad, comorbilidad, preferencias del paciente y otros hallazgos (incluidos A y C).',
      tone:'warn'
    };
  }

  /* improbable */
  return {
    rec:'Manejo m√©dico (antiagregante o anticoagulaci√≥n seg√∫n perfil)',
    note:'Clasificaci√≥n PASCAL ‚ÄúImprobable‚Äù: el FOP es probablemente un hallazgo incidental; el beneficio del cierre es limitado.',
    tone:'bad'
  };
}

/* Resumen para copiar/pegar en la historia */
function mostrarResumen(s,prob,cat,A,C,pascal,decision,contra){
  const selAnat=getAnat().map(id=>({
    asa:'Aneurisma/septo laxo',
    largeShunt:'Gran paso D‚ÄìI (‚Äúducha/cortina‚Äù)',
    longTunnel:'Canal interauricular largo',
    eustachian:'V√°lvula de Eustaquio/red de Chiari',
    pulmShunt:'Shunt pulmonar coexistente'
  }[id]));

const selClin=getClin().map(id=>({
    crypt60:'Evento isqu√©mico sin causa alternativa identificada',
    noAF:'Sin FA documentada',
    embolicMulti:'Patr√≥n emb√≥lico multiterritorial o bilateral',
    recurOnAP:'Recurrencia bajo antiagregaci√≥n',
    lowBleed:'Riesgo hemorr√°gico bajo'
}[id]));


  let t = `FOP ‚Äì Recomendaci√≥n (Ictus GPS)\n`;
  t += `======================\n`;
  t += `RoPE: ${s}/10 ‚Äì Probabilidad de FOP causal: ${prob} (${cat}).\n`;
  t += `Rasgos anat√≥micos (A): ${A}${A ? ' ‚Äì ' + selAnat.join(', ') : ''}.\n`;
  t += `Criterios cl√≠nicos (C): ${C}${C ? ' ‚Äì ' + selClin.join(', ') : ''}.\n`;
  t += `Clasificaci√≥n PASCAL: ${pascal.label}. ${pascal.note}\n`;

  if(contra){
    t += `\nATENCI√ìN: Se ha marcado ‚Äúcontraindicaci√≥n para cierre‚Äù.\n`;
  }

  t += `\nRecomendaci√≥n orientativa: ${decision.rec}\n${decision.note}\n`;
  t += `\nReferencias: AHA/ASA 2021; ESO 2021.\n`;
  t += `Aviso: herramienta orientativa; no sustituye el juicio cl√≠nico ni la discusi√≥n multidisciplinar.`;

  $('resumenText').textContent = t;
}

/* C√°lculo principal */
function calcular(){
  const ageVal = $('age').value;
  if(ageVal === ''){
    $('resultCard').style.display='none';
    $('resumenText').textContent='';
    return;
  }

  let s = parseInt(ageVal,10);
  ['noHTN','noDM','noSmoke','noPrior','cortical'].forEach(id=>{
    if($(id).checked) s += 1;
  });
  s = Math.max(0,Math.min(10,s));

  const prob = PROB[s] || '‚Äî';
  const cat  = labelFor(s);
  const tone = toneFor(s);

  const A = getAnat().length;
  const C = getClin().length;
  const contra = $('contraClose').checked;

  const pascal = pascalClass(s);
  const decision = decideReco(s,A,C,pascal,contra);

  /* RoPE */
  $('scoreVal').textContent = s;
  $('probVal').textContent  = prob;
  $('classVal').textContent = cat;
  $('interpVal').textContent= interpFor(s);

  ['ropeBox','classBox'].forEach(id=>{
    const el=$(id);
    el.classList.remove('ok','warn','bad');
    el.classList.add(tone);
  });

  /* A y C */
  $('aVal').textContent = A;
  $('cVal').textContent = C;
  ['aBox','cBox'].forEach(id=>{
    const el=$(id);
    el.classList.remove('ok','warn','bad');
    el.classList.add(decision.tone);
  });

  /* PASCAL */
  $('pascalVal').textContent  = pascal.label;
  $('pascalNote').textContent = pascal.note;
  const pBox = $('pascalBox');
  pBox.classList.remove('ok','warn','bad');
  pBox.classList.add(pascal.tone);

  /* Recomendaci√≥n */
  $('recVal').textContent  = decision.rec;
  $('recNote').textContent = decision.note;
  const recBox = $('recBox');
  recBox.classList.remove('ok','warn','bad');
  recBox.classList.add(decision.tone);

  $('resultCard').style.display='block';

  mostrarResumen(s,prob,cat,A,C,pascal,decision,contra);
}

/* Borrar formulario */
function borrar(){
  $('age').value='';
  ['noHTN','noDM','noSmoke','noPrior','cortical','contraClose',...idsAnat,...idsClin]
    .forEach(id=>{
      if($(id)) $(id).checked=false;
    });

  $('resultCard').style.display='none';
  $('resumenText').textContent='';
}

/* Copiar resumen */
function copiar(){
  const t = $('resumenText').textContent.trim();
  if(!t) return;
  navigator.clipboard.writeText(t).then(()=>{
    const b = $('btnCopy');
    b.classList.add('copiado');
    b.textContent='Copiado';
    setTimeout(()=>{
      b.classList.remove('copiado');
      b.textContent='Copiar resumen';
    },1200);
  });
}

/* Listeners */
$('btnCalc').addEventListener('click',calcular);
$('btnClear').addEventListener('click',borrar);
$('btnCopy').addEventListener('click',copiar);

/* =========================================================
   MODAL DE INFORMACI√ìN
========================================================= */

const modal = $('modalInfo');
const modalText = $('modalText');
const closeModal = $('closeModal');

document.querySelectorAll('.info-icon').forEach(icon=>{
  icon.addEventListener('click', ()=>{
    const id = icon.dataset.info;
    const txt = $(id).textContent.trim() || 'Sin informaci√≥n disponible.';
    modalText.textContent = txt;
    modal.style.display = 'flex';
  });
});

closeModal.addEventListener('click', ()=> modal.style.display='none');
modal.addEventListener('click', e=>{
  if(e.target === modal) modal.style.display='none';
});


</script>


<script src="../js/index.js"></script>

</body>
</html>
