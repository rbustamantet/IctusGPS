<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Otras cardiopatías embolígenas</title>
<meta name="theme-color" content="#0f3d83">
<link rel="icon" type="image/png" sizes="192x192" href="../iconos/ictusgps.png">
<link rel="apple-touch-icon" sizes="180x180" href="../iconos/ictusgps.png">

<style>
/* VARIABLES BÁSICAS */
:root{
  --bg:#f8fafc; 
  --ink:#0e1a33;
  --azul:#0f3d83;
  --border:#e5e9f2;
  --muted:#64748b;
  --azul-light:#e4edfa;
  --azul-mid:#2563eb;
  --azul-dark:#0d2d63;
}

/* TIPOGRAFÍA */
html, body { font-family: Verdana, Geneva, sans-serif; }
*{box-sizing:border-box}

/* SAFE-TOP */
body{
  margin:0;
  padding-top:calc(env(safe-area-inset-top, 0px) + 52px);
  background:var(--bg);
  color:var(--ink);
}

.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top) + 60px);
  background: var(--azul);
  z-index: 1001;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: env(safe-area-inset-top);
}

.safe-content{
  width:100%;
  max-width:1080px;
  padding: 6px 16px 8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.safe-left{
  display:flex; align-items:center; gap:10px;
}
.safe-mini{width:44px;height:44px;object-fit:contain;padding:4px;}
.safe-logo{height:44px;width:auto;}

.safe-actions{display:flex; gap:10px;}
.safe-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:40px;height:40px;
  background:rgba(255,255,255,0.15);
  border:1px solid white;
  border-radius:50%;
}
.safe-btn:hover{background:#01c5fe;}
.safe-icon{width:32px;height:32px;}

/* CABECERA */
header{
  position:sticky;
  top:calc(env(safe-area-inset-top) + 52px);
  z-index:1002;
  background:var(--azul);
  color:#fff;
  height:52px;
  display:flex;
  justify-content:center;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,.08);
}

.title{display:flex;align-items:center;font-size:1.3rem;font-weight:700;}
.title img{width:32px;height:32px;margin-right:8px;}

/* CONTENIDO */
.wrap{max-width:1080px;margin:0 auto;padding:1rem;}

.panel{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 3px 14px rgba(16,71,119,.12);
  border:1px solid var(--border);
}

.block{
  background: linear-gradient(to bottom, #f2f7ff, #e9f1ff);
  border-left:4px solid #2563eb;
  border-radius:14px;
  padding:16px;
  margin:18px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}

select{
  padding:12px;
  border-radius:10px;
  border:1px solid #d4e2ff;
  background:#ffffff;
  font-size:1rem;
  width:100%;
  box-shadow:0 2px 6px rgba(0,0,0,0.03);
}
select:focus{
  outline:none;
  border:1px solid #0f3d83;
  box-shadow:0 0 0 1px rgba(15,61,131,0.2);
}


.block h3{
  margin:0 0 10px;
  font-size:1.1rem;
  font-weight:800;
  display:flex;
  gap:6px;
}
.icon-h3{
  width:20px;
  height:20px;
  margin-right:6px;
}

/* FACTORES */
label.row{
  display:flex;
  gap:8px;
  margin:6px 0;
  font-size:.93rem;
  align-items:flex-start;
}
label.row input{transform:scale(1.1);margin-top:3px;accent-color:#0f3d83;}
label.row:hover{
  background:#f1f6ff;
  border-radius:8px;
}


#patologia-resultado{
  background: #F7FFF7;
  border-left:4px solid green;
  border-radius:14px;
  padding:16px;
  margin:8px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}
#patologia-resultado b{
  color:#0f3d83;
}

.note{
  color:var(--muted);
  font-size:.85rem;
  margin-top:8px;
}

/* TOAST */
.toast{
  position:fixed;
  top:calc(env(safe-area-inset-top,0px) + 8px);
  right:16px;
  background:#b71c1c;
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:1200;
}
.toast.show{opacity:1; pointer-events:auto;}
/* DISCLAIMER FINAL */
.disclaimer-red{
  background:#fef2f2;
  border:1px solid #fecaca;
  border-radius:12px;
  margin:0 auto;
  padding:1rem;
  max-width:1080px;
  box-shadow:0 2px 8px rgba(185,28,28,0.05);
}
.disclaimer-red{
  background:#fff7f7;
  border-left:4px solid #d9534f;
  box-shadow:0 1px 4px rgba(217,83,79,0.05);
}
.disclaimer-red p{
  color:#7d1a1a;
}


/* FOOTER */
footer{
  width:100%;
  margin:2rem 0 0;
  padding:1.5rem 0;
  border-top:1px solid #e5e7eb;
  background:#ffffff;
  text-align:center;
  box-shadow:0 -2px 6px rgba(0,0,0,0.04);
}
footer img { max-width:80%; height:auto; }
@media (min-width:600px){ footer img { max-width:380px; } }

/* =========================================================
   MEDIA QUERIES / BODY PADDING
========================================================= */
@media(max-width:768px){
  header{font-size:1.05rem;}
  body{font-size:0.96rem;}
}

/* Empuja el contenido real por debajo de la barra superior */
body{
  padding-top:calc(env(safe-area-inset-top, 0px) + 52px);
  background-color:#f8fafc;
}

/* Animación para actualización suave */
.fade-in{
  animation: fadeIn 0.25s ease-out;
}

@keyframes fadeIn{
  from{
    opacity:0;
    transform:translateY(4px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}

</style>
</head>

<body>

<!-- SAFE TOP -->
<div class="safe-top">
  <div class="safe-content">
    <div class="safe-left">
      <img src="../iconos/utilidadesico.png" class="safe-mini">
      <img src="../img/topbar.png" class="safe-logo">
    </div>
    <div class="safe-actions">
      <a href="javascript:history.back()" class="safe-btn">
        <img src="../iconos/atrastransparente.png" class="safe-icon">
      </a>
      <a href="../index.html" class="safe-btn">
        <img src="../iconos/hometransparente.png" class="safe-icon">
      </a>
    </div>
  </div>
</div>

<header>
  <div class="title">
    <img src="cardiopatiasico.png">
    Otras cardiopatías embolígenas
  </div>
</header>

<main class="wrap">



  <!-- ÚNICO BLOQUE -->
  <div class="block" id="patologia-section">
<h3><img src="cardiopatiasico.png" class="icon-h3"> Patología cardíaca embolígena</h3>

    <label><b>Seleccione la entidad principal:</b></label>
    <select id="patologia" onchange="mostrarFactoresPatologia()">
      <option value="" disabled selected>Seleccione una patología…</option>
      <option value="hipertrofica">Miocardiopatía hipertrófica</option>
      <option value="iam">Infarto agudo de miocardio</option>
      <option value="dilatada">Miocardiopatía dilatada</option>
      <option value="isquemica">Miocardiopatía isquémica</option>
      <option value="restrictiva">Miocardiopatía restrictiva</option>
      <option value="tako">Miocardiopatía de Tako-Tsubo</option>
      <option value="mixoma">Mixoma auricular</option>
      <option value="valvular">Prótesis valvulares / Cardiopatía valvular</option>
      <option value="endocarditis">Endocarditis infecciosa</option>
      <option value="sicksinus">Síndrome del seno enfermo</option>
      <option value="auricula">Aurícula izquierda / orejuela</option>
    </select>

    <div id="patologia-factores" style="margin-top:12px;"></div>
</div>



    <div class="block" id="patologia-resultado"><h3>Recomendación</h3></div>

<!-- DISCLAIMER -->
<section class="disclaimer-red">
  <p>
    <b>Advertencia.</b> Esta herramienta tiene carácter orientativo y no sustituye el juicio clínico del profesional ni los protocolos locales.
    Las recomendaciones deben integrarse con la situación individual del paciente, las guías vigentes y la discusión multidisciplinar cuando proceda.
  </p>
</section>

<div id="toast" class="toast"></div>

<script>
/* ============================
   FACTORES POR PATOLOGÍA
=============================== */
const factoresPatologia = {
  hipertrofica: ['FA paroxística'],
  iam: ['IAM anterior extenso', 'FE < 40%', 'Trombo cavitario', 'Ictus periinfarto'],
  dilatada: ['FE ≤ 28%', 'Trombo apical', 'FA concomitante'],
  isquemica: ['Zonas acinéticas o hipocinéticas', 'Trombo mural documentado', 'FE ≤ 35%', 'Antecedente de ictus cardioembólico'],
  restrictiva: ['FA documentada', 'Trombos auriculares', 'Amiloidosis confirmada'],
  tako: ['FA concomitante', 'Trombo ventricular', 'FE < 40%'],
  mixoma: ['Trombo en aurícula', 'Ictus cardioembólico'],
  valvular: ['Válvula mecánica', 'Prótesis Biológica Aórtica (TAVI/Quirúrgica)', 'Prótesis Biológica Mitral/Tricúspide', 'Estenosis mitral moderada-severa', 'FA concomitante', 'Complicaciones tromboembólicas previas'],
  endocarditis: ['Complicaciones neurológicas', 'Aneurismas micóticos'],
  sicksinus: ['FA Paroxística/Crónica documentada', 'Antecedente de ictus/embolia sistémica'],
auricula: [
  'Trombo en aurícula izquierda / orejuela',
  'Estenosis mitral moderada-severa',
  'FA concomitante',
  'Dilatación auricular severa',
  'FEVI < 35%',
  'Ictus cardioembólico previo'
]
};

const patologiaAutoChecks = {
  'Insuficiencia Cardíaca (1 pto)': {cCongest: true},
  'Hipertensión (1 pto)': {cHTN: true},
  'Diabetes (1 pto)': {cDiab: true},
  'Ictus/AIT/TE previo (2 ptos)': {cStroke: true, hStroke: true},
  'Enfermedad Vascular (1 pto)': {cVasc: true},
  'FA paroxística': {cCongest: true}, 
  'FA concomitante': {cCongest: true}, 
  'FA documentada': {cCongest: true}, 
  'FA Paroxística/Crónica documentada': {cCongest: true}, 
  'Ictus periinfarto': {cStroke: true, hStroke: true},
  'Antecedente de ictus cardioembólico': {cStroke: true, hStroke: true},
  'Complicaciones tromboembólicas previas': {cStroke: true, hStroke: true},
};

let autoCheckedState = {};

/* Mostrar/ocultar bloque de escalas según presencia de FA en los factores seleccionados */
function updateEscalasVisibility() {
  const escalasBlock = document.getElementById('escalas-block');
  if (!escalasBlock) return;

  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => (el.value || '').toUpperCase());

  const hasFA = riesgos.some(txt =>
    txt.includes('FA ') || txt.startsWith('FA')
  );

  escalasBlock.style.display = hasFA ? '' : 'none';
}

function aplicarAutoChecks() {
  Object.keys(autoCheckedState).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.checked = false;
  });
  autoCheckedState = {};

  const patologia = document.getElementById("patologia").value;
  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => el.value);

  riesgos.forEach(riesgo => {
    if (patologiaAutoChecks[riesgo]) {
      const targets = patologiaAutoChecks[riesgo];
      for (const id in targets) {
        if (targets[id]) {
          const el = document.getElementById(id);
          if (el) {
            el.checked = true;
            autoCheckedState[id] = true;
          }
        }
      }
    }
  });

  const isValvularForced =
    riesgos.includes('Válvula mecánica') ||
    riesgos.includes('Estenosis mitral moderada-severa') ||
    riesgos.includes('¡AVISO! Valvulopatía mecánica/Estenosis mitral mod-severa (Requiere AVK)');

  const elCondValvular = document.getElementById('condValvular');
  if (elCondValvular) {
    if (isValvularForced) {
      elCondValvular.checked = true;
      autoCheckedState['condValvular'] = true;
    } else {
      elCondValvular.checked = false;
      delete autoCheckedState['condValvular'];
    }
  }

  autoCheckByInputs();
}

function checkAutoCheckedAlarm(controlId) {
  const el = document.getElementById(controlId);
  if (autoCheckedState[controlId] && !el.checked) {
    el.checked = true;
    showToast('⚠️ Esta casilla fue marcada automáticamente por la Patología Embolígena y NO debe desmarcarse (coherencia clínica).', 'warn');
  }
}

document.addEventListener('DOMContentLoaded', () => {
  ['cStroke', 'hStroke', 'condValvular', 'cCongest', 'cHTN', 'cDiab', 'cVasc'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('change', () => checkAutoCheckedAlarm(id));
  });
});

function actualizarPatologia() {
  aplicarAutoChecks();
  updateEscalasVisibility();
  mostrarRecomendacionPatologia(true);
}

function mostrarFactoresPatologia() {
  const div = document.getElementById("patologia-factores");
  const resultadoDiv = document.getElementById("patologia-resultado");
  const patologia = document.getElementById("patologia").value;
  div.innerHTML = "";
  resultadoDiv.innerHTML = "";



  if (factoresPatologia[patologia]) {
    factoresPatologia[patologia].forEach(factor => {
      const label = document.createElement("label");
      label.classList.add("row");
      label.innerHTML = `<input type='checkbox' value="${factor}"> ${factor}`;
      div.appendChild(label);
    });
    document.querySelectorAll("#patologia-factores input[type='checkbox']").forEach(cb => {
      cb.addEventListener('change', actualizarPatologia);
    });
    actualizarPatologia();
  } else {
    aplicarAutoChecks();
    resultadoDiv.textContent = "Seleccione una patología para ver los factores de riesgo específicos.";
    updateEscalasVisibility();
  }
}

function mostrarRecomendacionPatologia(preliminar = false) {
  const patologia = document.getElementById("patologia").value;
  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => el.value);
  const resultadoDiv = document.getElementById("patologia-resultado");
  
  let texto = "", recomendacion = "", fuerza = "INSUFICIENTE";
  let score = 0;
  const isFemale = riesgos.includes('Sexo Femenino (1 pto)');
  riesgos.forEach(r => {
    if (r.includes('2 ptos')) score += 2;
    else if (r.includes('1 pto')) score += 1;
  });

  switch(patologia) {
    case "hipertrofica":
      texto = "<b>Miocardiopatía hipertrófica</b> – Riesgo embólico elevado si coexistencia de FA.";
      if (riesgos.includes("FA paroxística")) {
        recomendacion = "Anticoagulación indefinida (preferiblemente ACOD si no contraindicado), independientemente del CHA₂DS₂-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion = "No se indica anticoagulación si no hay FA.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "iam":
  texto = "<b>Infarto agudo de miocardio</b> – Mayor riesgo embólico si trombo cavitario o ictus periinfarto.";


      const tieneTromboCavitario = riesgos.includes("Trombo cavitario");
      const tieneIctusPeriinfarto = riesgos.includes("Ictus periinfarto");

      // 1️⃣ Ictus periinfarto → anticoagulación TRANSITORIA 3–6 meses
      if (tieneIctusPeriinfarto) {
        recomendacion =
          "Anticoagulación (ACOD o AVK) durante 3–6 meses tras el ictus periinfarto, " +
          "con reevaluación por imagen cardiaca. Si no persiste trombo ni otra fuente cardioembólica, " +
          "no se mantiene anticoagulación indefinida.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";

      // 2️⃣ Trombo cavitario sin ictus periinfarto → también transitoria
      } else if (tieneTromboCavitario) {
        recomendacion =
          "Anticoagulación (ACOD o AVK) 3–6 meses, con control ecocardiográfico hasta la resolución del trombo cavitario.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";

      // 3️⃣ IAM sin trombo ni ictus periinfarto → no AC sistemática
      } else {
        recomendacion =
          "En ausencia de ictus periinfarto o trombo cavitario, no se recomienda anticoagulación sistemática " +
          "por el solo hecho del IAM.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;


    case "dilatada":
  texto = "<b>Miocardiopatía dilatada</b> – Riesgo embólico si trombo apical o FA concomitante.";

  // PRIORIDAD CORRECTA

  // 1️⃣ FA → anticoagulación indefinida
  if (riesgos.includes("FA concomitante")) {
    recomendacion = "Anticoagulación indefinida (ACOD o AVK). ";
    fuerza = "ACODS_PREFERIDOS";

  // 2️⃣ Trombo apical → anticoagulación transitoria
  } else if (riesgos.includes("Trombo apical")) {
    recomendacion = "Anticoagulación (ACOD o AVK) 3–6 meses, con reevaluación por imagen hasta resolución del trombo.";
    fuerza = "ANTICOAGULACION_TRANSITORIA";

  // 3️⃣ Sin FA y sin trombo
  } else {
    recomendacion = "No se indica anticoagulación sistemática sin trombo ni FA.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;


case "isquemica":
      texto = "<b>Miocardiopatía isquémica</b> – Riesgo embólico si hay zonas acinéticas, trombos murales o ictus cardioembólico " +
              "atribuible a una disfunción ventricular persistente.";

      const tieneTromboMural     = riesgos.includes("Trombo mural documentado");
      const tieneFEbaja          = riesgos.includes("FE ≤ 35%");
      const tieneAcinesia        = riesgos.includes("Zonas acinéticas o hipocinéticas");
      const ictusCardioPrevio    = riesgos.includes("Antecedente de ictus cardioembólico");

      // 1️⃣ Trombo mural → anticoagulación TRANSITORIA 3–6 meses
      if (tieneTromboMural) {
        recomendacion =
          "Anticoagulación (AVK o ACOD) durante 3–6 meses, con reevaluación por imagen hasta la resolución del trombo mural. " +
          "Si el trombo desaparece y no hay FA ni otra fuente embólica persistente, no se mantiene anticoagulación indefinida.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";

      // 2️⃣ Ictus cardioembólico + disfunción estructural (FE baja o acinesia) → AC INDEFINIDA
      } else if (ictusCardioPrevio && (tieneFEbaja || tieneAcinesia)) {
        recomendacion =
          "Ictus cardioembólico en el contexto de miocardiopatía isquémica con disfunción ventricular relevante " +
          "(FE ≤35% y/o zonas acinéticas). Recomendable anticoagulación (ACOD o AVK) indefinida como prevención secundaria, " +
          "si no hay contraindicaciones.";
        fuerza = "ACODS_PREFERIDOS";

      // 3️⃣ Ictus cardioembólico pero SIN FE baja ni acinesia → NO justifica AC indefinida
      } else if (ictusCardioPrevio && !tieneFEbaja && !tieneAcinesia) {
        recomendacion =
          "Ictus cardioembólico previo sin disfunción sistólica significativa ni zonas acinéticas demostradas. " +
          "La miocardiopatía isquémica sin alteraciones estructurales relevantes no se considera fuente cardioembólica " +
          "crónica por sí misma. No se recomienda anticoagulación indefinida; debe reevaluarse la etiología (p. ej. ESUS, FA oculta) " +
          "y seguir las guías de ictus criptogénico.";
        fuerza = "NO_ANTICOAGULAR";

      // 4️⃣ Sin trombo ni ictus cardioembólico → no AC sistemática
      } else {
        recomendacion =
          "Sin trombo mural documentado ni ictus cardioembólico atribuible a disfunción ventricular, " +
          "no se indica anticoagulación sistemática en la miocardiopatía isquémica. Manejo habitual con antiagregación " +
          "y tratamiento óptimo de la cardiopatía.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "restrictiva":
      texto = "<b>Miocardiopatía restrictiva</b> – FA y trombos auriculares frecuentes, especialmente en amiloidosis.";
      if (riesgos.includes("FA documentada") || riesgos.includes("Trombos auriculares")) {
        recomendacion = "Anticoagulación (ACOD o AVK) indefinida independientemente del CHA₂DS₂-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion = "Sin FA ni trombos, no se indica anticoagulación sistemática.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "tako":
      texto = "<b>Miocardiopatía de Tako-Tsubo</b> – Riesgo embólico bajo; individualizar.";
      if (riesgos.includes("FA concomitante")) {
        recomendacion = "Anticoagulación indefinida (ACOD o AVK) independientemente del CHA₂DS₂-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (riesgos.includes("Trombo ventricular")) {
        recomendacion = "Anticoagulación (AVK o ACOD) 3 meses o hasta resolución del trombo.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else {
        recomendacion = "No se recomienda anticoagulación por defecto; valorar si persiste disfunción grave.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "mixoma":
      texto = "<b>Mixoma auricular</b> – Riesgo embólico relevante; indicación principal: cirugía.";
      if (riesgos.includes("Ictus cardioembólico") || riesgos.includes("Trombo en aurícula")) {
        recomendacion = "Anticoagulación (preferiblemente AVK, pudiendo valorar ACOD) transitoria hasta la resección quirúrgica.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else {
        recomendacion = "Sin ictus ni trombo visible, se prioriza la cirugía; anticoagulación no sistemática.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

   case "valvular":
  texto = "<b>Patología valvular / Prótesis valvulares</b> – Riesgo embólico variable según tipo de válvula y presencia de FA.";

  const hasFAv = riesgos.includes("FA concomitante") || riesgos.includes("FA documentada") || riesgos.includes("FA Paroxística/Crónica documentada");
  const hasTEPrevio = riesgos.includes("Complicaciones tromboembólicas previas");

  const isMecánica = riesgos.includes("Válvula mecánica");
  const isEM_MS = riesgos.includes("Estenosis mitral moderada-severa");
  const isBioMitral = riesgos.includes("Prótesis Biológica Mitral/Tricúspide");
  const isBioAortica = riesgos.includes("Prótesis Biológica Aórtica (TAVI/Quirúrgica)");

  // ============================================================
  // 1️⃣ VÁLVULA MECÁNICA → AVK SIEMPRE (ACOD CONTRAINDICADOS)
  // ============================================================
  if (isMecánica) {
    recomendacion =
      "Anticoagulación de por vida con AVK (INR según posición y tipo de prótesis). " +
      "Los ACOD están contraindicados en válvulas mecánicas.";
    fuerza = "VKA_OBLIGATORIO";
    break;
  }

  // ============================================================
  // 2️⃣ ESTENOSIS MITRAL MODERADA-SEVERA (RMS/EM-MS)
  // ============================================================
  if (isEM_MS) {
    if (hasFAv || hasTEPrevio) {
      recomendacion =
        "Anticoagulación indefinida con AVK. " +
        "Los ACOD están contraindicados en estenosis mitral moderada-severa con FA.";
      fuerza = "VKA_OBLIGATORIO";
    } else {
      recomendacion =
        "En estenosis mitral moderada-severa en ritmo sinusal, no se recomienda anticoagulación sistemática. " ;
      fuerza = "ANTIAGREGACION_PREFERIDA";
    }
    break;
  }

  // ============================================================
  // 3️⃣ PRÓTESIS BIOLÓGICA MITRAL O TRICÚSPIDE
  // ============================================================
  if (isBioMitral) {
    if (hasFAv || hasTEPrevio) {
      recomendacion =
        "Anticoagulación indefinida (ACOD o AVK) por presencia de FA o eventos tromboembólicos previos.";
      fuerza = "ACODS_PREFERIDOS";
    } else {
      recomendacion =
        "Anticoagulación con AVK o ACOD durante 3–6 meses tras el implante (especialmente si posición mitral). " +
        "Después, AAS en monoterapia si ritmo sinusal. " +
        "En prótesis tricúspide aislada, suele ser suficiente AAS desde el inicio.";
      fuerza = "";
    }
    break;
  }

  // ============================================================
  // 4️⃣ PRÓTESIS BIOLÓGICA AÓRTICA (TAVI o quirúrgica)
  // ============================================================
  if (isBioAortica) {
    if (hasFAv || hasTEPrevio) {
      recomendacion =
        "Anticoagulación indefinida (ACOD o AVK) por presencia de FA o eventos tromboembólicos previos.";
      fuerza = "ACODS_PREFERIDOS";
    } else {
      recomendacion =
        "AAS en monoterapia como estrategia estándar. " +
        "La DAPT solo está indicada si existe un stent coronario implantado < 3 meses; no por la TAVI en sí.";
      fuerza = "ANTIAGREGACION_PREFERIDA";
    }
    break;
  }

  // ============================================================
  // 5️⃣ RESTO DE CARDIOPATÍA VALVULAR NO PRINCIPAL
  // ============================================================
  if (hasFAv) {
    recomendacion =
      "Anticoagulación (ACOD o AVK) según CHA₂DS₂-VASc, por la presencia de FA en el contexto de valvulopatía no mecánica.";
    fuerza = "ACODS_PREFERIDOS";
  } else {
    recomendacion =
      "Sin FA ni prótesis mecánica, no se recomienda anticoagulación sistemática. " +
      "Suele bastar antiagregación (AAS) o vigilancia clínica.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;


case "endocarditis":
  texto = "<b>Endocarditis infecciosa</b> – Riesgo extremadamente alto de hemorragia intracraneal, incluso en ictus isquémicos.";

  const neuro = riesgos.includes("Complicaciones neurológicas");
  const micoticos = riesgos.includes("Aneurismas micóticos");

  if (neuro || micoticos) {
    recomendacion =
      "Evitar anticoagulación. Suspender AVK/ACOD si estaban en uso salvo indicación absolutamente imprescindible (p. ej., válvula mecánica). " +
      "Tras un ictus isquémico en el contexto de endocarditis, la anticoagulación aumenta el riesgo de transformación hemorrágica y de ruptura de aneurismas micóticos. " +
      "Reevaluación tras 1–2 semanas y tras neuroimagen de control.";
    fuerza = "NO_ANTICOAGULAR";

  } else {
    recomendacion =
      "No se recomienda anticoagulación durante la endocarditis activa salvo indicación esencial (p. ej., válvula mecánica). " +
      "Decisión a individualizar en equipo multidisciplinar.";
    fuerza = "NO_ANTICOAGULAR";
  }

  break;


case "sicksinus":
  texto = "<b>Síndrome del seno enfermo</b> – La FA puede ser paroxística u oculta; la estratificación de riesgo sigue el CHA₂DS₂-VASc.";
 
 // 2️⃣ ICTUS CARDIOEMBÓLICO PREVIO (sin FA documentada)
  if (riesgos.includes("Antecedente de ictus/embolia sistémica")) {

    recomendacion =
      "Anticoagulación indefinida (ACOD o AVK). Incluso en ausencia de FA documentada, un ictus cardioembólico en contexto de SSE es altamente sugestivo de FA oculta.";
    fuerza = "ACODS_PREFERIDOS";

  }

  // 1️⃣ FA DOCUMENTADA → AC según CHA₂DS₂-VASc
  else if (riesgos.includes("FA Paroxística/Crónica documentada")) {

    recomendacion =
      "Anticoagulación si el CHA₂DS₂-VASc lo indica. En el SSE la FA suele ser intermitente, por lo que debe evaluarse el riesgo embólico real mediante la escala.";
    fuerza = "ACODS_PREFERIDOS";

  }

  // 3️⃣ SIN FA NI ICTUS → no AC
  else {

    recomendacion =
      "No se recomienda anticoagulación en ausencia de FA documentada o ictus cardioembólico previo. Se aconseja monitorización prolongada por riesgo de FA silente.";
    fuerza = "NO_ANTICOAGULAR";

  }
  break;


case "auricula":
  texto = "<b>Aurícula izquierda / orejuela</b> – El riesgo embólico depende de la presencia de trombo, valvulopatía mitral, FA y del remodelado auricular.";

  const tieneTrombo = riesgos.includes("Trombo en aurícula izquierda / orejuela");
  const estenosisMitral = riesgos.includes("Estenosis mitral moderada-severa");
  const tieneFA = riesgos.includes("FA concomitante");
  const dilatacionSevera = riesgos.includes("Dilatación auricular severa");
  const feviBaja = riesgos.includes("FEVI < 35%");
  const ictusPrevio = riesgos.includes("Ictus cardioembólico previo");

  // 1️⃣ ESTENOSIS MITRAL → AVK siempre
  if (estenosisMitral) {
    recomendacion =
      "Anticoagulación obligatoria con AVK (ACOD contraindicados). Si existe trombo, mantener AVK y realizar control por imagen hasta su resolución.";
    fuerza = "VKA_OBLIGATORIO";
  }

  // 2️⃣ FA CONCOMITANTE → INDICACIÓN ABSOLUTA
  else if (tieneFA) {
    recomendacion =
      "Anticoagulación indefinida (ACOD o AVK). La FA implica estasis auricular y riesgo cardioembólico incluso sin trombo visible.";
    fuerza = "ACODS_PREFERIDOS";
  }

  // 3️⃣ TROMBO DOCUMENTADO (sin EM y sin FA)
  else if (tieneTrombo) {
    recomendacion =
      "Anticoagulación 3–6 meses (ACOD o AVK) con control por imagen hasta resolución. Tras la resolución, individualizar si mantener antiagregación o suspender.";
    fuerza = "ANTICOAGULACION_TRANSITORIA";
  }

  // 4️⃣ Aurícula muy enferma sin trombo
  else if (dilatacionSevera && feviBaja) {
    recomendacion =
      "Considerar anticoagulación (ACOD o AVK) por alto riesgo embólico asociado a dilatación severa y FEVI <35%, especialmente si sospecha de FA subclínica.";
    fuerza = "CONSIDERAR_ACOD";
  }

  // 5️⃣ Ictus previo embólico atribuible a aurícula
  else if (ictusPrevio) {
  recomendacion =
    "Ictus cardioembólico previo. Sin FA, trombo o estenosis mitral moderada–severa, no se indica anticoagulación indefinida. Reevaluar etiología y monitorizar FA oculta.";
  fuerza = "NO_ANTICOAGULAR";
}


  // 6️⃣ Caso basal (sin nada relevante)
  else {
    recomendacion =
      "Sin trombo, sin FA y sin valvulopatía mitral significativa, no se recomienda anticoagulación sistemática.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;




    default:
      texto = "Seleccione una patología.";
      recomendacion = "A la espera de selección y factores de riesgo.";
      fuerza = "INSUFICIENTE";
  }
// === COLETILLA SEGÚN FUERZA ===
let coletilla = "";

switch (fuerza) {
  case "ACODS_PREFERIDOS":
    coletilla = " ACOD preferidos por mejor perfil eficacia/seguridad.";
    break;
  case "ANTICOAGULACION_TRANSITORIA":
    coletilla = " Anticoagulación temporal con reevaluación por imagen.";
    break;
  case "VKA_OBLIGATORIO":
    coletilla = " ACOD contraindicados: solo AVK.";
    break;
  case "NO_ANTICOAGULAR":
    coletilla = " No se recomienda anticoagulación.";
    break;
  case "ANTIAGREGACION_PREFERIDA":
    coletilla = " Antiagregación según perfil clínico.";
    break;
}



// Añadir coletilla al texto de recomendación
recomendacion += coletilla;

  const resumen = riesgos.length > 0 ? riesgos.join(", ") : "Ninguno";
  resultadoDiv.innerHTML = `${texto}<br><b>Factores de riesgo presentes:</b> ${resumen}.<br><b>Recomendación orientativa:</b> ${recomendacion}`;

/* ============================
   RECOMENDACIÓN PRINCIPAL
=============================== */
resultadoDiv.classList.remove("fade-in");
void resultadoDiv.offsetWidth; // Forzar repaint
resultadoDiv.classList.add("fade-in");


  const patTxt = patologia === "" ? "No seleccionada" : texto.replace(/<\/?b>/g, '');
  document.getElementById('patologia-rec-final').innerHTML =
    `<b>Patología:</b> ${patTxt}<br><b>Recomendación:</b> ${recomendacion}`;

  return {fuerza, recomendacion};
}



/* ============================
   MOSTRAR FACTORES
=============================== */
function mostrarFactoresPatologia() {
  const div = document.getElementById("patologia-factores");
  const res = document.getElementById("patologia-resultado");
  const p = document.getElementById("patologia").value;

  div.innerHTML = "";
  res.innerHTML = "";

  if (!p) return;

  factoresPatologia[p].forEach(f => {
    const l = document.createElement("label");
    l.classList.add("row");
    l.innerHTML = `<input type="checkbox" value="${f}"> ${f}`;
    div.appendChild(l);
  });

  document.querySelectorAll("#patologia-factores input")
    .forEach(cb => cb.addEventListener("change", () => mostrarRecomendacionPatologia()));

  mostrarRecomendacionPatologia();
}





</script>


</main>

<footer>
  <img src="uibanner.png" alt="Unidad de Ictus Málaga">
</footer>

</body>
</html>
