<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="../site.webmanifest">
    <link rel="icon" type="image/png" sizes="192x192"
      href="../iconos/ictusgps.png">
    <link rel="apple-touch-icon" sizes="180x180"
      href="../iconos/ictusgps.png">
    <link rel="shortcut icon" href="../iconos/ictusgps.png">
    <meta name="theme-color" content="#0f3d83">
    <title>Fibrilaci√≥n Auricular</title>
    <style>

/* =========================================================
   VARIABLES GLOBALES
========================================================= */
:root{
  --bg:#f8fafc; 
  --ink:#0e1a33;

  --azul:#0f3d83;
  --azul-institucional:#0f3d83;

  --accent-dark:#0f3d83;
  --accent-light:#2563eb;

  --border:#e5e9f2;
  --muted:#64748b;

  --ok:#166534;
  --ok-bg:#e9fce7;
  --ok-ring:#bbf7d0;

  --mid:#92400e;
  --mid-bg:#fff7ed;
  --mid-ring:#fed7aa;

  --bad:#991b1b;
  --bad-bg:#fef2f2;
  --bad-ring:#fecaca;

  --gris:#6b7280;
  --borde:#e5e7eb;
  --error:#b91c1c;
}
*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--ink);
  font-family: Verdana, Geneva, Tahoma, sans-serif
}
.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:.2rem;
}
/* =========================================================
   SAFE-TOP (FIJO 60 px + notch)
========================================================= */
.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top) + 60px);
  background: var(--azul-institucional);
  z-index: 1001;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: env(safe-area-inset-top);
}

.safe-content{
  width:100%;
  max-width:1080px;
  padding: 6px 16px 8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.safe-left{
  display:flex;
  align-items:center;
  gap:10px;
}

.safe-mini{
  width:44px;
  height:44px;
  object-fit:contain;
  padding:4px;
  box-shadow:0 0 4px rgba(0,0,0,0.1);
}

.safe-logo{
  height:44px;
  width:auto;
}

.safe-actions{
  display:flex;
  gap:10px;
}

.safe-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
  background:rgba(255,255,255,0.15);
  border:1px solid white;
  border-radius:50%;
  transition:background .25s, border-color .25s, transform .1s;
}

.safe-btn:hover{
  background:#01c5fe;
}

.safe-btn:active{
  transform:scale(0.95);
}

.safe-icon{
  width:32px; 
  height:32px;
  object-fit:contain;
}

/* =========================================================
   CABECERA STICKY
========================================================= */
header{
  position:sticky;
  top:calc(env(safe-area-inset-top) + 52px);
  z-index:1002;
  backdrop-filter:blur(6px);
  background:var(--azul-institucional);
  border-bottom:1px solid rgba(255,255,255,.08);
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  color:#fff;
}

.bar{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  height:52px;
  padding:0 16px;
}

.title{
  display:flex;
  align-items:center;
  font-size:1.4rem;
  font-weight:700;
  color:#fff;
}

.title img{
  width:32px;
  height:32px;
  margin-right:8px;
}
/* =========================================================
   TIPOGRAF√çA Y TARJETAS
========================================================= */
html,body,.wrap,.card,label,input,select,button,table,p,h1,h2,h3,li{
  font-family:Verdana,Geneva,sans-serif!important;
}

.howto{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 2px 2px var(--muted);
  padding:1rem;
  margin:.3rem 0 1rem;
  font-size:14px;
}
.card{
  background:#eff6ff;
  border-radius:14px;
  border-left:4px solid var(--azul-institucional);
  box-shadow:0 3px 14px rgba(16,71,119,.12);
  padding:16px;
  margin:12px 0;
}

.card-result{
  background:#fff;
  border-left:4px solid #10b981;
  border-radius:14px;
  box-shadow:0 3px 14px rgba(16,71,119,.12);
  padding:16px;
  margin:12px 0;
}

.grid{display:grid; gap:12px;}
.g-2{grid-template-columns:repeat(auto-fit,minmax(260px,1fr));}
.g-3{grid-template-columns:repeat(auto-fit,minmax(40%,1fr));}
/* Grid espec√≠fico para los datos del paciente */
@media (min-width: 900px){
  .patient-grid{
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

label{font-weight:600;font-size:.92rem;color:#0f3f66;display:block;margin-bottom:6px;}
label.row{font-weight:400;}
.row{display:flex;gap:8px;align-items:center;margin:4px 0;}

input[type="number"],select{
  width:100%;
  box-sizing:border-box;
  border:1px solid #cfe3f6;
  background:#fff;
  border-radius:10px;
  padding:10px 12px;
  font-size:1rem;
}

small.hint{color:#345;opacity:.8;}

.btnbar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:8px;
  align-items:center;
}

button{
  border:0;
  border-radius:999px;
  padding:10px 16px;
  font-weight:700;
  cursor:pointer;
  line-height:1;
  flex:0 0 auto;
}

.primary{background:#0f3d83;color:#fff;}
.primary:hover {background:#fff;color:#0f3d83;border:2px solid #0f3d83;}

.ghost{background:#fff;color:#0f3d83;border:2px solid #0f3d83;}
.ghost:hover {background:#0f3d83;color:#fff;border:2px solid #0f3d83;}

/* =========================================================
   TABLAS / PILLS / RESULTADOS
========================================================= */
table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;font-size:.95rem;}
th,td{padding:6px;border-bottom:1px solid #e8f2fb;text-align:left;vertical-align:top;}
thead th{background:#eef6ff;color:#0b4576;font-size:.9rem;}
tfoot td{background:#f3f9ff;}

.muted{color:#567;}
.pill{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:700;font-size:.8rem;}
.ok{background:#e8f5e9;color:#1b5e20;}
.okr{background:#ffcccc;color:#660000;}
.okb{background:#0f3d83;color:#ffffff;}
.bad{background:#ffebee;color:#b71c1c;}
.note{font-size:.86rem;color:#456;}
.center{text-align:center;}
.subtle{color:#345;opacity:.85;}
.subtle2{background:#fff5f5;color:#660000;opacity:.85;}
.sticky-result{position:relative}
.result-anchor{scroll-margin-top:120px}

.sep{height:1px;background:#e7f0fb;margin:14px 0;}

.inlineSelect{display:flex;gap:8px;}
.unit{width:44%;}
.val{flex:1;}
/* Mejores opciones */
    #comparative tbody tr.best td{background:#e8f5e9}
    #comparative tbody tr.best td:first-child{border-left:4px solid var(--ok);font-weight:700}
    /* Adecuaci√≥n cl√≠nica */
    .tagPref{background:#e8f5e9;color:#1b5e20;border:1px solid #b7dfbf}
    .tagAvoid{background:#ffebee;color:#b71c1c;border:1px solid #f3c5c8}
    .tagNeutral{background:#eef6ff;color:#0b4576;border:1px solid #cfe3f6}
    .rec-list li{margin:4px 0}
    .list-min{padding-left:16px;margin:0}
    .doseTag{background:#fff4ce;color:#7a4e00;border:1px solid #ffe08a;padding:2px 8px;border-radius:999px;font-weight:700;font-size:.8rem}
    .noOac{color:#b71c1c;font-weight:800}

/* Columnas visibles */
#comparative tbody td._zebra{background:#eef6ff;}
@media (max-width:640px){
  .col-rra,.col-rrs{display:none;}
}




/* Toast */
.toast{
  position:fixed;
  top: calc(env(safe-area-inset-top) + 104px);
  left:50%;
  transform:translateX(-50%) translateY(-10px);
  width:calc(100% - 32px);
  max-width:680px;
  text-align:center;
  background:#b71c1c;
  border-radius:5px;
  color:#fff;
  padding:10px;
  box-shadow:0 6px 24px rgba(0,0,0,.18);
  opacity:0;
  pointer-events:none;
  z-index:1003;
  transition:opacity .25s,transform .25s;
  font-weight:600;
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}.toast.warn{background:#f57c00;}
.toast.info{background:#1976d2;}

/* CABECERA DEL GLOSARIO */
.glosario-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  padding:4px 0;
}

.arrow{
  font-size:1.1rem;
  transition:transform 0.25s ease;
  color:#0f3d83;
}

/* CONTENIDO COLAPSABLE */
.glosario-content{
  max-height:0;
  font-size:0.65rem;
  overflow:hidden;
  transition:max-height 0.35s ease, padding 0.3s ease;
  padding-top:0;
}
.glosario-content.open{
  padding-top:10px;
}

.glosario-grid{
  list-style:none;
  margin:0;
  padding-left:0;
  display:grid;
  grid-template-columns:1fr;
  gap:6px 20px;
}

.glosario-grid li{
  padding:2px 0;
}

/* En pantallas grandes ‚Üí 2 columnas */
@media(min-width:700px){
  .glosario-grid{
    grid-template-columns:1fr 1fr;
  }
}


.biblio-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  padding:4px 0;
}

.biblio-content {
  max-height: 0;
  overflow-y: hidden;
  margin-top: 10px;
  padding: 0px;
  font-size:0.65rem;
  transition:max-height 0.35s ease, padding 0.3s ease;
}

.biblio-content.open{
  padding-top:10px;
}



    .back-btn{display:inline-block;margin:1.5rem auto 0;background:#0f3d83;color:#fff;text-decoration:none;font-weight:700;padding:.7rem 1.4rem;border-radius:10px;box-shadow:0 4px 10px rgba(15,61,131,.25);transition:background .2s,transform .1s,box-shadow .2s}
    .back-btn:hover{background:#1c60c3;transform:translateY(-1px);box-shadow:0 6px 12px rgba(15,61,131,.35)}

/* Disclaimer renal */
.renal-disclaimer{
  background:#f8fbff;
  border:1px solid #e3eef9;
  border-left:4px solid #1976d2;
  border-radius:12px;
  padding:10px 12px;
  margin:10px 0 0 0;
}
.renal-disclaimer b{color:#0b4576;}

/* =========================================================
   FOOTER
========================================================= */
/* Pie */
footer{
  width:100%;
  margin:2rem 0 0;
  padding:1.5rem 0;
  border-top:1px solid #e5e7eb;
  background:#ffffff;
  text-align:center;
  box-shadow:0 -2px 6px rgba(0,0,0,0.04);
}
footer img{max-width:320px;height:auto;opacity:.95}


/* =========================================================
   MEDIA QUERIES
========================================================= */
@media(max-width:768px){
  header{font-size:1.05rem;}
  main{padding:0.9rem 1rem;}
  body{font-size:0.96rem;}
}

/* =========================================================
   PADDING SUPERIOR DEL CONTENIDO
========================================================= */

/* Empuja el contenido real por debajo de la barra superior */
body {
  margin: 0;
  padding-top: calc(env(safe-area-inset-top, 0px) + 52px);
  background-color: #fff;
}
</style>
  </head>
  <body>
    <!-- SAFE-TOP -->
    <div class="safe-top">
      <div class="safe-content">
        <div class="safe-left"> <img src="../iconos/utilidadesico.png"
            class="safe-mini" alt=""> <img src="../img/topbar.png"
            class="safe-logo" alt="IctusGPS"> </div>
        <div class="safe-actions"> <a href="javascript:history.back()"
            class="safe-btn"> <img
              src="../iconos/atrastransparente.png" class="safe-icon"> </a>
          <a href="../index.html" class="safe-btn"> <img
              src="../iconos/hometransparente.png" class="safe-icon"> </a>
        </div>
      </div>
    </div>
    <!-- CABECERA -->
    <header>
      <div class="bar">
        <div class="title"> <img src="../iconos/anticoagulacion.png"
            alt=""> Fibrilaci√≥n auricular </div>
      </div>
    </header>
    <div class="wrap">
      <div class="howto">
        <p class="note" align="justify"><b>C√≥mo usar:</b> introduce los
          datos del paciente, marca los <b>factores de riesgo</b>, las
          <b>condiciones cl√≠nicas especiales</b> y las <b>interacciones
            farmacol√≥gicas</b> y pulsa <span class="pill okb">Calcular</span>.
          Calcula <b>CHA<sub>2</sub>DS<sub>2</sub>-VASc</b>, <b>CHA<sub>2</sub>DS<sub>2</sub>-VA</b>,
          <b>HAS-BLED</b>, <b>ClCr (Cockcroft‚ÄìGault)</b> y muestra
          comparativa de eficacia/seguridad. Aplica reglas de <span
            class="pill ok">preferencia</span>üÜö<span class="pill okr">evitaci√≥n</span>
          por escenarios cl√≠nicos y sugiere posolog√≠a resaltando la <span
            class="doseTag">dosis reducida</span> cuando proceda. </p>
      </div>
      <!-- Datos del paciente -->
      <div class="card">
        <h2 style="margin:0 0 8px;">Datos del paciente</h2>
        <div class="grid g-2 patient-grid">
          <div> <label for="age">Edad (a√±os)</label> <input id="age"
              inputmode="numeric" max="110" min="18" placeholder="p.
              ej., 74" type="number"> </div>
          <div> <label for="sex">Sexo</label>
            <select id="sex">
              <option value="" selected="selected">Selecciona‚Ä¶</option>
              <option value="M">Var√≥n</option>
              <option value="F">Mujer</option>
            </select>
          </div>
          <div> <label for="weight">Peso</label>
            <div class="inlineSelect"> <input class="val" id="weight"
                max="400" min="10" placeholder="p. ej., 84.5" step="0.1"
                type="number">
              <select class="unit" id="weightUnit">
                <option value="kg" selected="selected">kg</option>
                <option value="lb">lb</option>
              </select>
            </div>
          </div>
          <div> <label for="scr">Creatinina s√©rica</label>
            <div class="inlineSelect"> <input class="val" id="scr"
                max="15" min="0.1" placeholder="p. ej., 1.1" step="0.01"
                type="number">
              <select class="unit" id="scrUnit">
                <option value="mgdl" selected="selected">mg/dL</option>
                <option value="umol">¬µmol/L</option>
              </select>
            </div>
          </div>
        </div>
        <div class="sep"></div>
        <div class="grid g-2">
          <div> <label>CHA<sub>2</sub>DS<sub>2</sub>-VA/CHA<sub>2</sub>DS<sub>2</sub>-VASc</label>
            <label class="row" for="cSc"><input id="cSc" type="checkbox">
              Sexo femenino</label> <label class="row" for="cAge65"><input
                id="cAge65" type="checkbox"> Edad 65‚Äì74 a√±os</label> <label
              class="row" for="cAge75"><input id="cAge75"
                type="checkbox"> Edad ‚â• 75 a√±os (2 pt)</label> <label
              class="row" for="cCongest"><input id="cCongest"
                type="checkbox"> Insuficiencia cardiaca / disfunci√≥n VI</label>
            <label class="row" for="cStroke"><input id="cStroke"
                type="checkbox"> Ictus/AIT/TE previo (2 pt)</label> <label
              class="row" for="cHTN"><input id="cHTN" type="checkbox">
              Hipertensi√≥n</label> <label class="row" for="cDiab"><input
                id="cDiab" type="checkbox"> Diabetes</label> <label
              class="row" for="cVasc"><input id="cVasc" type="checkbox">
              Vascular (IAM, placa Ao, EAP)</label> </div>
          <div> <label>HAS-BLED</label> <label class="row" for="hHTN"><input
                id="hHTN" type="checkbox"> HTA (&gt;160 mmHg sist.)</label>
            <label class="row" for="hRenal"><input id="hRenal"
                title="Autorrelleno si SCr ‚â•2.26 mg/dL (~200 ¬µmol/L) o
                ClCr &lt;30 ml/min" type="checkbox"> Disfunci√≥n renal
              (incluye trasplante)</label> <label class="row"
              for="hLiver"><input id="hLiver" type="checkbox">
              Disfunci√≥n hep√°tica</label> <label class="row"
              for="hStroke"><input id="hStroke" type="checkbox"> Ictus
              previo</label> <label class="row" for="hBleed"><input
                id="hBleed" type="checkbox"> Sangrado mayor/di√°tesis</label>
            <label class="row" for="hLabileINR"><input id="hLabileINR"
                type="checkbox"> INR l√°bil (si en VKA)</label> <label
              class="row" for="hElder"><input id="hElder"
                title="Autorrelleno si edad &gt;65 a√±os" type="checkbox">
              Edad &gt;65</label> <label class="row" for="hDrugs"><input
                id="hDrugs" type="checkbox"> F√°rmacos (antiagregantes,
              AINEs...)</label> <label class="row" for="hAlcohol"><input
                id="hAlcohol" type="checkbox"> Alcohol</label> </div>
        </div>
        <div class="sep"></div>
        <h3 style="margin:0 0 6px;">Condiciones cl√≠nicas especiales</h3>
        <div class="grid g-2">
          <div> <label class="row"><input id="condICHrisk"
                type="checkbox"> Alto riesgo/antecedente de hemorragia
              intracraneal</label> <label class="row"><input
                id="condICHprev" type="checkbox"> Angiopat√≠a amiloide
              cerebral</label> <label class="row"><input
                id="condGIbleed" type="checkbox"> Antecedente de
              hemorragia digestiva severa</label> <label class="row"><input
                id="condOncoGI" type="checkbox"> Neoplasia GI/GU activa</label>
            <label class="row"><input id="condCirrhosis" type="checkbox">
              Hepatopat√≠a avanzada (Child-Pugh B‚ÄìC)</label> <label
              class="row"><input id="condNoOACabs" type="checkbox">
              Riesgo hemorr√°gico inaceptable/contraindicaci√≥n absoluta a
              ACO</label> <label class="row"><input id="condLAAprog"
                type="checkbox"> Centro con programa de cierre de
              orejuela (o derivaci√≥n posible)</label> </div>
          <div> <label class="row"><input id="condValvular"
                type="checkbox"> Pr√≥tesis valvular mec√°nica o EM
              reum√°tica significativa</label> <label class="row"><input
                id="condDysphagia" type="checkbox">
              Disfagia/administraci√≥n por SNG</label> <label
              class="row"><input id="condObesity" title="Autorrelleno si
                peso &gt;120 kg (o IMC &gt;40, si disponible)"
                type="checkbox"> Obesidad m√≥rbida (IMC &gt;40 o &gt;120
              kg)</label> <label class="row"><input id="condPolypharm"
                type="checkbox"> Polimedicaci√≥n/intolerancia a
              interacciones</label><label class="row"><input
                id="condPoorINR" type="checkbox"> Dificultad para
              monitorizar INR/visitas</label> <label class="row"><input
                id="condQD" type="checkbox"> Preferencia por dosis √∫nica
              diaria</label></div>
        </div>
        <div class="sep"></div>
        <h3 style="margin:0 0 6px;">Interacciones farmacol√≥gicas</h3>
        <div class="grid g-2">
          <div>
            <!-- INHIBIDOR P-gp --> <label class="row"> <input
                id="condPgp" type="checkbox"> <span> Inhibidor potente
                de P-gp <span style="font-size:12px; color:#64748b;">
                  (verapamilo, dronedarona, quinidina, amiodarona,
                  diltiazem, ketoconazol, itraconazol, posaconazol,
                  ciclosporina, tacrolimus, ritonavir) </span> </span>
            </label>
            <!-- INDUCTOR P-gp --> <label class="row"> <input
                id="condPgInd" type="checkbox"> <span> Inductor potente
                de P-gp <span style="font-size:12px; color:#64748b;">
                  (rifampicina, carbamazepina, fenito√≠na, fenobarbital,
                  primidona, Hierba de San Juan) </span> </span> </label>
            <!-- INHIBIDOR CYP3A4 --> <label class="row"> <input
                id="condCYPinh" type="checkbox"> <span> Inhibidor
                potente de CYP3A4 <span style="font-size:12px;
                  color:#64748b;"> (ketoconazol, itraconazol,
                  posaconazol, voriconazol, claritromicina, inhibidores
                  de proteasa, cobicistat) </span> </span> </label>
            <!-- INDUCTOR CYP3A4 --> <label class="row"> <input
                id="condCYPind" type="checkbox"> <span> Inductor
                potente de CYP3A4 <span style="font-size:12px;
                  color:#64748b;"> (rifampicina, carbamazepina,
                  fenito√≠na, fenobarbital, primidona, Hierba de San
                  Juan) </span> </span> </label>
          </div>
        </div>
        <br>
        <div class="button"> <button type="button" class="primary"
            id="btnCalc">Calcular</button> <button type="button"
            class="primary" id="btnReset">Borrar</button> <span
            aria-live="polite" role="status" class="muted" id="calcMsg"></span>
        </div>
      </div>
      <!-- Resultados -->
      <div class="card-result sticky-result result-anchor"
        id="resultCard">
        <h2 style="margin:0 0 8px;">Resultados</h2>
        <div class="grid g-3">
          <div>
            <div><b>CHA<sub>2</sub>DS<sub>2</sub>-VA</b>: <span
                class="pill ok" id="scoreVA">‚Äì</span></div>
            <div><b>HAS-BLED</b>: <span class="pill ok"
                id="scoreHASBLED">‚Äì</span></div>
            <div class="muted"><small>CHA<sub>2</sub>DS<sub>2</sub>-VASc:

                <span id="scoreVASc">‚Äì</span></small></div>
            <div><b>ClCr:</b> <span id="crcl">‚Äì</span> ml/min</div>
            <small> </small>
            <div class="muted"><small>(SCr: <span id="scrConv">‚Äì</span>
                mg/dL)</small></div>
          </div>
          <div>
            <div><b>RI: <span class="pill okr"><span id="annualStroke">‚Äì</span>%</span></b>
              <span class="muted"><small>‚ö†Ô∏è Riesgo anual de ictus en
                  pacientes no anticoagulados</small></span></div>
            <div><b>RS: <span class="pill okr"><span id="annualBleed">‚Äì</span>%</span></b>
              <span class="muted"><small>‚ö†Ô∏è Riesgo anual de sangrado
                  mayor en pacientes con FA y VKA</small></span></div>
          </div>
        </div>
        <div class="sep"></div>
        <h3 style="margin:0 0 6px;">Comparativa de estrategias</h3>
        <table id="comparative">
          <thead> <tr>
              <th>Estrategia</th>
              <th class="right">RI</th>
              <th class="right">RRR</th>
              <th class="right col-rra">RRA</th>
              <th class="right">NNT</th>
              <th class="right">RS</th>
              <th class="right col-rrs">RRS</th>
              <th class="right">NNH</th>
              <th class="right">Adecuaci√≥n cl√≠nica</th>
            </tr>
          </thead> <tbody>
          </tbody> <tfoot> <tr>
              <td class="subtle" colspan="9"><b>RI</b>=riesgo anual de
                ictus; <b>RRR</b>=reducci√≥n relativa de riesgo; <b>RRA</b>=reducci√≥n

                absoluta de riesgo;<b>NNT</b>=n¬∫ necesario a tratar; <b>RS</b>=riesgo

                anual de sangrado mayor; <b>RRS</b>=riesgo relativo de
                sangrado vs VKA; <b>NNH</b>=n¬∫ necesario para da√±ar.</td>
            </tr>
            <tr>
              <td class="subtle2" colspan="9"><b>Nota:</b> coeficientes
                orientativos; adapta a tus fuentes.</td>
            </tr>
          </tfoot>
        </table>
        <div class="sep"></div>
        <h3 style="margin:0 0 6px;">Recomendaciones individualizadas</h3>
        <ul id="recList" class="rec-list list-min">
        </ul>
        <div class="sep"></div>
        <div id="doseSection">
          <h3 style="margin:0 0 6px;">Posolog√≠a sugerida seg√∫n datos
            introducidos</h3>
          <ul id="doseList" class="rec-list list-min">
          </ul>
        </div>
        <div class="btnbar"> <button type="button" class="ghost"
            id="btnPrint" disabled="disabled">Imprimir informe</button>
          <button type="button" class="ghost" id="btnCopy"
            disabled="disabled">Copiar informe</button> <button
            type="button" class="ghost" id="btnResetResults">Borrar</button>
        </div>
      </div>
      <app-disclaimer data-target="#resultCard" data-position="after"
        data-when="visible" data-version="1.0" data-context="FA no
        valvular ‚Äî Anticoagulaci√≥n"> </app-disclaimer>
      <!-- Toast -->
      <div id="toast" class="toast" role="alert" aria-live="assertive"></div>
      <script>
    /* ===== Utilidades ===== */
    const NDASH='‚Äî';
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    const fmt=(x,d=1)=>isFinite(x)?(+x).toFixed(d):NDASH;
    const oneIn=pct=>{const p=parseFloat(pct);if(!isFinite(p)||p<=0)return NDASH;return Math.round(100/p);};
    const scrollToResult=()=>{const el=document.getElementById('resultCard');if(el)el.scrollIntoView({behavior:'smooth',block:'start'});};
    let _toastTimer=null;
    function decodeEntities(str){const ta=document.createElement('textarea');ta.innerHTML=String(str);return ta.value;}
    function escAttr(s){return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
    function showToast(msg,type='error'){const t=document.getElementById('toast');t.textContent=decodeEntities(msg);t.classList.remove('warn','info');if(type==='warn')t.classList.add('warn');if(type==='info')t.classList.add('info');t.classList.add('show');clearTimeout(_toastTimer);_toastTimer=setTimeout(()=>t.classList.remove('show'),3500);}

    /* ===== Par√°metros ===== */
    let strokeRisksByVasc={0:0.2,1:0.6,2:2.2,3:3.2,4:4.8,5:7.2,6:9.7,7:11.2,8:10.8,9:12.2};
    let bleedRiskByHASBLED={0:1.1,1:1.9,2:3.4,3:5.8,4:8.9,5:12.5,6:15.0};
    let RR_Stroke={"No ACO":1.00,"VKA":0.36,"Apixab√°n":0.36*0.79,"Dabigatr√°n":0.36*0.66,"Edoxab√°n":0.36*0.87,"Rivaroxab√°n":0.36*0.79};
    let RR_Bleed_vs_VKA={"No ACO":0.30,"VKA":1.00,"Apixab√°n":0.69,"Dabigatr√°n":0.93,"Edoxab√°n":0.80,"Rivaroxab√°n":1.04};
    const STRATS=["No ACO","VKA","Apixab√°n","Dabigatr√°n","Edoxab√°n","Rivaroxab√°n"];

    /* ===== C√°lculos base ===== */
    function calcVasc(age,female,flags){let s=0;if(flags.cCongest)s+=1;if(flags.cHTN)s+=1;if(age>=75||flags.cAge75)s+=2;if(flags.cDiab)s+=1;if(flags.cStroke)s+=2;if(flags.cVasc)s+=1;if((age>=65&&age<=74)||flags.cAge65)s+=1;const classicVASc=s+(female?1:0);return{va:s,vasc:classicVASc};}
    function calcHASBLED(flags,age){let s=0;if(flags.hHTN)s+=1;if(flags.hRenal)s+=1;if(flags.hLiver)s+=1;if(flags.hStroke)s+=1;if(flags.hBleed)s+=1;if(flags.hLabileINR)s+=1;if(age>65||flags.hElder)s+=1;if(flags.hDrugs)s+=1;if(flags.hAlcohol)s+=1;return s;}
    function getStrokeRiskPct(vasc){const k=Math.max(0,Math.min(9,vasc|0));return strokeRisksByVasc[k]??0;}
    function getBleedRiskPct(hasbled){const k=Math.max(0,Math.min(6,hasbled|0));return bleedRiskByHASBLED[k]??bleedRiskByHASBLED[6];}
    function calcCrCl(age,sex,weightVal,wUnit,scrVal,scrUnit){
      if(!isFinite(age)||!sex||!isFinite(weightVal)||!isFinite(scrVal))return{crcl:NaN,scr_mgdl:NaN};
      const wtKg=(wUnit==='lb')?(weightVal/2.20462):weightVal;
      const scrMg=(scrUnit==='umol')?(scrVal/88.4):scrVal;
      const base=(140-age)*wtKg/(72*scrMg);
      const factor=(sex==='F')?0.85:1.0;
      return{crcl:base*factor,scr_mgdl:scrMg};
    }

    /* ===== Autorrelleno ===== */
    function autoCheckByInputs(){
      const age=clamp(parseFloat(document.getElementById('age').value)||0,0,150);
      const sex=document.getElementById('sex').value;
      const weightRaw=parseFloat(document.getElementById('weight').value);
      const weight=isFinite(weightRaw)?clamp(weightRaw,10,400):NaN;
      const wUnit=document.getElementById('weightUnit').value;
      const kg=isFinite(weight)?((wUnit==='lb')?(weight/2.20462):weight):NaN;
      const scrRaw=parseFloat(document.getElementById('scr').value);
      const scr=isFinite(scrRaw)?clamp(scrRaw,0.1,15):NaN;
      const scrUnit=document.getElementById('scrUnit').value;

      document.getElementById('cSc').checked=(sex==='F');
      document.getElementById('cAge75').checked=(age>=75);
      document.getElementById('cAge65').checked=(age>=65&&age<=74);
      document.getElementById('hElder').checked=(age>65);
      document.getElementById('condObesity').checked=(isFinite(kg)&&kg>120);

      const {crcl,scr_mgdl}=calcCrCl(age,sex,kg,'kg',scr,scrUnit);
      const renalByScr=(isFinite(scr_mgdl)&&scr_mgdl>=2.26);
      const renalByClCr=(isFinite(crcl)&&crcl<30);
      document.getElementById('hRenal').checked=(renalByScr||renalByClCr);
    }

    /* ===== Validaci√≥n ===== */
    function checkAndFixContradictions(controlId){
      const age=clamp(parseFloat(document.getElementById('age').value)||0,0,150);
      const sex=document.getElementById('sex').value;
      const weightRaw=parseFloat(document.getElementById('weight').value);
      const weight=isFinite(weightRaw)?clamp(weightRaw,10,400):NaN;
      const wUnit=document.getElementById('weightUnit').value;
      const kg=isFinite(weight)?((wUnit==='lb')?(weight/2.20462):weight):NaN;
      const scrRaw=parseFloat(document.getElementById('scr').value);
      const scr=isFinite(scrRaw)?clamp(scrRaw,0.1,15):NaN;
      const scrUnit=document.getElementById('scrUnit').value;
      const {crcl,scr_mgdl}=calcCrCl(age,sex,kg,'kg',scr,scrUnit);
      const el=id=>document.getElementById(id);

      if(controlId==='condObesity'&&el('condObesity').checked&&!(isFinite(kg)&&kg>120)){
        showToast('Obesidad m√≥rbida: criterio habitual IMC >= 40 o peso > 120 kg. Con el peso actual, mant√©n marcada la casilla solo si el IMC es >= 40.','warn');return true;}
      if(controlId==='cAge65'&&el('cAge65').checked&&!(age>=65&&age<=74)){el('cAge65').checked=false;showToast('Marca Edad 65‚Äì74 solo si la edad est√° entre 65 y 74 a√±os.');return false;}
      if(controlId==='cAge75'&&el('cAge75').checked&&!(age>=75)){el('cAge75').checked=false;showToast('Marca Edad >= 75 solo si la edad introducida es >= 75 a√±os.');return false;}
      if(controlId==='hElder'&&el('hElder').checked&&!(age>65)){el('hElder').checked=false;showToast('HAS-BLED: Edad > 65 requiere edad introducida > 65 a√±os.');return false;}
      if(controlId==='cSc'&&el('cSc').checked&&sex!=='F'){el('cSc').checked=false;showToast('Sexo femenino solo procede si el sexo seleccionado es Mujer.');return false;}
      if(controlId==='hRenal'&&el('hRenal').checked&&!((isFinite(scr_mgdl)&&scr_mgdl>=2.26)||(isFinite(crcl)&&crcl<30))){
        showToast('Revise disfunci√≥n renal: con los datos introducidos no se cumple HAS-BLED (SCr >= 2.26 mg/dL o ClCr < 30). Si trasplante/di√°lisis, mantenga marcado.','warn');return true;}
      return true;
    }
    ['condObesity','cAge65','cAge75','hElder','hRenal','cSc'].forEach(id=>document.getElementById(id).addEventListener('change',()=>checkAndFixContradictions(id)));

    /* ===== Reglas cl√≠nicas (incluye ri√±√≥n) ===== */
    function buildClinicalRules(context){
      const {crcl,age,special,weightKg}=context;
      const prefer={"VKA":new Set(),"Apixab√°n":new Set(),"Dabigatr√°n":new Set(),"Edoxab√°n":new Set(),"Rivaroxab√°n":new Set()};
      const avoid={"VKA":new Set(),"Apixab√°n":new Set(),"Dabigatr√°n":new Set(),"Edoxab√°n":new Set(),"Rivaroxab√°n":new Set()};
      const notes=[];

      // Disfagia / SNG
      if(special.dysphagia){
        avoid.Dabigatr√°n.add("Disfagia/SNG (no abrir c√°psula)");
        prefer.Apixab√°n.add("Compatible triturado/SNG");
        prefer.Rivaroxab√°n.add("Compatible triturado/SNG (>=15 mg con comida)");
        prefer.VKA.add("Se puede triturar/SNG");
        notes.push("Disfagia/SNG: evitar dabigatr√°n; apixab√°n, rivaroxab√°n o VKA son opciones.");
      }

      // Funci√≥n renal
      if(isFinite(crcl)){
        if(crcl<15){
          prefer.VKA.add("ERC terminal (<15 mL/min) o di√°lisis");
          avoid.Dabigatr√°n.add("ERC terminal");
          avoid.Rivaroxab√°n.add("ERC terminal");
          avoid.Edoxab√°n.add("ERC terminal");
          avoid.Apixab√°n.add("No recomendado por EMA en ERC terminal/di√°lisis");
          notes.push("ClCr <15 mL/min o di√°lisis: preferir VKA; evitar ACOD.");
        }else if(crcl>=15&&crcl<30){
          prefer.Apixab√°n.add("ERC 15‚Äì29 (baja excreci√≥n renal)");
          avoid.Dabigatr√°n.add("ERC 15‚Äì29 (contraindicado si <30)");
          notes.push("ClCr 15‚Äì29 mL/min: preferir apixab√°n; evitar dabigatr√°n; ajustar rivaroxab√°n/edoxab√°n.");
        }else if(crcl>95){
          avoid.Edoxab√°n.add("Menor eficacia si ClCr >95 mL/min (FDA, Savaysa)");
          notes.push("ClCr >95 mL/min: evitar edoxab√°n por menor eficacia relativa (FA no valvular).");
        }
      }


      // Otros condicionantes
      if(special.giBleed){prefer.Apixab√°n.add("Mejor perfil GI");avoid.Rivaroxab√°n.add("M√°s sangrado GI");avoid.Dabigatr√°n.add("M√°s sangrado GI (150 mg)");avoid.Edoxab√°n.add("M√°s sangrado GI");notes.push("Antecedente de HDA severa: preferir apixab√°n.");}
      if(special.ichRisk){prefer.Apixab√°n.add("Menor HIC vs VKA");prefer.Edoxab√°n.add("Menor HIC vs VKA");avoid.VKA.add("M√°s HIC vs ACOD");notes.push("Alto riesgo de HIC: priorizar ACOD (apixab√°n/edoxab√°n).");}
      if(special.valvular){prefer.VKA.add("Pr√≥tesis mec√°nica/EM reum√°tica (indicaci√≥n absoluta)");avoid.Apixab√°n.add("No indicado");avoid.Dabigatr√°n.add("No indicado");avoid.Edoxab√°n.add("No indicado");avoid.Rivaroxab√°n.add("No indicado");notes.push("Pr√≥tesis mec√°nica/EM reum√°tica significativa: VKA obligatorio.");}
      if(special.polypharm){prefer.Apixab√°n.add("Menos interacciones globales");prefer.Edoxab√°n.add("Menos interacciones globales");avoid.VKA.add("M√∫ltiples interacciones");notes.push("Polimedicaci√≥n: preferir apixab√°n/edoxab√°n.");}
      if(special.cirrhosis){prefer.VKA.add("Hepatopat√≠a avanzada");avoid.Apixab√°n.add("Evitar Child C");avoid.Dabigatr√°n.add("Evitar Child C");avoid.Edoxab√°n.add("Evitar Child C");avoid.Rivaroxab√°n.add("Evitar Child C");notes.push("Hepatopat√≠a avanzada: preferir VKA; evitar ACOD en Child C.");}
      const over120=isFinite(weightKg)&&weightKg>120;
      if(special.obesity||over120){prefer.VKA.add("Obesidad m√≥rbida");avoid.Dabigatr√°n.add("Evidencia limitada");avoid.Edoxab√°n.add("Evidencia limitada");notes.push("Obesidad m√≥rbida: preferir VKA; si ACOD, mejor apixab√°n/rivaroxab√°n.");}
      if(special.oncoGI){prefer.VKA.add("Alternativa en tumor GI/GU activo");avoid.Rivaroxab√°n.add("Mayor riesgo GI");avoid.Dabigatr√°n.add("Mayor riesgo GI");avoid.Edoxab√°n.add("Mayor riesgo GI");prefer.Apixab√°n.add("Perfil GI favorable");notes.push("Neoplasia GI/GU activa: preferible apixab√°n o VKA.");}
      if(age>=80){prefer.Apixab√°n.add("Mejor balance en ancianos");avoid.Dabigatr√°n.add("Evitar 150 mg en ancianos");notes.push("Anciano fr√°gil: apixab√°n suele ser la opci√≥n m√°s segura.");}
      if(special.poorINR){avoid.VKA.add("Dif√≠cil monitorizaci√≥n INR");prefer.Apixab√°n.add("Sin INR rutinario");prefer.Rivaroxab√°n.add("Sin INR rutinario");prefer.Edoxab√°n.add("Sin INR rutinario");prefer.Dabigatr√°n.add("Sin INR rutinario");notes.push("Si no se puede monitorizar INR: preferir ACOD.");}
      if(special.qd){prefer.Rivaroxab√°n.add("Posolog√≠a QD");prefer.Edoxab√°n.add("Posolog√≠a QD");notes.push("Preferencia por dosis √∫nica diaria: rivaroxab√°n o edoxab√°n.");}

      // Inductor potente de P-gp
      if (special.pgpInd) {
        prefer.VKA.add("Inductor potente de P-gp (evitar infraexposici√≥n de ACOD)");
        avoid.Dabigatr√°n.add("Altamente dependiente de P-gp ‚Üí riesgo de infraexposici√≥n marcada");
        avoid.Edoxab√°n.add("Inductor potente de P-gp ‚Üí menor exposici√≥n y posible p√©rdida de eficacia");
        notes.push(
          "Inductor potente de P-gp (rifampicina, carbamazepina, fenito√≠na, fenobarbital/primidona, Hierba de San Juan): " +
          "evitar dabigatr√°n y, siempre que sea posible, edoxab√°n; preferir VKA u otra alternativa no dependiente de P-gp."
        );
      }


// Inhibidor potente de P-gp
if (special.pgp) {
  // Dabigatr√°n: evitar si ClCr <50 mL/min (altamente dependiente de P-gp)
  if (isFinite(crcl) && crcl < 50) {
    avoid.Dabigatr√°n.add("Inhibidor potente de P-gp con ClCr <50 mL/min: evitar dabigatr√°n");
    notes.push("Inhibidor potente de P-gp con ClCr <50 mL/min: evitar dabigatr√°n y preferir alternativas menos dependientes de P-gp.");
  }

  // El resto de la recomendaci√≥n pr√°ctica general de P-gp
  notes.push("Inhibidor potente de P-gp (p. ej., verapamilo, dronedarona, quinidina, ciclosporina, tacrolimus, ritonavir): preferir ACOD menos dependientes de P-gp o VKA en pacientes con alto riesgo hemorr√°gico o polimedicaci√≥n.");
}


  // ============================================
  // CYP3A4: inhibidores e inductores potentes
  // ============================================

  // Inhibidor potente de CYP3A4
  if (special.cypInhib) {

    // Evitar ACOD dependientes de CYP3A4
    avoid.Apixab√°n.add("Inhibidor potente de CYP3A4 (riesgo de sobreexposici√≥n)");
    avoid.Rivaroxab√°n.add("Inhibidor potente de CYP3A4 (riesgo de sobreexposici√≥n)");

    // Edoxab√°n: NO se evita. Metabolismo CYP3A4 m√≠nimo.
    prefer.Edoxab√°n.add("Metabolismo CYP3A4 m√≠nimo ‚Üí opci√≥n m√°s segura");

    // Dabigatr√°n tampoco se afecta por CYP3A4
    prefer.Dabigatr√°n.add("No depende de CYP3A4");

    notes.push(
      "Inhibidor potente de CYP3A4 (azoles sist√©micos, inhibidores de proteasa, claritromicina, cobicistat): " +
      "evitar rivaroxab√°n y usar precauci√≥n con apixab√°n. Edoxab√°n y dabigatr√°n no se ven afectados por esta v√≠a."
    );
}


  // Inductor potente de CYP3A4
 if (special.cypInduc) {

    // Evitar ACOD muy dependientes de CYP3A4
    avoid.Apixab√°n.add("Inductor potente de CYP3A4 (riesgo de infraexposici√≥n)");
    avoid.Rivaroxab√°n.add("Inductor potente de CYP3A4 (riesgo de infraexposici√≥n)");

    // Edoxab√°n NO debe evitarse (metabolismo CYP3A4 m√≠nimo)
    prefer.Edoxab√°n.add("Menor metabolismo CYP3A4 ‚Üí opci√≥n m√°s segura");
    
    // Dabigatr√°n tampoco se afecta por CYP3A4
    prefer.Dabigatr√°n.add("No depende de CYP3A4");

    // Mensaje cl√≠nico
    notes.push(
      "Inductor potente de CYP3A4 (rifampicina, carbamazepina, fenito√≠na, fenobarbital, hierba de San Juan): " +
      "evitar rivaroxab√°n y apixab√°n. Edoxab√°n y dabigatr√°n son alternativas razonables. Valorar preferencia por VKA."
    );
}


  return {prefer,avoid,notes};
}


    /* ===== Posolog√≠a (actualizada) ===== */
    function doseSuggestions(ctx,avoid){
      const {age,crcl,hasbled,weightKg,scr_mgdl,special}=ctx;
      const out=[]; const isAvoided=name=> (avoid?.[name]&&avoid[name].size>0);

      // Apixab√°n
      if(!isAvoided("Apixab√°n")){
        const apxCrit=((age>=80)?1:0)+((isFinite(weightKg)&&weightKg<=60)?1:0)+((isFinite(scr_mgdl)&&scr_mgdl>=1.5)?1:0);
        const apxReduce=(apxCrit>=2)||(isFinite(crcl)&&crcl>=15&&crcl<30);
        out.push({name:"Apixab√°n",dose:apxReduce?"2.5 mg cada 12 h":"5 mg cada 12 h",highlight:apxReduce,why:apxReduce?">=2 criterios (edad >=80, peso <=60 kg, SCr >=1.5 mg/dL) o ClCr 15‚Äì29 ml/min":"Criterios de reducci√≥n no presentes"});
      }

      // Rivaroxab√°n
      if(!isAvoided("Rivaroxab√°n")){
        const rivaReduce=(isFinite(crcl)&&crcl>=15&&crcl<50);
        out.push({name:"Rivaroxab√°n",dose:rivaReduce?"15 mg cada 24 h":"20 mg cada 24 h",highlight:rivaReduce,why:rivaReduce?"ClCr 15‚Äì49 ml/min":"ClCr >=50 ml/min"});
      }

      // Edoxab√°n
      if(!isAvoided("Edoxab√°n")){
        const edoReduce=((isFinite(crcl)&&crcl>=15&&crcl<=50)||(isFinite(weightKg)&&weightKg<=60)||special.pgp===true);
        out.push({name:"Edoxab√°n",dose:edoReduce?"30 mg cada 24 h":"60 mg cada 24 h",highlight:edoReduce,why:edoReduce?"ClCr 15‚Äì50 ml/min o peso <=60 kg o inhibidor potente P-gp":"Sin criterios de reducci√≥n"});
      }

      // Dabigatr√°n
if (!isAvoided("Dabigatr√°n")) {
  // Evitar si ClCr <30 siempre, o si hay inhibidor potente de P-gp con ClCr <50
  const dabAvoid =
    (isFinite(crcl) && crcl < 30) ||
    (special.pgp === true && isFinite(crcl) && crcl < 50);

  if (!dabAvoid) {
    const dabReduce =
      (isFinite(crcl) && crcl >= 30 && crcl <= 50) ||
      (age >= 80) ||
      (age >= 75 && age < 80 && hasbled >= 3) ||
      (special.pgp === true && (!isFinite(crcl) || crcl >= 50));

    out.push({
      name: "Dabigatr√°n",
      dose: dabReduce ? "110 mg cada 12 h" : "150 mg cada 12 h",
      highlight: dabReduce,
      why: dabReduce
        ? "ClCr 30‚Äì50 mL/min, edad ‚â•80 (o 75‚Äì80 con HAS-BLED alto) o inhibidor potente de P-gp con ClCr ‚â•50 mL/min"
        : "Sin criterios de reducci√≥n ni interacci√≥n relevante por P-gp"
    });
  }
}


      // VKA
      if(!isAvoided("VKA")){out.push({name:"VKA",dose:"Ajuste a INR entre 2 y 3",highlight:false,why:"Dosis individualizada seg√∫n INR"});}

      return out;
    }

    /* ===== Zebra por columnas ===== */
    function applyColumnStriping(){
      const rows=document.querySelectorAll('#comparative tbody tr');
      rows.forEach(row=>{
        const tds=Array.from(row.querySelectorAll('td'));
        tds.forEach(td=>td.classList.remove('_zebra'));
        const visible=tds.filter(td=>getComputedStyle(td).display!=='none');
        visible.forEach((td,idx)=>{if(((idx+1)%2)===0)td.classList.add('_zebra');});
      });
    }
    let _zebraTimer=null;window.addEventListener('resize',()=>{clearTimeout(_zebraTimer);_zebraTimer=setTimeout(applyColumnStriping,80);});
    function summarizeForStrategy(name,prefSet,avoidSet){
      const prefs=Array.from(prefSet[name]||[]),avoids=Array.from(avoidSet[name]||[]);
      if(avoids.length>0)return{label:'Evitar',cls:'tagAvoid',tooltip:avoids.join(' ¬∑ ')};
      if(prefs.length>0)return{label:'Preferible',cls:'tagPref',tooltip:prefs.join(' ¬∑ ')};
      return{label:'‚Äî',cls:'tagNeutral',tooltip:'Sin condicionantes espec√≠ficos'};
    }

    /* ===== Estado para informe ===== */
    let __lastReport=null;

    /* ===== Compute principal ===== */
    function compute(){
      autoCheckByInputs();

      const age=clamp(parseFloat(document.getElementById('age').value)||0,18,110);
      const sex=document.getElementById('sex').value;

      const weightRaw=parseFloat(document.getElementById('weight').value);
      const weight=isFinite(weightRaw)?clamp(weightRaw,10,400):NaN;
      const wUnit=document.getElementById('weightUnit').value;

      const scrRaw=parseFloat(document.getElementById('scr').value);
      const scr=isFinite(scrRaw)?clamp(scrRaw,0.1,15):NaN;
      const scrUnit=document.getElementById('scrUnit').value;

      const flags={cCongest:document.getElementById('cCongest')?.checked||false,cHTN:document.getElementById('cHTN')?.checked||false,cAge75:document.getElementById('cAge75')?.checked||false,cDiab:document.getElementById('cDiab')?.checked||false,cStroke:document.getElementById('cStroke')?.checked||false,cVasc:document.getElementById('cVasc')?.checked||false,cAge65:document.getElementById('cAge65')?.checked||false,cSc:document.getElementById('cSc')?.checked||false,hHTN:document.getElementById('hHTN')?.checked||false,hRenal:document.getElementById('hRenal')?.checked||false,hLiver:document.getElementById('hLiver')?.checked||false,hStroke:document.getElementById('hStroke')?.checked||false,hBleed:document.getElementById('hBleed')?.checked||false,hLabileINR:document.getElementById('hLabileINR')?.checked||false,hElder:document.getElementById('hElder')?.checked||false,hDrugs:document.getElementById('hDrugs')?.checked||false,hAlcohol:document.getElementById('hAlcohol')?.checked||false};

      const special = {
  dysphagia:   document.getElementById('condDysphagia')?.checked || false,
  giBleed:     document.getElementById('condGIbleed')?.checked   || false,
  ichRisk:     document.getElementById('condICHrisk')?.checked   || false,
  ichPrev:     document.getElementById('condICHprev')?.checked   || false,
  valvular:    document.getElementById('condValvular')?.checked  || false,
  oncoGI:      document.getElementById('condOncoGI')?.checked    || false,
  polypharm:   document.getElementById('condPolypharm')?.checked || false,
  cirrhosis:   document.getElementById('condCirrhosis')?.checked || false,
  obesity:     document.getElementById('condObesity')?.checked   || false,
  poorINR:     document.getElementById('condPoorINR')?.checked   || false,
  qd:          document.getElementById('condQD')?.checked        || false,
  pgp:         document.getElementById('condPgp')?.checked       || false,
  noOACabs:    document.getElementById('condNoOACabs')?.checked  || false,
  laaProg: document.getElementById('condLAAprog')?.checked || false,
  pgpInd: document.getElementById('condPgInd')?.checked || false,   // ‚¨ÖÔ∏è NUEVO

  // üß¨ NUEVOS FLAGS PARA CYP3A4
  cypInhib:    document.getElementById('condCYPinh')?.checked    || false,
  cypInduc:    document.getElementById('condCYPind')?.checked    || false
};



      const female=(sex==='F');
      const vasc=calcVasc(age||0,female,flags);
      const hasbled=calcHASBLED(flags,age||0);

      const strokeBase=getStrokeRiskPct(vasc.vasc);
      const bleedBase=getBleedRiskPct(hasbled);

      const {crcl,scr_mgdl}=calcCrCl(age,sex,isFinite(weight)?weight:NaN,wUnit,scr,scrUnit);
      const weightKg=isFinite(weight)?((wUnit==='lb')?(weight/2.20462):weight):NaN;

      // Cabecera
      document.getElementById('scoreVA').textContent=vasc.va;
      document.getElementById('scoreVASc').textContent=vasc.vasc;
      document.getElementById('annualStroke').textContent=fmt(strokeBase,1);
      document.getElementById('scoreHASBLED').textContent=hasbled;
      document.getElementById('annualBleed').textContent=fmt(bleedBase,1);
      document.getElementById('crcl').textContent=isFinite(crcl)?fmt(crcl,0):NDASH;
      document.getElementById('scrConv').textContent=isFinite(scr_mgdl)?fmt(scr_mgdl,2):NDASH;

// ================================================
// NUEVAS REGLAS DE NO ANTICOAGULAR
// ================================================

// 1) No anticoagular por BAJO RIESGO EMB√ìLICO
const noOAC_byLowRisk =
  (!female && vasc.vasc === 0) ||
  (female && vasc.va === 0 && vasc.vasc === 1);

// 2) No anticoagular por RIESGO HEMORR√ÅGICO INACEPTABLE
//    (definido por el cl√≠nico o por ICH previa)
const noOAC_byHighBleed =
  special.noOACabs === true ||     // marcado por cl√≠nico
  special.ichPrev === true;        // HIC previa NO traum√°tica

// 3) Escenario intermedio: se puede CONSIDERAR anticoagulaci√≥n
//    Var√≥n con CHA2DS2-VASc = 1
//    Mujer con CHA2DS2-VASc = 2
const considerOAC_byBorderline =
  (!female && vasc.vasc === 1) ||
  (female && vasc.vasc === 2);

// 4) Regla final de NO ACO (prohibido en valvular)
const noOAC = (noOAC_byLowRisk || noOAC_byHighBleed) && !special.valvular;



      // Reglas cl√≠nicas
      const {prefer,avoid,notes}=buildClinicalRules({crcl,age,special,weightKg});

     // A√±adir nota espec√≠fica si est√° en la ‚Äúzona gris‚Äù de CHA2DS2-VASc
if (considerOAC_byBorderline && !noOAC && !special.valvular) {
  notes.push(
    "üü†‚ö†Ô∏è CHA‚ÇÇDS‚ÇÇ-VASc en zona intermedia (1 en var√≥n, 2 en mujer): " +
    "se puede considerar anticoagulaci√≥n oral tras valorar riesgo hemorr√°gico, " +
    "comorbilidad y preferencias del paciente; no es obligatoria seg√∫n las gu√≠as ‚öñÔ∏èüü†"
  );
}


      // Tabla comparativa
      const TOL_REL=0.03,TOL_ABS=0.005;
      function withinTolerance(score,best,tolRel=TOL_REL,tolAbs=TOL_ABS){if(!isFinite(score)||!isFinite(best))return false;const relOk=best>0?(best-score)<=best*tolRel:false;const absOk=Math.abs(best-score)<=tolAbs;return relOk||absOk;}
      const tbody=document.querySelector('#comparative tbody');tbody.innerHTML='';
      const rows=[];let bestScore=-Infinity;
      STRATS.forEach(name=>{
        const rrStroke=RR_Stroke[name], rrBleed_vsVKA=RR_Bleed_vs_VKA[name];
        const riskStroke=strokeBase*rrStroke, rrr=(1-rrStroke)*100, arr=strokeBase-riskStroke;
        const bleedPct=(name==='VKA')?bleedBase:(bleedBase*rrBleed_vsVKA);
        const score=(arr>0&&bleedPct>0)?(arr/bleedPct):-Infinity;
let adequacy;

if (noOAC) {
    if (name === "No ACO") {
        // NO ACO es la estrategia recomendada ‚Üí Preferible
        adequacy = {
            label: "Preferible",
            cls: "tagPref",
            tooltip: "Recomendado en este caso (bajo riesgo emb√≥lico o contraindicaci√≥n absoluta)"
        };
    } else {
        // Todas las opciones anticoagulantes ‚Üí Evitar
        adequacy = {
            label: "Evitar",
            cls: "tagAvoid",
            tooltip: "Contraindicado o riesgo hemorr√°gico inaceptable"
        };
    }
} else {
    // Comportamiento habitual
    adequacy = summarizeForStrategy(name, prefer, avoid);
}
        const tip=escAttr(decodeEntities(adequacy.tooltip||''));
        const tr=document.createElement('tr');
        tr.innerHTML=`<td><b>${name}</b></td>
          <td class="right">${fmt(riskStroke,1)}</td>
          <td class="right">${fmt(rrr,0)}</td>
          <td class="right col-rra">${fmt(arr,1)}</td>
          <td class="right">${isFinite(arr)&&arr>0?oneIn(arr):NDASH}</td>
          <td class="right">${fmt(bleedPct,1)}</td>
          <td class="right col-rrs">${fmt(rrBleed_vsVKA,2)}</td>
          <td class="right">${isFinite(bleedPct)&&bleedPct>0?oneIn(bleedPct):NDASH}</td>
          <td class="right"><span class="pill ${adequacy.cls}" title="${tip}">${adequacy.label}</span></td>`;
        tbody.appendChild(tr); rows.push({tr,score}); if(score>bestScore)bestScore=score;
      });
      if (noOAC) {
    // Fuerza No ACO como la fila "best"
    rows.forEach(({tr}) => {
        if (tr.querySelector("td b")?.textContent === "No ACO") {
            tr.classList.add("best");
        } else {
            tr.classList.remove("best");
        }
    });
} else {
    rows.forEach(({tr, score}) => {
        if (withinTolerance(score, bestScore)) tr.classList.add('best');
    });
}

      applyColumnStriping();

// =======================================================
// RECOMENDACIONES INDIVIDUALIZADAS
// =======================================================
const recList = document.getElementById('recList');
const doseSection = document.getElementById('doseSection');
recList.innerHTML = '';
let preferredGlobal = [], avoidedGlobal = [], dosesForReport = [];

// -------------------------------------------
// CASO 1: NO ACO por bajo riesgo emb√≥lico
// -------------------------------------------
if (noOAC_byLowRisk && !special.valvular) {
    const li = document.createElement('li');
    li.innerHTML =
      '<span class="noOac">NO se recomienda anticoagulaci√≥n oral por bajo riesgo emb√≥lico.</span>';
    recList.appendChild(li);

    doseSection.style.display = 'none';
}

// -------------------------------------------
// CASO 2: NO ACO por riesgo hemorr√°gico inaceptable
// -------------------------------------------
else if (noOAC_byHighBleed && !special.valvular) {
    const li = document.createElement('li');
    li.innerHTML =
      '<span class="noOac">NO se recomienda anticoagulaci√≥n oral por riesgo hemorr√°gico inaceptable o contraindicaci√≥n absoluta.</span>';
    recList.appendChild(li);

    // OFRECER CIERRE DE OREJUELA SI DISPONIBLE
    if (special.laaProg === true) {
        const li2 = document.createElement('li');
        li2.innerHTML =
          '<b>Considerar cierre percut√°neo de orejuela</b> como estrategia alternativa de prevenci√≥n cardioemb√≥lica.';
        recList.appendChild(li2);
    }

    doseSection.style.display = 'none';
}

// -------------------------------------------
// CASO 3: Anticoagulaci√≥n indicada ‚Üí lista completa con reglas
// -------------------------------------------
else {
    // A√±adir notas cl√≠nicas
    notes.forEach(t => {
        const li = document.createElement('li');
        li.textContent = decodeEntities(t);
        recList.appendChild(li);
    });

    // Preferidos y evitados
    ["VKA","Apixab√°n","Dabigatr√°n","Edoxab√°n","Rivaroxab√°n"].forEach(n => {
        if ((avoid[n] || new Set()).size > 0) avoidedGlobal.push(n);
        else if ((prefer[n] || new Set()).size > 0) preferredGlobal.push(n);
    });

    if (preferredGlobal.length) {
        const li = document.createElement('li');
        li.innerHTML = "<b>Estrategias preferibles:</b> " + preferredGlobal.join(", ");
        recList.appendChild(li);
    }

    if (avoidedGlobal.length) {
        const li = document.createElement('li');
        li.innerHTML = "<b>Estrategias a evitar:</b> " + avoidedGlobal.join(", ");
        recList.appendChild(li);
    }

    // Mostrar posolog√≠a
    doseSection.style.display = '';
    const doseList = document.getElementById('doseList');
    doseList.innerHTML = '';
    dosesForReport = doseSuggestions({age,crcl,hasbled,weightKg,scr_mgdl,special}, avoid);

    if (dosesForReport.length === 0) {
        const li = document.createElement('li');
        li.innerHTML =
          '<span class="muted">No se muestran posolog√≠as porque todas las opciones est√°n marcadas como ‚ÄúEvitar‚Äù.</span>';
        doseList.appendChild(li);
    } else {
        dosesForReport.forEach(d => {
            const li = document.createElement('li');
            const tag = d.highlight
              ? `<span class="doseTag">Dosis reducida</span>`
              : '';
            li.innerHTML =
              `<b>${d.name}:</b> ${d.dose} ${tag} <span class="muted">‚Äî ${d.why}</span>`;
            doseList.appendChild(li);
        });
    }
}


      // Guardar estado
      __lastReport={
        ts:new Date().toISOString(),
        inputs:{age,sex,weight:isFinite(weight)?weight:null,weightUnit:wUnit,scr:isFinite(scr)?scr:null,scrUnit,weightKg:isFinite(weightKg)?weightKg:null},
        renal:{crcl:isFinite(crcl)?+crcl.toFixed(0):null,scr_mgdl:isFinite(scr_mgdl)?+scr_mgdl.toFixed(2):null},
        scores:{va:vasc.va,vasc:vasc.vasc,hasbled},
        risks:{strokeBase:+strokeBase,bleedBase:+bleedBase},
          noOAC,
                    noOAC_byLowRisk,     // ‚Üê A√ëADIR
                    noOAC_byHighBleed,   // ‚Üê A√ëADIR
                   special,
        preferredGlobal, avoidedGlobal,
        notes:[...notes],
        doses:dosesForReport

      };
      document.getElementById('btnPrint').disabled=false;
      document.getElementById('btnCopy').disabled=false;
    }

function printReport(){

  if(!__lastReport){
    showToast('Primero calcule los resultados para generar el informe.','warn');
    return;
  }

  const r = __lastReport;

  const fmt = v => (v===null||v===undefined||!isFinite(v) ? "‚Äî" : v);
  const sexTxt = r.inputs.sex === 'M' ? 'Var√≥n' : (r.inputs.sex === 'F' ? 'Mujer' : '‚Äî');
  const fecha = (new Date(r.ts)).toLocaleString('es-ES');

  /* ===============================  
      MOTIVO DE NO ANTICOAGULAR
  =============================== */

  let noAcoHTML = "";

  if (r.noOAC) {

    if (r.noOAC_byLowRisk) {
      noAcoHTML += `
      <p style="color:#b71c1c;font-weight:800">
      NO SE RECOMIENDA TRATAMIENTO ANTICOAGULANTE</p>
      <p>Motivo: <b>bajo riesgo emb√≥lico</b>.</p>`;
    }

    if (r.noOAC_byHighBleed) {
      noAcoHTML += `
      <p style="color:#b71c1c;font-weight:800">
      NO SE RECOMIENDA TRATAMIENTO ANTICOAGULANTE</p>
      <p>Motivo: <b>riesgo hemorr√°gico inaceptable / contraindicaci√≥n absoluta</b>.</p>
      <p><b>Considerar cierre percut√°neo de orejuela</b>
      como alternativa de prevenci√≥n cardioemb√≥lica.</p>`;
    }
  }

  /* ===============================  
      POSOLOG√çA
  =============================== */

  let doseHTML = "";

  if (!r.noOAC && r.doses && r.doses.length) {
    doseHTML = "<h3>Posolog√≠a sugerida</h3><ul>";
    r.doses.forEach(d=>{
      doseHTML += `<li><b>${d.name}:</b> ${d.dose}` +
      (d.highlight ? 
        ' <span style="background:#fff4ce;border:1px solid #ffe08a;border-radius:999px;padding:2px 8px;font-weight:700">Dosis reducida</span>' 
        : '') +
      ` ‚Äî <span style="color:#666">${d.why}</span></li>`;
    });
    doseHTML += "</ul>";
  }

  /* ===============================  
      RECOMENDACIONES
  =============================== */

  let recHTML = "";

  if (r.noOAC) {
    recHTML = noAcoHTML;
  } else {

    if (r.notes.length) {
      recHTML += "<h3>Recomendaciones individualizadas</h3><ul>";
      r.notes.forEach(n => { recHTML += `<li>${n}</li>`; });
      recHTML += "</ul>";
    }

    if (r.preferredGlobal.length) {
      recHTML += `<p><b>Estrategias preferibles:</b> ${r.preferredGlobal.join(', ')}</p>`;
    }

    if (r.avoidedGlobal.length) {
      recHTML += `<p><b>Estrategias a evitar:</b> ${r.avoidedGlobal.join(', ')}</p>`;
    }
  }

  /* ===============================  
      CREAR HTML DEL INFORME
  =============================== */

  const html = `
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Informe ‚Äî Selecci√≥n de anticoagulante oral</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:24px;color:#111;}
  h1{font-size:1.3rem;}
  h2{font-size:1.1rem;margin-top:20px;}
  h3{font-size:1rem;margin-top:12px;}
  table{border-collapse:collapse;font-size:0.92rem;}
  td{padding:4px 8px;}
  .card{background:#f8fbff;border:1px solid #e3eef9;border-radius:10px;padding:14px;margin-top:16px;}
  .chip{display:inline-block;background:#eef6ff;border:1px solid #cfe3f6;border-radius:12px;padding:2px 8px;font-weight:700;}
</style>
</head>
<body>

<h1>Informe ‚Äî Selecci√≥n de anticoagulante oral</h1>
<div style="color:#666;margin-bottom:12px;">Generado: ${fecha}</div>

<div class="card">
  <h2>Datos y puntuaciones</h2>
  <table>
    <tr><td><b>Edad</b></td><td>${fmt(r.inputs.age)} a√±os</td></tr>
    <tr><td><b>Sexo</b></td><td>${sexTxt}</td></tr>
    <tr><td><b>Peso</b></td><td>${fmt(r.inputs.weight)} ${r.inputs.weightUnit}</td></tr>
    <tr><td><b>SCr</b></td><td>${fmt(r.inputs.scr)} ${r.inputs.scrUnit}</td></tr>
    <tr><td><b>SCr (mg/dL)</b></td><td>${fmt(r.renal.scr_mgdl)}</td></tr>
    <tr><td><b>ClCr</b></td><td>${fmt(r.renal.crcl)} ml/min</td></tr>
    <tr><td><b>CHA‚ÇÇDS‚ÇÇ-VA</b></td><td class="chip">${r.scores.va}</td></tr>
    <tr><td><b>CHA‚ÇÇDS‚ÇÇ-VASc</b></td><td class="chip">${r.scores.vasc}</td></tr>
    <tr><td><b>HAS-BLED</b></td><td class="chip">${r.scores.hasbled}</td></tr>
    <tr><td><b>Riesgo ictus sin tto</b></td><td>${r.risks.strokeBase} %/a√±o</td></tr>
    <tr><td><b>Riesgo sangrado base</b></td><td>${r.risks.bleedBase} %/a√±o</td></tr>
  </table>
</div>

<div class="card">
  <h2>Conclusi√≥n</h2>
  ${recHTML}
  ${doseHTML}
  <p style="margin-top:20px;font-size:.85rem;color:#666;">
    Documento generado autom√°ticamente. Interpretar junto con el juicio cl√≠nico y las gu√≠as locales.
  </p>
</div>

<script>
window.addEventListener('load',()=>{setTimeout(()=>{window.print();},150);});
<\/script>

</body>
</html>
`;

  const w = window.open('', '_blank');
  if(!w){
    showToast("El navegador bloque√≥ la impresi√≥n","warn");
    return;
  }

  w.document.open();
  w.document.write(html);
  w.document.close();
}



 /* =========================================================
   INFORME EN TEXTO (copiar)
========================================================= */
function copyReport(){
  if(!__lastReport){
    showToast('Primero calcule los resultados para generar el informe.','warn');
    return;
  }

  const r = __lastReport;

  const clean = s => String(s)
    .replace(/‚Ä¢/g,'*')
    .replace(/[‚Äî‚Äì]/g,'-')
    .replace(/‚â•/g,'>=')
    .replace(/‚â§/g,'<=');

  const sexTxt = 
    r.inputs.sex === 'M'
      ? 'Var√≥n'
      : (r.inputs.sex === 'F' ? 'Mujer' : '-');

  const fecha = new Date(r.ts).toLocaleString('es-ES');

  const lines = [];
  lines.push('INFORME ‚Äî Selecci√≥n de anticoagulante oral');
  lines.push('Generado: ' + fecha);
  lines.push('');

  /* === DATOS === */
  lines.push('DATOS Y PUNTUACIONES');
  lines.push('* Edad: ' + (r.inputs.age ?? '-') + ' a√±os');
  lines.push('* Sexo: ' + sexTxt);
  lines.push('* Peso: ' + (r.inputs.weight != null ? r.inputs.weight + ' ' + r.inputs.weightUnit : '-'));
  lines.push('* SCr: ' + (r.inputs.scr != null ? r.inputs.scr + ' ' + r.inputs.scrUnit : '-') +
             ' | ClCr: ' + (r.renal.crcl ?? '-') + ' ml/min');

  lines.push('* CHA2DS2-VA: ' + r.scores.va +
             ' | CHA2DS2-VASc: ' + r.scores.vasc +
             ' | HAS-BLED: ' + r.scores.hasbled);

  lines.push('* Riesgo ictus sin tto: ' + r.risks.strokeBase + '%/a√±o' +
             ' | Riesgo sangrado base: ' + r.risks.bleedBase + '%/a√±o');

  lines.push('');

  /* === CONCLUSI√ìN === */
  lines.push('CONCLUSI√ìN');

  if(r.noOAC){
    lines.push('NO SE RECOMIENDA TRATAMIENTO ANTICOAGULANTE');

    if(!r.noOAC_byLowRisk && r.noOAC_byHighBleed && !r.special.valvular){
      lines.push('Considerar cierre percut√°neo de orejuela.');
    }

  } else {
    if(r.notes.length){
      lines.push('Recomendaciones individualizadas:');
      r.notes.forEach(n => lines.push('* ' + clean(n)));
    }

    if(r.preferredGlobal.length){
      lines.push('Estrategias preferibles: ' + r.preferredGlobal.join(', '));
    }

    if(r.avoidedGlobal.length){
      lines.push('Estrategias a evitar: ' + r.avoidedGlobal.join(', '));
    }

    /* Posolog√≠a */
    if(r.doses && r.doses.length){
      lines.push('');
      lines.push('Posolog√≠a sugerida:');
      r.doses.forEach(d=>{
        lines.push('* ' + d.name + ': ' + d.dose +
                   (d.highlight ? ' [Dosis reducida]' : '') +
                   ' ‚Äî ' + clean(d.why));
      });
    }
  }

  const finalText = lines.join('\n');

  /* === Copiar al portapapeles === */
  navigator.clipboard.writeText(finalText).then(()=>{
    const btn = document.getElementById('btnCopy');
    const old = btn.textContent;
    btn.textContent = 'Copiado';
    setTimeout(()=>{ btn.textContent = old; }, 1600);
  })
  .catch(()=>{
    /* Fallback cl√°sico */
    const ta = document.createElement('textarea');
    ta.value = finalText;
    ta.style.position = 'fixed';
    ta.style.left = '-1000px';
    document.body.appendChild(ta);
    ta.select();
    try{ document.execCommand('copy'); } finally { document.body.removeChild(ta); }

    const btn = document.getElementById('btnCopy');
    const old = btn.textContent;
    btn.textContent = 'Copiado';
    setTimeout(()=>{ btn.textContent = old; }, 1600);
  });
}


    /* ===== Eventos ===== */
    ['age','sex','weight','weightUnit','scr','scrUnit'].forEach(id=>{
      const el=document.getElementById(id);
      el.addEventListener('input',autoCheckByInputs);
      el.addEventListener('change',autoCheckByInputs);
    });

    document.getElementById('btnCalc').addEventListener('click',e=>{
      e.preventDefault(); compute(); document.getElementById('calcMsg'); scrollToResult();
    });
    document.getElementById('btnReset').addEventListener('click',e=>{
      e.preventDefault();
      ['age','sex','weight','weightUnit','scr','scrUnit'].forEach(id=>{const el=document.getElementById(id); if(el.tagName==='SELECT'){el.selectedIndex=0;} else el.value='';});
      document.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
      ['scoreVA','scoreVASc','annualStroke','scoreHASBLED','annualBleed','crcl','scrConv'].forEach(id=>{document.getElementById(id).textContent=NDASH;});
      document.querySelector('#comparative tbody').innerHTML='';
      document.getElementById('recList').innerHTML='';
      document.getElementById('doseList').innerHTML='';
      document.getElementById('doseSection').style.display='';
      document.getElementById('calcMsg');
      document.getElementById('btnPrint').disabled=true;
      document.getElementById('btnCopy').disabled=true;
      

      __lastReport=null;
      window.scrollTo({top:0,behavior:'smooth'}); applyColumnStriping();
    });
    document.getElementById('btnPrint').addEventListener('click', (e)=>{ e.preventDefault(); printReport(); });
    document.getElementById('btnCopy').addEventListener('click', (e)=>{ e.preventDefault(); copyReport(); });
    document.getElementById('btnResetResults').addEventListener('click', (e) => {
  e.preventDefault();
  document.getElementById('btnReset').click();
});

    window.addEventListener('DOMContentLoaded', autoCheckByInputs);
    </script>
      <!-- Referencias / Bibliograf√≠a -->
      <div class="howto">
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìâ

            Inhibidores potentes de P-gp</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra superior tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üìà Interacciones farmacol√≥gicas:
              inhibidores potentes de P-gp </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <p style="margin:0 0 10px 0;"> Los inhibidores potentes de
                <b>P-gp (glicoprote√≠na-P)</b> aumentan
                significativamente la absorci√≥n y exposici√≥n plasm√°tica
                de los ACOD que dependen de este transportador
                intestinal y renal. El grado de interacci√≥n es <b>diferente

                  para cada ACOD</b>. </p>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Ejemplos de inhibidores potentes de P-gp:</b>
                  verapamilo, dronedarona, quinidina, amiodarona,
                  diltiazem, ketoconazol, itraconazol, posaconazol,
                  ciclosporina, tacrolimus, ritonavir.</li>
                <li><b>Dabigatr√°n</b> (altamente dependiente de P-gp): <b>evitar</b>
                  inhibidores potentes si <b>ClCr &lt;50 mL/min</b>. Si
                  ClCr ‚â•50, considerar dosis 110 mg/12 h seg√∫n riesgo
                  hemorr√°gico.</li>
                <li><b>Apixab√°n</b>: los inhibidores potentes de P-gp
                  pueden aumentar la exposici√≥n. <b>No se ajusta la
                    dosis solo por P-gp</b>, pero debe extremarse la
                  precauci√≥n en pacientes que ya cumplen criterios de
                  dosis reducida o presentan riesgo hemorr√°gico elevado.</li>
                <li><b>Rivaroxab√°n</b>: la inhibici√≥n aislada de P-gp
                  puede elevar la exposici√≥n; usar <b>precauci√≥n</b> y
                  valorar alternativas si concurren otros factores de
                  riesgo de sangrado.</li>
                <li><b>Edoxab√°n</b>: si el paciente recibe un inhibidor
                  potente de <b>P-gp</b> (verapamilo, dronedarona,
                  quinidina, ciclosporina), <b>reducir la dosis a 30
                    mg/24 h</b>, independientemente de peso o funci√≥n
                  renal.</li>
              </ul>
              <div style="margin-top:8px;"> <b>Recomendaci√≥n pr√°ctica:</b>
                ante el uso de inhibidores potentes de P-gp, preferir
                ACOD menos dependientes de este transportador cuando
                exista riesgo hemorr√°gico aumentado o polimedicaci√≥n. </div>
              <div style="margin-top:4px; color:#475569;
                font-size:12px;"> Consultar ficha t√©cnica EMA/FDA para
                cada ACOD ante combinaciones espec√≠ficas. </div>
            </div>
          </div>
        </details>
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìà

            Inductores potentes de P-gp</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra superior tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üìâ Interacciones farmacol√≥gicas:
              inductores potentes de P-gp </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <p style="margin:0 0 10px 0;"> Los <b>inductores potentes
                  de P-gp</b> reducen de forma significativa la
                absorci√≥n y la exposici√≥n plasm√°tica de los ACOD
                dependientes de este transportador intestinal y renal.
                El resultado es una <b>infraexposici√≥n farmacol√≥gica</b>
                y un posible <b>riesgo de p√©rdida de eficacia</b>,
                especialmente relevante en fibrilaci√≥n auricular y
                tromboembolismo venoso. </p>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Ejemplos de inductores potentes de P-gp:</b>
                  rifampicina, carbamazepina, fenito√≠na, fenobarbital,
                  primidona, <i>Hierba de San Juan (Hypericum)</i>.</li>
                <li><b>Dabigatr√°n</b> (muy dependiente de P-gp): <b>evitar</b>
                  su uso en combinaci√≥n con inductores potentes de P-gp
                  por riesgo de <b>infraexposici√≥n marcada</b> y
                  disminuci√≥n de eficacia.</li>
                <li><b>Edoxab√°n</b>: los inductores potentes de P-gp
                  reducen su exposici√≥n; considerar <b>evitarlo</b> y
                  preferir alternativas no dependientes de P-gp cuando
                  sea posible.</li>
                <li><b>Rivaroxab√°n</b>: la inducci√≥n de P-gp reduce la
                  exposici√≥n; <b>evitar</b> si el f√°rmaco inductor
                  tambi√©n act√∫a sobre CYP3A4 (rifampicina, fenito√≠na,
                  carbamazepina).</li>
                <li><b>Apixab√°n</b>: usar <b>precauci√≥n</b>; evitar si
                  el inductor es dual P-gp + CYP3A4 (rifampicina,
                  carbamazepina, fenito√≠na), por riesgo de
                  infraexposici√≥n significativa.</li>
              </ul>
              <div style="margin-top:8px;"> <b>Recomendaci√≥n pr√°ctica:</b>
                ante inductores potentes de P-gp, preferir <b>VKA</b> o
                ACOD con menor dependencia de este transportador para
                reducir el riesgo de fallo terap√©utico. </div>
              <div style="margin-top:4px; color:#475569;
                font-size:12px;"> Revisar la ficha t√©cnica EMA/FDA ante
                combinaciones espec√≠ficas y en presencia de otros
                inductores metab√≥licos (p. ej., CYP3A4). </div>
            </div>
          </div>
        </details>
        <br>
        <details style="margin-top:1px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìâ

            Inhibidores potentes de CYP3A4</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üìà Interacciones con inhibidores
              potentes de CYP3A4 </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <p style="margin-bottom:8px;"> Los inhibidores potentes de
                <b>CYP3A4</b> (p. ej.: <i>ketoconazol, itraconazol,
                  claritromicina, ritonavir, cobicistat</i>) pueden
                aumentar de forma significativa los niveles plasm√°ticos
                de los ACOD que dependen del metabolismo hep√°tico por
                esta v√≠a. </p>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Apixab√°n</b>: se metaboliza parcialmente por
                  CYP3A4. <b>Evitar la coadministraci√≥n</b> con
                  inhibidores potentes de CYP3A4, especialmente si el
                  paciente ya cumple criterios de dosis reducida. <span
                    class="muted">Puede aumentar de forma importante la
                    exposici√≥n.</span> </li>
                <li><b>Rivaroxab√°n</b>: depende en mayor medida de
                  CYP3A4. <b>Contraindicado o no recomendado</b> con
                  inhibidores potentes de CYP3A4 debido al marcado
                  aumento de sus niveles plasm√°ticos.</li>
                <li><b>Edoxab√°n</b>: el metabolismo por CYP3A4 es <b>m√≠nimo</b>.
                  Los inhibidores potentes de CYP3A4 <b>no requieren
                    ajuste de dosis</b>. <span class="muted">La
                    interacci√≥n relevante es por P-gp, no por CYP3A4.</span>
                </li>
                <li><b>Dabigatr√°n</b>: <b>no se metaboliza por CYP450</b>.
                  Los inhibidores de CYP3A4 <b>no afectan de forma
                    significativa</b> a sus concentraciones. <span
                    class="muted">La v√≠a importante es P-gp.</span> </li>
              </ul>
              <div style="color:#334155; font-size:12px;
                margin-top:10px;"> <b>Resumen pr√°ctico:</b> evitar <b>rivaroxab√°n</b>
                y precauci√≥n/evitar <b>apixab√°n</b> con inhibidores
                potentes de CYP3A4; <b>edoxab√°n</b> y <b>dabigatr√°n</b>
                no precisan ajuste por esta v√≠a metab√≥lica. </div>
            </div>
          </div>
        </details>
        <br>
        <details style="margin-top:1px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìà

            Inductores potentes de CYP3A4</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üìâ Interacciones con inductores
              potentes de CYP3A4 </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <p style="margin-bottom:8px;"> Los inductores potentes de
                <b>CYP3A4</b> (p. ej.: <i>rifampicina, carbamazepina,
                  fenito√≠na, fenobarbital, primidona, hierba de San Juan</i>)
                pueden <b>reducir de forma marcada</b> las
                concentraciones plasm√°ticas de ciertos ACOD,
                disminuyendo su eficacia anticoagulante. </p>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Rivaroxab√°n</b>: metabolizado en gran parte por
                  CYP3A4. Los inductores potentes pueden disminuir su
                  exposici√≥n entre 50‚Äì80%. <b>Evitar</b> o considerar
                  alternativa, por riesgo de infra-anticoagulaci√≥n. </li>
                <li><b>Apixab√°n</b>: el metabolismo por CYP3A4 es
                  relevante, aunque menor que en rivaroxab√°n. Los
                  inductores potentes reducen significativamente sus
                  niveles. <b>No recomendado</b> salvo ausencia total
                  de alternativas y monitorizaci√≥n estrecha. </li>
                <li><b>Edoxab√°n</b>: metabolismo por CYP3A4 <b>m√≠nimo</b>.
                  Los inductores potentes de CYP3A4 <b>no producen un
                    descenso cl√≠nicamente relevante</b> de sus niveles.
                  <span class="muted">La v√≠a de interacci√≥n relevante en
                    edoxab√°n es P-gp, no CYP3A4.</span> </li>
                <li><b>Dabigatr√°n</b>: <b>no se metaboliza por CYP450</b>.
                  Los inductores de CYP3A4 <b>no afectan la
                    farmacocin√©tica</b>, pero si el f√°rmaco es tambi√©n
                  inductor de P-gp (p. ej., rifampicina), <b>puede
                    reducirse marcadamente su absorci√≥n</b>. <span
                    class="muted">El problema en dabigatr√°n no es
                    CYP3A4, sino P-gp.</span> </li>
              </ul>
              <div style="color:#334155; font-size:12px;
                margin-top:10px;"> <b>Resumen pr√°ctico:</b> evitar <b>rivaroxab√°n</b>
                y preferir evitar <b>apixab√°n</b> con inductores
                potentes de CYP3A4; <b>edoxab√°n</b> no se afecta por
                CYP3A4; <b>dabigatr√°n</b> solo se ve comprometido si el
                inductor tambi√©n act√∫a sobre <b>P-gp</b>. </div>
            </div>
          </div>
        </details>
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">
            ü§Ø Interacciones complejas: P-gp + CYP3A4 </summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üï∏Ô∏è Interacciones combinadas:
              inhibici√≥n / inducci√≥n de P-gp y CYP3A4 </div>
            <div style="padding:16px 18px;">
              <p style="margin:0 0 10px 0;"> Muchos f√°rmacos act√∫an
                simult√°neamente sobre <b>P-gp</b> (transportador
                intestinal y renal) y <b>CYP3A4</b> (enzima metab√≥lica
                hep√°tica), produciendo interacciones mixtas que afectan
                de forma desigual a cada ACOD. </p>
              <p style="margin:0 0 12px 0;"> Comprender estas
                interacciones duales permite seleccionar el
                anticoagulante m√°s seguro y eficaz en escenarios de
                polimedicaci√≥n, oncolog√≠a, cardiolog√≠a o enfermedades
                infecciosas. </p>
              <!-- Ejemplos de f√°rmacos duales -->
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45; margin-bottom:14px;">
                <li><b>Inductores potentes duales (P-gp + CYP3A4):</b>
                  rifampicina, carbamazepina, fenito√≠na, fenobarbital,
                  primidona, Hierba de San Juan.</li>
                <li><b>Inhibidores potentes duales (P-gp + CYP3A4):</b>
                  ketoconazol, itraconazol, posaconazol, voriconazol,
                  claritromicina, inhibidores de proteasa, cobicistat.</li>
              </ul>
              <div style="margin:10px 0; font-weight:700;
                color:#0f3d83;">Efectos sobre cada ACOD</div>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <!-- Dabigatr√°n -->
                <li><b>Dabigatr√°n</b> (muy dependiente de P-gp;
                  metabolismo CYP3A4 irrelevante):<br>
                  ‚Ä¢ <b>Inhibidores duales ‚Üí sobreexposici√≥n</b>
                  marcada: evitar si ClCr &lt;50 mL/min; considerar 110
                  mg/12 h si ClCr ‚â•50.<br>
                  ‚Ä¢ <b>Inductores duales ‚Üí infraexposici√≥n importante</b>:
                  evitar dabigatr√°n. </li>
                <!-- Apixab√°n -->
                <li><b>Apixab√°n</b> (metabolismo mixto: CYP3A4 25‚Äì30% +
                  P-gp):<br>
                  ‚Ä¢ <b>Inhibidores duales ‚Üí aumento significativo de
                    exposici√≥n</b>: considerar reducci√≥n si cumple
                  criterios o evitar.<br>
                  ‚Ä¢ <b>Inductores duales ‚Üí ca√≠da importante del AUC</b>:
                  evitar apixab√°n si el inductor es potente
                  (rifampicina, carbamazepina). </li>
                <!-- Rivaroxab√°n -->
                <li><b>Rivaroxab√°n</b> (dependiente de CYP3A4 30‚Äì35% y
                  P-gp):<br>
                  ‚Ä¢ <b>Inhibidores duales ‚Üí sobreexposici√≥n ‚Üí evitar</b>
                  en la mayor√≠a de escenarios cl√≠nicos.<br>
                  ‚Ä¢ <b>Inductores duales ‚Üí infraexposici√≥n ‚Üí evitar</b>
                  por riesgo de fallo terap√©utico. </li>
                <!-- Edoxab√°n -->
                <li><b>Edoxab√°n</b> (P-gp importante; metabolismo CYP3A4
                  m√≠nimo):<br>
                  ‚Ä¢ <b>Inhibidores duales:</b> ajustar a <b>30 mg/24 h</b>
                  si hay inhibidor potente de P-gp.<br>
                  ‚Ä¢ <b>Inductores duales:</b> riesgo de infraexposici√≥n
                  ‚Üí preferible evitar cuando exista alternativa mejor. </li>
              </ul>
              <div style="margin-top:12px;"> <b>Recomendaci√≥n pr√°ctica
                  combinada:</b><br>
                En presencia de inductores o inhibidores que act√∫an
                simult√°neamente sobre P-gp y CYP3A4, <b>valorar
                  preferentemente VKA</b> o un ACOD con dependencia
                m√≠nima de la v√≠a afectada. </div>
              <div style="margin-top:6px; color:#475569;
                font-size:12px;"> Consultar ficha t√©cnica EMA/FDA para
                cada combinaci√≥n espec√≠fica. </div>
            </div>
          </div>
        </details>
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">
            üí° Algoritmo r√°pido para interacciones con ACOD </summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Cabecera -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üîÅ C√≥mo pensar las interacciones
              con ACOD en 10 segundos </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <p style="margin:0 0 12px 0;"> Las interacciones de los
                ACOD pueden entenderse con un algoritmo mental muy
                simple si se distinguen tres grupos: <b>P-gp</b>, <b>CYP3A4</b>
                y <b>mixtos</b>. Cada grupo afecta de forma diferente a
                cada ACOD. </p>
              <!-- INHIBIDORES -->
              <h4 style="margin:12px 0 6px 0;color:#0f3d83;">üü•
                INHIBIDORES (aumentan la exposici√≥n)</h4>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Inhibidores SOLO de P-gp</b> ‚Üí Aumentan mucho <b>dabigatr√°n</b>
                  y <b>edoxab√°n</b>. Ej.: verapamilo, dronedarona,
                  quinidina, amiodarona, diltiazem, ciclosporina. </li>
                <li><b>Inhibidores SOLO de CYP3A4</b> ‚Üí Aumentan <b>apixab√°n</b>
                  y <b>rivaroxab√°n</b>. Ej.: fluconazol, eritromicina,
                  diltiazem (d√©bil), zumo de pomelo. </li>
                <li><b>Inhibidores MIXTOS (P-gp + CYP3A4)</b> ‚Äî los m√°s
                  potentes ‚Üí Aumentan TODOS los ACOD (especial riesgo en
                  apixab√°n y rivaroxab√°n). Ej.: ketoconazol,
                  itraconazol, posaconazol, voriconazol, claritromicina,
                  ritonavir, cobicistat. </li>
              </ul>
              <div style="margin:8px 0 12px 0; font-size:12px;
                color:#b91c1c;"> ‚ö†Ô∏è Regla r√°pida: si el f√°rmaco inhibe
                AMBAS v√≠as ‚Üí el ACOD casi siempre debe evitarse. </div>
              <!-- INDUCTORES -->
              <h4 style="margin:12px 0 6px 0;color:#0f3d83;">üü¶
                INDUCTORES (disminuyen la exposici√≥n ‚Üí fallo
                terap√©utico)</h4>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Inductores SOLO de P-gp</b> ‚Üí Reducen sobre todo
                  <b>dabigatr√°n</b> y <b>edoxab√°n</b>. Ej.: rifabutina,
                  dexametasona (altas dosis). </li>
                <li><b>Inductores SOLO de CYP3A4</b> ‚Üí Reducen <b>apixab√°n</b>
                  y <b>rivaroxab√°n</b>. Ej.: bosentan, efavirenz,
                  nafcillina. </li>
                <li><b>Inductores MIXTOS (P-gp + CYP3A4)</b> ‚Äî los
                  peligrosos de verdad ‚Üí Infraexposici√≥n GRAVE de TODOS
                  los ACOD. Ej.: <b>rifampicina, carbamazepina,
                    fenito√≠na, fenobarbital, primidona, Hierba de San
                    Juan</b>. </li>
              </ul>
              <div style="margin:8px 0 12px 0; font-size:12px;
                color:#b91c1c;"> ‚ö†Ô∏è Regla r√°pida: si induce P-gp +
                CYP3A4 ‚Üí el ACOD suele quedar contraindicado. Usar VKA.
              </div>
              <!-- RESUMEN -->
              <h4 style="margin:12px 0 6px 0;color:#0f3d83;">üìå Resumen
                ultrarr√°pido</h4>
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Dabigatr√°n</b> ‚Üí muy sensible a <b>P-gp</b>.
                  Inhibidores ‚Üë; inductores ‚Üì‚Üì‚Üì.</li>
                <li><b>Edoxab√°n</b> ‚Üí dependiente de P-gp; ajustar 30
                  mg/24 h si inhibidor potente.</li>
                <li><b>Apixab√°n</b> ‚Üí sensible a <b>CYP3A4</b> y algo a
                  P-gp.</li>
                <li><b>Rivaroxab√°n</b> ‚Üí muy dependiente de <b>CYP3A4</b>.</li>
              </ul>
              <div style="margin-top:12px; font-size:12px;
                color:#475569;"> Para combinaciones espec√≠ficas,
                consultar ficha t√©cnica EMA/FDA. Este algoritmo est√°
                optimizado para toma de decisiones r√°pidas en cl√≠nica. </div>
            </div>
          </div>
        </details>
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üë•

            Casos complejos reales</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Header -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üßë Casos complejos reales: c√≥mo
              decidir r√°pido ante interacciones dif√≠ciles </div>
            <div style="padding:16px 18px;">
              <!-- CASO 1 -->
              <h4 style="margin:8px 0 4px 0;color:#0f3d83;">üß™ Caso 1 ‚Äî
                Paciente con FA + tratamiento antif√∫ngico az√≥lico</h4>
              <p style="margin:0 0 6px 0;"> Mujer de 78 a√±os en apixab√°n
                5 mg/12 h. Se inicia <b>posaconazol</b> por
                aspergilosis. </p>
              <ul
                style="font-size:12px;padding-left:20px;line-height:1.45;">
                <li><b>Tipo de interacci√≥n</b>: inhibidor potente <b>mixto</b>
                  (P-gp + CYP3A4).</li>
                <li><b>Efecto</b>: ‚Üë‚Üë exposici√≥n de apixab√°n ‚Üí alto
                  riesgo hemorr√°gico.</li>
                <li><b>Evitar</b>: apixab√°n y rivaroxab√°n.</li>
                <li><b>Alternativa</b>: cambiar temporalmente a <b>VKA</b>.</li>
              </ul>
              <div
                style="color:#b91c1c;font-size:12px;margin-bottom:12px;">
                ‚ö†Ô∏è Regla cl√≠nica: si antif√∫ngico az√≥lico potente ‚Üí
                evitar ACOD ‚Üí usar VKA. </div>
              <!-- CASO 2 -->
              <h4 style="margin:8px 0 4px 0;color:#0f3d83;">üß™ Caso 2 ‚Äî
                Rifampicina en paciente con dabigatr√°n</h4>
              <p style="margin:0 0 6px 0;"> Var√≥n 65 a√±os en dabigatr√°n
                150 mg/12 h por FA. Se inicia tratamiento
                antituberculoso con <b>rifampicina</b>. </p>
              <ul
                style="font-size:12px;padding-left:20px;line-height:1.45;">
                <li><b>Tipo de interacci√≥n</b>: inductor <b>mixto</b>
                  (P-gp + CYP3A4).</li>
                <li><b>Efecto</b>: ‚Üì‚Üì‚Üì exposici√≥n ‚Üí p√©rdida casi
                  completa de eficacia.</li>
                <li><b>Evitar</b>: TODOS los ACOD.</li>
                <li><b>Alternativa</b>: pasar a <b>acenocumarol/warfarina</b>.</li>
              </ul>
              <div
                style="color:#b91c1c;font-size:12px;margin-bottom:12px;">
                ‚ö†Ô∏è Rifampicina = contraindicaci√≥n pr√°ctica de todos los
                ACOD. </div>
              <!-- CASO 3 -->
              <h4 style="margin:8px 0 4px 0;color:#0f3d83;">üß™ Caso 3 ‚Äî
                Paciente en rivaroxab√°n + claritromicina</h4>
              <p style="margin:0 0 6px 0;"> Hombre 72 a√±os en
                rivaroxab√°n 20 mg/d por FA. Se prescribe <b>claritromicina</b>
                por neumon√≠a. </p>
              <ul
                style="font-size:12px;padding-left:20px;line-height:1.45;">
                <li><b>Tipo de interacci√≥n</b>: inhibidor <b>mixto</b>
                  moderado (P-gp + CYP3A4).</li>
                <li><b>Efecto</b>: ‚Üë exposici√≥n de rivaroxab√°n ‚Üí riesgo
                  hemorr√°gico aumentado.</li>
                <li><b>Evitar</b>: rivaroxab√°n.</li>
                <li><b>Alternativa temporal</b>: apixab√°n solo si bajo
                  riesgo hemorr√°gico o cambiar a VKA.</li>
              </ul>
              <div
                style="color:#b91c1c;font-size:12px;margin-bottom:12px;">
                ‚ö†Ô∏è Claritromicina puede triplicar niveles de
                rivaroxab√°n: revisi√≥n obligada. </div>
              <!-- CASO 4 -->
              <h4 style="margin:8px 0 4px 0;color:#0f3d83;">üß™ Caso 4 ‚Äî
                Amiodarona en paciente con funci√≥n renal limitada</h4>
              <p style="margin:0 0 6px 0;"> Mujer 84 a√±os, ClCr 32
                mL/min, inicia <b>amiodarona</b> estando en dabigatr√°n
                150 mg/12 h. </p>
              <ul
                style="font-size:12px;padding-left:20px;line-height:1.45;">
                <li><b>Tipo de interacci√≥n</b>: inhibidor de <b>P-gp</b>.</li>
                <li><b>Efecto</b>: ‚Üë exposici√≥n de dabigatr√°n.</li>
                <li><b>Ajuste</b>: dabigatr√°n ‚Üí bajar a <b>110 mg/12 h</b>.</li>
                <li><b>Alternativa</b>: considerar apixab√°n si riesgo
                  hemorr√°gico significativo.</li>
              </ul>
              <div
                style="color:#b91c1c;font-size:12px;margin-bottom:12px;">
                ‚ö†Ô∏è Amiodarona + ClCr bajo = mayor riesgo de hemorragia
                digestiva con dabigatr√°n. </div>
              <!-- CASO 5 -->
              <h4 style="margin:8px 0 4px 0;color:#0f3d83;">üß™ Caso 5 ‚Äî
                Anciano fr√°gil con polimedicaci√≥n y antif√∫ngico t√≥pico</h4>
              <p style="margin:0 0 6px 0;"> Var√≥n 89 a√±os, apixab√°n 2,5
                mg/12 h, riesgo hemorr√°gico elevado. Se prescribe <b>itraconazol

                  t√≥pico</b>. </p>
              <ul
                style="font-size:12px;padding-left:20px;line-height:1.45;">
                <li><b>Tipo de interacci√≥n</b>: inhibidor fuerte mixto,
                  pero <b>v√≠a t√≥pica</b>.</li>
                <li><b>Efecto</b>: exposici√≥n sist√©mica m√≠nima ‚Üí <b>no
                    interacci√≥n relevante</b>.</li>
                <li><b>Recomendaci√≥n</b>: continuar apixab√°n; vigilar.</li>
              </ul>
              <div
                style="color:green;font-size:12px;margin-bottom:12px;">
                üí° Recordatorio: los antif√∫ngicos t√≥picos NO producen
                interacci√≥n significativa. </div>
              <!-- CASO 6 -->
              <h4 style="margin:8px 0 4px 0;color:#0f3d83;">üß™ Caso 6 ‚Äî
                Fenito√≠na en paciente con apixab√°n</h4>
              <p style="margin:0 0 6px 0;"> Mujer 70 a√±os en apixab√°n
                por FA. Estando de vacaciones en otro pa√≠s le han
                prescrito fenito√≠na por crisis convulsiva <b>fenito√≠na</b>.
              </p>
              <ul
                style="font-size:12px;padding-left:20px;line-height:1.45;">
                <li><b>Tipo de interacci√≥n</b>: inductor <b>mixto</b>
                  (P-gp + CYP3A4).</li>
                <li><b>Efecto</b>: ‚Üì exposici√≥n de apixab√°n ‚Üí riesgo de
                  fallo emb√≥lico.</li>
                <li><b>Recomendaci√≥n</b>: cambiar fenito√≠na por otro
                  antiepil√©ptico de mejor perfil.</li>
              </ul>
              <div
                style="color:#b91c1c;font-size:12px;margin-bottom:12px;">
                ‚ö†Ô∏è Fenito√≠na es una de las interacciones m√°s peligrosas
                con ACOD. </div>
            </div>
            <!-- padding --> </div>
          <!-- panel --> </details>
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üí¶

            Funci√≥n renal</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra superior tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üíä Ajuste de ACOD por funci√≥n
              renal </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <ul style="font-size:12px; padding-left:20px;
                line-height:1.45;">
                <li><b>Apixab√°n</b>: 2,5 mg/12 h si <b>‚â•2</b> criterios
                  (edad ‚â•80 a, peso ‚â§60 kg, SCr ‚â•1,5 mg/dL) <i>o</i> <b>ClCr

                    15‚Äì29</b> mL/min. Evitar si <b>ClCr &lt;15</b> o
                  di√°lisis (EMA).</li>
                <li><b>Dabigatr√°n</b>: <b>110 mg/12 h</b> si <b>ClCr
                    30‚Äì50</b> mL/min (o riesgo hemorr√°gico alto); <b>contraindicado

                    &lt;30</b>.</li>
                <li><b>Rivaroxab√°n</b>: <b>15 mg/24 h</b> si <b>ClCr
                    15‚Äì49</b> mL/min; <b>contraindicado &lt;15</b>.</li>
                <li><b>Edoxab√°n</b>: <b>30 mg/24 h</b> si <b>ClCr
                    15‚Äì50</b> mL/min o ‚â§60 kg o inhibidor potente P-gp;
                  <b>evitar &lt;15</b>. <span class="muted">Menor
                    eficacia si <b>ClCr &gt;95</b> (etiqueta FDA).</span></li>
              </ul>
              <div><b>Seguimiento de funci√≥n renal:</b> cada 6‚Äì12 meses
                si ClCr &gt;60; cada 3‚Äì6 meses si 30‚Äì60; cada 1‚Äì3 meses
                si &lt;30 o en ancianos/fr√°giles.</div>
            </div>
          </div>
        </details>
        <details style="margin-top:14px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìí

            Glosario de acr√≥nimos</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra superior tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üî§ Acr√≥nimos utilizados </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <style>
    /* 1 columna por defecto */
    .glosario-columns {
      column-count: 1;
      column-gap: 32px;
    }

    /* En pantallas grandes ‚Üí 2 columnas */
    @media (min-width: 900px){
      .glosario-columns {
        column-count: 2;
      }
    }
  </style>
              <ul class="glosario-columns" style="font-size:12px;
                padding-left:20px; line-height:1.45;">
                <li><b>ACOD</b> (o <b>DOAC</b>): Anticoagulantes orales
                  de acci√≥n directa.</li>
                <li><b>AINEs</b>: Antiinflamatorios no esteroideos.</li>
                <li><b>Ao</b>: Aorta.</li>
                <li><b>CHA<sub>2</sub>DS<sub>2</sub>-VA</b>: Escala de
                  riesgo emb√≥lico sin el punto por sexo femenino.</li>
                <li><b>CHA<sub>2</sub>DS<sub>2</sub>-VASc</b>: Escala de
                  riesgo emb√≥lico en fibrilaci√≥n auricular.</li>
                <li><b>ClCr</b>: Aclaramiento de creatinina
                  (Cockcroft‚ÄìGault).</li>
                <li><b>CYP3A4</b>: Citocromo P450 3A4, principal v√≠a metab√≥lica hep√°tica de varios ACOD.</li>
                <li><b>DOAC</b>: Direct Oral Anticoagulants.</li>
                <li><b>EAP</b>: Enfermedad arterial perif√©rica.</li>
                <li><b>EM</b>: Estenosis mitral.</li>
                <li><b>EMA</b>: Agencia Europea del Medicamento.</li>
                <li><b>ERC</b>: Enfermedad renal cr√≥nica.</li>
                <li><b>FDA</b>: Food and Drug Administration.</li>
                <li><b>FA</b>: Fibrilaci√≥n auricular.</li>
                <li><b>GI</b>: Gastrointestinal.</li>
                <li><b>GU</b>: Genitourinario.</li>
                <li><b>HAS-BLED</b>: Escala de riesgo de sangrado mayor.</li>
                <li><b>HDA</b>: Hemorragia digestiva alta.</li>
                <li><b>HIC</b>: Hemorragia intracraneal.</li>
                <li><b>HTA</b> / <b>HTN</b>: Hipertensi√≥n arterial.</li>
                <li><b>IAM</b>: Infarto agudo de miocardio.</li>
                <li><b>IMC</b>: √çndice de masa corporal.</li>
                <li><b>NNH</b>: N√∫mero necesario para da√±ar.</li>
                <li><b>NNT</b>: N√∫mero necesario para tratar.</li>
                <li><b>NOAC</b>: Non‚Äìvitamin K Oral Anticoagulants.</li>
                <li><b>P-gp</b>: P-glicoprote√≠na, transportador de eflujo intestinal/renal implicado en absorci√≥n y eliminaci√≥n de ACOD.</li>
                <li><b>RI</b>: Riesgo anual de ictus.</li>
                <li><b>RRA</b>: Reducci√≥n absoluta del riesgo.</li>
                <li><b>RRR</b>: Reducci√≥n relativa del riesgo.</li>
                <li><b>RS</b>: Riesgo anual de sangrado mayor.</li>
                <li><b>SCr</b>: Creatinina s√©rica.</li>
                <li><b>SNG</b>: Sonda nasog√°strica.</li>
                <li><b>VKA</b>: Antagonistas de la vitamina K.</li>
                <li><b>VI</b>: Ventr√≠culo izquierdo.</li>
              </ul>
            </div>
          </div>
        </details>
        <details style="margin-top:14px;">
  <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìò Referencias bibliogr√°ficas</summary>

  <div style="
    margin-top:14px;
    background:#ffffff;
    border:1px solid #d0d7e1;
    border-radius:10px;
    box-shadow:0 2px 6px rgba(0,0,0,0.05);
    overflow:hidden;
    font-size:13px;
    line-height:1.55;
    color:#1e293b;
  ">

    <!-- BARRA T√çTULO -->
    <div style="
      background:#0f3d83;
      color:#ffffff;
      padding:10px 14px;
      font-size:14px;
      font-weight:700;
      letter-spacing:0.3px;
    ">
      üìö Referencias bibliogr√°ficas (formato Vancouver)
    </div>

    <!-- CONTENIDO -->
    <div style="padding:16px 18px;">
      <ol style="font-size:12px; padding-left:20px; line-height:1.45;">

        <li>Friberg L, Rosenqvist M, Lip GYH. Evaluation of risk stratification schemes for ischaemic stroke and bleeding in 182,678 patients with atrial fibrillation. <i>Eur Heart J</i>. 2012;33(12):1500-10. <a href="https://doi.org/10.1093/eurheartj/ehr488" target="_blank">doi:10.1093/eurheartj/ehr488</a></li>

        <li>Olesen JB, Lip GYH, Hansen ML, et al. Validation of risk stratification schemes for predicting stroke and thromboembolism in atrial fibrillation. <i>BMJ</i>. 2011;342:d124. <a href="https://www.bmj.com/content/342/bmj.d124" target="_blank">BMJ link</a></li>

        <li>Pisters R, Lane DA, Nieuwlaat R, de Vos CB, Crijns HJGM, Lip GYH. A novel user-friendly score (HAS-BLED) to assess 1-year risk of major bleeding in atrial fibrillation. <i>Chest</i>. 2010;138(5):1093-100. <a href="https://doi.org/10.1378/chest.10-0134" target="_blank">doi:10.1378/chest.10-0134</a></li>

        <li>Lip GYH, Frison L, Halperin JL, Lane DA. Comparative validation of the HAS-BLED score in anticoagulated patients with AF. <i>J Am Coll Cardiol</i>. 2011;57(2):173-80. <a href="https://doi.org/10.1016/j.jacc.2010.09.024" target="_blank">doi:10.1016/j.jacc.2010.09.024</a></li>

        <li>Cockcroft DW, Gault MH. Prediction of creatinine clearance from serum creatinine. <i>Nephron</i>. 1976;16(1):31-41. <a href="https://pubmed.ncbi.nlm.nih.gov/1244564/" target="_blank">PMID:1244564</a></li>

        <li>Granger CB, Alexander JH, McMurray JJV, et al. Apixaban versus warfarin in atrial fibrillation (ARISTOTLE). <i>N Engl J Med</i>. 2011;365:981-92. <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1107039" target="_blank">NEJM</a></li>

        <li>Connolly SJ, Ezekowitz MD, Yusuf S, et al. Dabigatr√°n versus warfarina en fibrilaci√≥n auricular (RE-LY). <i>N Engl J Med</i>. 2009;361:1139-51. <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa0905561" target="_blank">NEJM</a></li>

        <li>Patel MR, Mahaffey KW, Garg J, et al. Rivaroxab√°n versus warfarina en FA (ROCKET-AF). <i>N Engl J Med</i>. 2011;365:883-91. <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1009638" target="_blank">NEJM</a></li>

        <li>Giugliano RP, Ruff CT, Braunwald E, et al. Edoxab√°n versus warfarina en FA (ENGAGE AF‚ÄìTIMI 48). <i>N Engl J Med</i>. 2013;369:2093-104. <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1310907" target="_blank">NEJM</a></li>

        <li>Hart RG, Pearce LA, Aguilar MI. Antithrombotic therapy to prevent stroke in atrial fibrillation: meta-analysis. <i>Ann Intern Med</i>. 2007;146:857-67. <a href="https://pubmed.ncbi.nlm.nih.gov/17577005/" target="_blank">PMID:17577005</a></li>

        <li>Aguilar MI, Hart RG, Pearce LA. Antithrombotic therapy for AF. <i>Cochrane Database Syst Rev</i>. 2005;(4):CD001927. <a href="https://doi.org/10.1002/14651858.CD001927.pub2" target="_blank">doi:10.1002/14651858.CD001927.pub2</a></li>

        <li>Van Gelder IC, et al. 2024 ESC Guidelines for the management of atrial fibrillation. <i>Eur Heart J</i>. 2024;45(36):3314‚Äì?. <a href="https://academic.oup.com/eurheartj/article/45/36/3314/7738779" target="_blank">OUP</a></li>

        <li>Joglar JA, et al. 2023 ACC/AHA/ACCP/HRS Guideline for the diagnosis and management of atrial fibrillation. <i>Circulation</i>. 2023;148:eXXX-eXXX. <a href="https://doi.org/10.1161/CIR.0000000000001193" target="_blank">doi:10.1161/CIR.0000000000001193</a></li>

        <li>Steffel J, Collins R, Antz M, et al. 2021 EHRA Practical Guide on NOACs. <i>Europace</i>. 2021;23(10):1612-76. <a href="https://doi.org/10.1093/europace/euab065" target="_blank">doi:10.1093/europace/euab065</a></li>

        <li>EMA. SmPC: Apixaban (Eliquis). 2024. 
          <a href="https://www.ema.europa.eu/en/documents/product-information/eliquis-epar-product-information_en.pdf" target="_blank">EMA</a>
        </li>

        <li>EMA. SmPC: Rivaroxaban (Xarelto). 2024.
          <a href="https://www.ema.europa.eu/en/documents/product-information/xarelto-epar-product-information_en.pdf" target="_blank">EMA</a>
        </li>

        <li>EMA. SmPC: Edoxaban (Lixiana). 2024.
          <a href="https://www.ema.europa.eu/en/documents/product-information/lixiana-epar-product-information_en.pdf" target="_blank">EMA</a>
        </li>

        <li>EMA. SmPC: Dabigatran (Pradaxa). 2024.
          <a href="https://www.ema.europa.eu/en/documents/product-information/pradaxa-epar-product-information_en.pdf" target="_blank">EMA</a>
        </li>

        <li>FDA. Savaysa (edoxaban) boxed warning: reduced efficacy if CrCl >95 mL/min. 2015.
          <a href="https://www.accessdata.fda.gov/drugsatfda_docs/label/2015/206316lbl.pdf" target="_blank">FDA</a>
        </li>

        <li>Radadiya D, et al. Major gastrointestinal bleeding risk with DOACs: network meta-analysis. <i>Eur J Gastroenterol Hepatol</i>. 2021;33:e50-8. <a href="https://doi.org/10.1097/MEG.0000000000002035" target="_blank">doi</a></li>

        <li>Mamas MA, et al. Meta-analysis comparing apixaban vs rivaroxaban in AF. <i>Am J Cardiol</i>. 2022;170:33-43. <a href="https://www.ajconline.org/article/S0002-9149(21)01148-6/fulltext" target="_blank">Full text</a></li>

        <li>Ruff CT, et al. Comparison of DOACs vs warfarin in AF: meta-analysis. <i>Lancet</i>. 2014;383:955-62. <a href="https://doi.org/10.1016/S0140-6736(13)62343-0" target="_blank">doi</a></li>

        <li>Song Y, et al. Relative bioavailability of apixaban crushed/oral/NGT. <i>Clin Ther</i>. 2015;37:1703-12. <a href="https://doi.org/10.1016/j.clinthera.2015.05.497" target="_blank">doi</a></li>

        <li>Duchin K, et al. Pharmacokinetics of crushed edoxaban via NGT or puree. <i>Clin Pharmacokinet</i>. 2018;57:221-8. <a href="https://pubmed.ncbi.nlm.nih.gov/28512699/" target="_blank">PMID</a></li>

        <li>Byon W, et al. Apixaban pharmacokinetic/pharmacodynamic overview. <i>Clin Pharmacokinet</i>. 2019;58:1265-79.</li>

        <li>Martin K, et al. Use of DOACs in obesity: ISTH SSC communication. <i>J Thromb Haemost</i>. 2021;19:1874-82.</li>

      </ol>
    </div>
  </div>
</details>

      </div>
    </div>
    <!-- Componente universal de advertencia contextual -->
    <script>
    (()=>{
      class AppDisclaimer extends HTMLElement{
        static get observedAttributes(){ return ["data-version","data-context","data-target","data-position","data-when","data-require"]; }
        constructor(){ super(); this._shadow=this.attachShadow({mode:"open"}); this._render(); }
        connectedCallback(){ this._ensureMounted(); this._setupObservers(); }
        attributeChangedCallback(){ this._render(); this._ensureMounted(); }
        _render(){
          this._shadow.innerHTML=`
        <style>
          :host{display:block}
          .box{font-family: Verdana, Geneva, Tahoma, sans-serif;color: var(--ink,#0f172a);background:#fff5f5;border:1px solid #fbd5d5;border-left:4px solid var(--bad,#b71c1c);border-radius:12px;padding:12px 14px;margin:12px 0 0 0;line-height:1.45}
          .box strong{ color: var(--bad,#b71c1c); }
          .hidden{ display:none!important; }
        </style>
        <aside class="box hidden" role="note" aria-label="Advertencia de uso">
          <strong>Advertencia.</strong> Esta herramienta es un <b>apoyo</b> a la decisi√≥n cl√≠nica;
          no sustituye el juicio profesional, la valoraci√≥n individual del paciente ni los
          <b>protocolos/gu√≠as locales actualizados</b>. Verifique siempre indicaciones,
          contraindicaciones, interacciones, posolog√≠a y disponibilidad seg√∫n su centro.
          Ante discrepancias, <b>prevalecen los protocolos vigentes</b> y el criterio del equipo responsable.
        </aside>`;
        }
        _getTarget(){
          const explicit=this.getAttribute("data-target");
          if(explicit){ try{const el=document.querySelector(explicit); if(el) return el;}catch(_){ }
          }
          const candidates=["#resultCard",".resultado","#resultado",".result","#result",".recomendacion",".recommendation",".output","#output",".rope-result",".calc-result",".box-result",".card-result"];
          for(const sel of candidates){ const el=document.querySelector(sel); if(el) return el; }
          return null;
        }
        _ensureMounted(){
          const tgt=this._getTarget();
          if(tgt){ this._mountTo(tgt); return; }
          if(this._waitMO) return;
          this._waitMO=new MutationObserver(()=>{ const t=this._getTarget(); if(t){ this._mountTo(t); this._waitMO.disconnect(); this._waitMO=null; }});
          this._waitMO.observe(document.body,{childList:true,subtree:true});
        }
        _mountTo(tgt){
          if(this._mountedTo===tgt) return; this._mountedTo=tgt;
          const pos=(this.getAttribute("data-position")||"after").toLowerCase();
          if(pos==="before"){ tgt.insertAdjacentElement("beforebegin",this); }
          else if(pos==="inside-start"){ tgt.insertAdjacentElement("afterbegin",this); }
          else if(pos==="inside-end"){ tgt.insertAdjacentElement("beforeend",this); }
          else{ tgt.insertAdjacentElement("afterend",this); }
        }
        _setupObservers(){
          const tgt=this._getTarget(); if(!tgt) return;
          this._mo && this._mo.disconnect();
          this._mo=new MutationObserver(()=>this._evaluateVisibility());
          this._mo.observe(tgt,{attributes:true,attributeFilter:["class","style","aria-hidden"],subtree:false});
          this._contentMO && this._contentMO.disconnect();
          this._contentMO=new MutationObserver(()=>this._evaluateVisibility());
          const recList=document.querySelector("#recList"); if(recList) this._contentMO.observe(recList,{childList:true,subtree:false});
          const compBody=document.querySelector("#comparative tbody"); if(compBody) this._contentMO.observe(compBody,{childList:true,subtree:false});
          this._io && this._io.disconnect();
          this._io=new IntersectionObserver((entries)=>{const visible=entries.some(e=>e.isIntersecting);this._evaluateVisibility(visible);},{root:null,threshold:0.01});
          this._io.observe(tgt);
          this._tick && clearInterval(this._tick);
          this._tick=setInterval(()=>this._evaluateVisibility(),500);
          this._evaluateVisibility();
        }
        _hasComputedResult(){
          if (typeof window!=="undefined" && window.__lastReport) return true;
          const hasRec = !!document.querySelector("#recList li");
          const hasRows = !!document.querySelector("#comparative tbody tr");
          const btnP=document.getElementById('btnPrint'), btnC=document.getElementById('btnCopy');
          const buttonsReady = !!(btnP && btnC && !btnP.disabled && !btnC.disabled);
          return hasRec || hasRows || buttonsReady;
        }
        _evaluateVisibility(ioVisible){
          const tgt=this._getTarget(); if(!tgt){ this._setVisible(false); return; }
          const style=getComputedStyle(tgt);
          const displayOk=style.display!=="none" && style.visibility!=="hidden" && style.opacity!=="0";
          const classOk=!(tgt.classList && tgt.classList.contains("hidden"));
          const showOk=(tgt.classList && (tgt.classList.contains("show")||tgt.classList.contains("active"))) || tgt.getAttribute("aria-hidden")==="false";
          const when=(this.getAttribute("data-when")||"visible").toLowerCase();
          const require=(this.getAttribute("data-require")||"report").toLowerCase();
          const logicalVisible = (when==="always") ? true : (showOk || (displayOk && classOk));
          let computedOk=true;
          if(require==="report"){ computedOk = this._hasComputedResult(); }
          else if(require==="rows"){ const rec = !!document.querySelector("#recList li"); const rows=!!document.querySelector("#comparative tbody tr"); computedOk = (rec||rows); }
          const finalVisible = logicalVisible && computedOk && (ioVisible===undefined ? true : ioVisible);
          this._setVisible(finalVisible);
        }
        _setVisible(flag){ const box=this._shadow.querySelector(".box"); if(box) box.classList.toggle("hidden",!flag); }
      }
      if(!customElements.get("app-disclaimer")){ customElements.define("app-disclaimer",AppDisclaimer); }
    })();
    </script>
    <script src="../js/index.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  if (window.Capacitor && Capacitor.getPlatform() === "android") {
    const btnPrint = document.getElementById("btnPrint");
    if (btnPrint) btnPrint.style.display = "none";
  }
});
</script>
    <footer> <img src="../img/uibanner.png" alt="Ictus GPS"> </footer>
  </body>
</html>
