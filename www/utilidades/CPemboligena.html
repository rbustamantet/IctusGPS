<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Otras cardiopat√≠as embol√≠genas</title>
<meta name="theme-color" content="#0f3d83">
<link rel="icon" type="image/png" sizes="192x192" href="../iconos/ictusgps.png">
<link rel="apple-touch-icon" sizes="180x180" href="../iconos/ictusgps.png">

<style>
/* VARIABLES B√ÅSICAS */
:root{
  --bg:#f8fafc; 
  --ink:#0e1a33;
  --azul:#0f3d83;
  --border:#e5e9f2;
  --muted:#64748b;
  --azul-light:#e4edfa;
  --azul-mid:#2563eb;
  --azul-dark:#0d2d63;
}

/* TIPOGRAF√çA */
html, body { font-family: Verdana, Geneva, sans-serif; }
*{box-sizing:border-box}

/* SAFE-TOP */
body{
  margin:0;
  padding-top:calc(env(safe-area-inset-top, 0px) + 52px);
  background:var(--bg);
  color:var(--ink);
}

.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top) + 60px);
  background: var(--azul);
  z-index: 1001;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: env(safe-area-inset-top);
}

.safe-content{
  width:100%;
  max-width:1080px;
  padding: 6px 16px 8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.safe-left{
  display:flex; align-items:center; gap:10px;
}
.safe-mini{width:44px;height:44px;object-fit:contain;padding:4px;}
.safe-logo{height:44px;width:auto;}

.safe-actions{display:flex; gap:10px;}
.safe-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:40px;height:40px;
  background:rgba(255,255,255,0.15);
  border:1px solid white;
  border-radius:50%;
}
.safe-btn:hover{background:#01c5fe;}
.safe-icon{width:32px;height:32px;}

/* CABECERA */
header{
  position:sticky;
  top:calc(env(safe-area-inset-top) + 52px);
  z-index:1002;
  background:var(--azul);
  color:#fff;
  height:52px;
  display:flex;
  justify-content:center;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,.08);
}

.title{display:flex;align-items:center;font-size:1.3rem;font-weight:700;}
.title img{width:32px;height:32px;margin-right:8px;}

/* CONTENIDO */
.wrap{max-width:1080px;margin:0 auto;padding:1rem;}
.howto{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 2px 2px var(--muted);
  padding:1rem;
  margin:.3rem 0 1rem;
  font-size:14px;
}
.panel{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 3px 14px rgba(16,71,119,.12);
  border:1px solid var(--border);
}

.block{
  background: linear-gradient(to bottom, #f2f7ff, #e9f1ff);
  border-left:4px solid #2563eb;
  border-radius:14px;
  padding:16px;
  margin:18px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}
.boton{
  background: #FFF;
  border-left:4px solid blue;
  border-radius:14px;
  padding:12px;
  margin:18px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}
select{
  padding:12px;
  border-radius:10px;
  border:1px solid #d4e2ff;
  background:#ffffff;
  font-size:1rem;
  width:100%;
  box-shadow:0 2px 6px rgba(0,0,0,0.03);
}
select:focus{
  outline:none;
  border:1px solid #0f3d83;
  box-shadow:0 0 0 1px rgba(15,61,131,0.2);
}


.block h3{
  margin:0 0 10px;
  font-size:1.1rem;
  font-weight:800;
  display:flex;
  gap:6px;
}
.icon-h3{
  width:20px;
  height:20px;
  margin-right:6px;
}

/* FACTORES */
label.row{
  display:flex;
  gap:8px;
  margin:6px 0;
  font-size:.93rem;
  align-items:flex-start;
}
label.row input{transform:scale(1.1);margin-top:3px;accent-color:#0f3d83;}
label.row:hover{
  background:#f1f6ff;
  border-radius:8px;
}


#patologia-resultado{
  background: #F7FFF7;
  border-left:4px solid green;
  border-radius:14px;
  padding:16px;
  margin:8px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}
#patologia-resultado b{
  color:#0f3d83;
}

.note{
  color:var(--muted);
  font-size:.85rem;
  margin-top:8px;
}

/* TOAST */
.toast{
  position:fixed;
  top:calc(env(safe-area-inset-top,0px) + 8px);
  right:16px;
  background:#b71c1c;
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:1200;
}
.toast.show{opacity:1; pointer-events:auto;}
/* DISCLAIMER FINAL */
.disclaimer-red{
  background:#fef2f2;
  border:1px solid #fecaca;
  border-radius:12px;
  margin:0 auto;
  padding:1rem;
  max-width:1080px;
  box-shadow:0 2px 8px rgba(185,28,28,0.05);
}
.disclaimer-red{
  background:#fff7f7;
  border-left:4px solid #d9534f;
  box-shadow:0 1px 4px rgba(217,83,79,0.05);
}
.disclaimer-red p{
  color:#7d1a1a;
}

.arrow{
  font-size:1.1rem;
  transition:transform 0.25s ease;
  color:#0f3d83;
}

.biblio-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  padding:4px 0;
}

.biblio-content {
  max-height: 0;
  overflow-y: auto;
  margin-top: 10px;
  padding: 0px;
  font-size:0.65rem;
  transition:max-height 0.35s ease, padding 0.3s ease;
}

.biblio-content.open{
  max-height:300;
  padding-top:10px;
}

/* Pie */
footer{
  width:100%;
  margin:2rem 0 0;
  padding:1.5rem 0;
  border-top:1px solid #e5e7eb;
  background:#ffffff;
  text-align:center;
  box-shadow:0 -2px 6px rgba(0,0,0,0.04);
}
footer img{max-width:320px;height:auto;opacity:.95}


/* =========================================================
   MEDIA QUERIES / BODY PADDING
========================================================= */
@media(max-width:768px){
  header{font-size:1.05rem;}
  body{font-size:0.96rem;}
}

/* Empuja el contenido real por debajo de la barra superior */
body{
  padding-top:calc(env(safe-area-inset-top, 0px) + 52px);
  background-color:#f8fafc;
}

/* Animaci√≥n para actualizaci√≥n suave */
.fade-in{
  animation: fadeIn 0.25s ease-out;
}

@keyframes fadeIn{
  from{
    opacity:0;
    transform:translateY(4px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}
.boton-opcion {
display: inline-block;
font-weight: bold;
font-size: 1rem;
padding: 12px 24px;
margin: 2px 2px;
color: blue;
border: 1px solid blue;
background-color: #e9f1ff;
border-radius: 14px;
cursor: pointer;
transition: background-color 0.2s, color 0.2s;
}
.boton-opcion:hover {
background-color: blue;
color: white;
}
</style>
</head>

<body>

<!-- SAFE TOP -->
<div class="safe-top">
  <div class="safe-content">
    <div class="safe-left">
      <img src="../iconos/utilidadesico.png" class="safe-mini">
      <img src="../img/topbar.png" class="safe-logo">
    </div>
    <div class="safe-actions">
      <a href="javascript:history.back()" class="safe-btn">
        <img src="../iconos/atrastransparente.png" class="safe-icon">
      </a>
      <a href="../index.html" class="safe-btn">
        <img src="../iconos/hometransparente.png" class="safe-icon">
      </a>
    </div>
  </div>
</div>

<header>
  <div class="title">
    <img src="../iconos/cardiopatiasico.png">
    Otras cardiopat√≠as embol√≠genas
  </div>
</header>

<main class="wrap">

<div class="howto">Las <b>cardiopat√≠as embol√≠genas</b> no relacionadas con FA o FOP requieren una valoraci√≥n individualizada del riesgo emb√≥lico. Esta herramienta permite identificar los <b>factores relevantes</b> de cada entidad y orientar la <b>estrategia antitromb√≥tica</b> m√°s adecuada seg√∫n la evidencia disponible.</div>

  <!-- √öNICO BLOQUE -->
  <div class="block" id="patologia-section">
<h3>ü©∫ Patolog√≠a card√≠aca embol√≠gena</h3>

    <label><b>Seleccione la entidad principal:</b></label>
    <select id="patologia" onchange="mostrarFactoresPatologia()">
      <option value="" disabled selected>Seleccione una patolog√≠a‚Ä¶</option>
      <option value="hipertrofica">Miocardiopat√≠a hipertr√≥fica</option>
      <option value="iam">Infarto agudo de miocardio</option>
      <option value="dilatada">Miocardiopat√≠a dilatada</option>
      <option value="isquemica">Miocardiopat√≠a isqu√©mica</option>
      <option value="restrictiva">Miocardiopat√≠a restrictiva</option>
      <option value="tako">Miocardiopat√≠a de Tako-Tsubo</option>
      <option value="mixoma">Mixoma auricular</option>
      <option value="valvular">Pr√≥tesis valvulares / Cardiopat√≠a valvular</option>
      <option value="endocarditis">Endocarditis infecciosa</option>
      <option value="sicksinus">S√≠ndrome del seno enfermo</option>
      <option value="auricula">Aur√≠cula izquierda / orejuela</option>
    </select>

    <div id="patologia-factores" style="margin-top:12px;"></div>
</div>



<div id="patologia-resultado">
<h3>‚úÖ Recomendaci√≥n</h3>
<p>Seleccione un escenario cl√≠nico para mostrar la recomendaci√≥n orientativa de tratamiento.</p>
</div>


<!-- BOTONES DE ACCION -->
<div class="boton" id="botones-patologia" style="display:none; margin-top: 2px; text-align:center;">
<button onclick="borrarFormulario()" class="boton-opcion">Borrar</button>
<button onclick="copiarResumen()" class="boton-opcion">Copiar recomendaci√≥n</button>
</div>
<!-- DISCLAIMER -->
<section class="disclaimer-red">
  <p>
    <b>üìõAdvertencia.</b> Esta herramienta tiene car√°cter orientativo y no sustituye el juicio cl√≠nico del profesional ni los protocolos locales.
    Las recomendaciones deben integrarse con la situaci√≥n individual del paciente, las gu√≠as vigentes y la discusi√≥n multidisciplinar cuando proceda.
  </p>
</section>
<div class="howto">
<div class="biblio-header" onclick="toggleBiblio()">
   <h3 style="margin:0; display:flex; align-items:center; gap:8px;">üìö Bibliograf√≠a</h3>
    <span id="biblio-arrow" class="arrow">‚ñº</span>
  </div>
<div id="biblio-contenido" class="biblio-content">

  <ol style="margin:0; padding-left:20px; line-height:1.45;">

    <!-- GENERAL DE CARDIOEMBOLISMO -->
    <li>Arboix A, Ali√≥ J. Cardioembolic stroke: clinical features, cardiac disorders and prognosis. <i>Cerebrovasc Dis</i>. 2010;29:321‚Äì330.</li>
    <li>Sacchetti D, Furie KL, Yaghi S. Cardioembolic Stroke: Mechanisms & Therapeutics. <i>Semin Neurol</i>. 2017;37:370‚Äì387.</li>
    <li>Yaghi S, Bernstein RA, Passman R, Okin PM. Cryptogenic stroke: targeted workup for occult cardiac disease. <i>Stroke</i>. 2024.</li>
    <li>Peci√±a JL et al. Cardiac imaging for embolic stroke of undetermined source. <i>JACC</i>. 2021;77(8):1024‚Äì1038.</li>

    <!-- MIOCARDIOPAT√çA HIPERTR√ìFICA -->
    <li>Guttmann OP et al. Atrial fibrillation and thromboembolism in hypertrophic cardiomyopathy. <i>Heart</i>. 2014;100:465‚Äì472.</li>
    <li>O'Mahony C et al. Atrial Fibrillation in HCM: disease mechanisms and outcomes. <i>JACC</i>. 2019.</li>

    <!-- INFARTO AGUDO DE MIOCARDIO / TROMBO VENTRICULAR -->
    <li>McCarthy CP et al. Left ventricular thrombus after acute MI. <i>JAMA Cardiol</i>. 2019;4:642‚Äì651.</li>
    <li>Attenhofer Jost CH et al. Imaging of LV thrombus: echo, CT and MRI. <i>JACC Img</i>. 2020.</li>
    <li>Delewi R, et al. LV thrombus prevention & management after MI. <i>EHJ</i>. 2012;33:917‚Äì923.</li>

    <!-- MIOCARDIOPAT√çA DILATADA -->
    <li>de Gregorio C. Ventricular thrombus in DCM: incidence & management. <i>Cardiology</i>. 2020.</li>
    <li>Hsu JC et al. Thromboembolism risk in dilated cardiomyopathy. <i>Heart Rhythm</i>. 2016.</li>

    <!-- MIOCARDIOPAT√çA ISQU√âMICA -->
    <li>Solomon SD et al. Ventricular remodeling after MI and embolic risk. <i>NEJM</i>. 2010.</li>
    <li>Weinsaft JW et al. LV thrombus: MRI vs echo accuracy. <i>JACC Img</i>. 2009.</li>
    <li>Yaghi S, Kamel H. Ischemic cardiomyopathy & embolic stroke. <i>Stroke</i>. 2017.</li>

    <!-- MIOCARDIOPAT√çA RESTRICTIVA -->
    <li>Damy T, et al. Thromboembolic complications in amyloidosis. <i>EHJ</i>. 2021.</li>
    <li>Dubrey S, Hawkins PN. Amyloid heart disease review. <i>BMJ</i>. 2020.</li>

    <!-- TAKO-TSUBO -->
    <li>Templin C et al. Takotsubo cardiomyopathy registry. <i>NEJM</i>. 2015.</li>
    <li>Stiermaier T et al. LV thrombus in Tako-Tsubo: incidence & outcomes. <i>JACC</i>. 2016.</li>

    <!-- MIXOMA AURICULAR / TUMORES CARD√çACOS -->
    <li>Reynen K. Cardiac myxomas. <i>NEJM</i>. 1995;333:1610‚Äì1617.</li>
    <li>Gowda RM et al. Embolic stroke from cardiac tumors. <i>Int J Cardiol</i>. 2003.</li>

    <!-- ENDOCARDITIS INFECCIOSA -->
    <li>Baddour LM et al. AHA Infective Endocarditis Guidelines. <i>Circulation</i>. 2015.</li>
    <li>Habib G et al. ESC Guidelines for Infective Endocarditis. <i>Eur Heart J</i>. 2015.</li>
    <li>Murdoch DR, et al. Neurological complications in endocarditis. <i>Lancet Neurol</i>. 2009.</li>

    <!-- VALVULOPAT√çAS / PR√ìTESIS -->
    <li>Baumgartner H et al. 2021 ESC/EACTS Guidelines for valvular heart disease.</li>
    <li>Nishimura RA et al. 2020 ACC/AHA Guidelines for valve disease.</li>
    <li>Kernan WN et al. Stroke prevention in valvular disease. <i>Stroke</i>. 2014.</li>
    <li>Pibarot P, et al. TAVI: antithrombotic strategies. <i>JACC</i>. 2020.</li>

    <!-- S√çNDROME DEL SENO ENFERMO / FA OCULTA -->
    <li>Sanna T et al. CRYSTAL-AF: detection of occult AF after stroke. <i>NEJM</i>. 2014.</li>
    <li>Steinberg JS et al. LOOP Study: AF screening and stroke risk. <i>Lancet</i>. 2021.</li>

    <!-- AUR√çCULA IZQUIERDA / OREJUELA -->
    <li>Di Biase L et al. LA/LAA morphology & stroke risk. <i>Heart Rhythm</i>. 2012.</li>
    <li>Fatkin D et al. LA enlargement as predictor of stroke. <i>EHJ</i>. 1994.</li>
    <li>Glikson M et al. EHRA consensus on LAA occlusion. 2020.</li>

    <!-- MASAS Y TROMBOS CARD√çACOS (GENERAL) -->
    <li>Goyal P et al. Cardiac masses & thrombi: multimodality imaging. <i>JACC Img</i>. 2020.</li>
    <li>Weinsaft JW et al. MRI vs echo for thrombus detection. <i>Circulation</i>. 2008.</li>

    <!-- PREVENCI√ìN / ESTRATEGIA ANTITROMB√ìTICA -->
    <li>Kernan WN et al. AHA/ASA Stroke Prevention Guidelines. <i>Stroke</i>. 2021.</li>
    <li>Hindricks G et al. 2020 ESC Guidelines for Atrial Fibrillation (fundamentales para ACOD/AVK).</li>

    <!-- SISTEM√ÅTICAS / REVISI√ìN GLOBAL -->
    <li>Giacalone G et al. Prevention strategies for cardioembolic stroke. <i>Open Neurol J</i>. 2010.</li>
    <li>Bhat R et al. Embolic strokes of undetermined source: diagnosis & management. <i>Stroke</i>. 2021.</li>
    <li>Yoshihara S et al. Cardiac causes of embolic stroke. <i>World J Radiol</i>. 2023.</li>
  </ol>
</div></div>


<div id="toast" class="toast"></div>

<script>
/* ============================
   FACTORES POR PATOLOG√çA
=============================== */
const factoresPatologia = {
  hipertrofica: ['FA parox√≠stica'],
  iam: ['IAM anterior extenso', 'FE < 40%', 'Trombo cavitario', 'Ictus periinfarto'],
  dilatada: ['FE ‚â§ 28%', 'Trombo apical', 'FA concomitante'],
  isquemica: ['Zonas acin√©ticas o hipocin√©ticas', 'Trombo mural documentado', 'FE ‚â§ 35%', 'Antecedente de ictus cardioemb√≥lico'],
  restrictiva: ['FA documentada', 'Trombos auriculares', 'Amiloidosis confirmada'],
  tako: ['FA concomitante', 'Trombo ventricular', 'FE < 40%'],
  mixoma: ['Trombo en aur√≠cula', 'Ictus cardioemb√≥lico'],
  valvular: ['V√°lvula mec√°nica', 'Pr√≥tesis Biol√≥gica A√≥rtica (TAVI/Quir√∫rgica)', 'Pr√≥tesis Biol√≥gica Mitral/Tric√∫spide', 'Estenosis mitral moderada-severa', 'FA concomitante', 'Complicaciones tromboemb√≥licas previas'],
  endocarditis: ['Complicaciones neurol√≥gicas', 'Aneurismas mic√≥ticos'],
  sicksinus: ['FA Parox√≠stica/Cr√≥nica documentada', 'Antecedente de ictus/embolia sist√©mica'],
auricula: [
  'Trombo en aur√≠cula izquierda / orejuela',
  'Estenosis mitral moderada-severa',
  'FA concomitante',
  'Dilataci√≥n auricular severa',
  'FEVI < 35%',
  'Ictus cardioemb√≥lico previo'
]
};

const patologiaAutoChecks = {
  'Insuficiencia Card√≠aca (1 pto)': {cCongest: true},
  'Hipertensi√≥n (1 pto)': {cHTN: true},
  'Diabetes (1 pto)': {cDiab: true},
  'Ictus/AIT/TE previo (2 ptos)': {cStroke: true, hStroke: true},
  'Enfermedad Vascular (1 pto)': {cVasc: true},
  'FA parox√≠stica': {cCongest: true}, 
  'FA concomitante': {cCongest: true}, 
  'FA documentada': {cCongest: true}, 
  'FA Parox√≠stica/Cr√≥nica documentada': {cCongest: true}, 
  'Ictus periinfarto': {cStroke: true, hStroke: true},
  'Antecedente de ictus cardioemb√≥lico': {cStroke: true, hStroke: true},
  'Complicaciones tromboemb√≥licas previas': {cStroke: true, hStroke: true},
};

let autoCheckedState = {};

/* Mostrar/ocultar bloque de escalas seg√∫n presencia de FA en los factores seleccionados */
function updateEscalasVisibility() {
  const escalasBlock = document.getElementById('escalas-block');
  if (!escalasBlock) return;

  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => (el.value || '').toUpperCase());

  const hasFA = riesgos.some(txt =>
    txt.includes('FA ') || txt.startsWith('FA')
  );

  escalasBlock.style.display = hasFA ? '' : 'none';
}

function aplicarAutoChecks() {
  Object.keys(autoCheckedState).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.checked = false;
  });
  autoCheckedState = {};

  const patologia = document.getElementById("patologia").value;
  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => el.value);

  riesgos.forEach(riesgo => {
    if (patologiaAutoChecks[riesgo]) {
      const targets = patologiaAutoChecks[riesgo];
      for (const id in targets) {
        if (targets[id]) {
          const el = document.getElementById(id);
          if (el) {
            el.checked = true;
            autoCheckedState[id] = true;
          }
        }
      }
    }
  });

  const isValvularForced =
    riesgos.includes('V√°lvula mec√°nica') ||
    riesgos.includes('Estenosis mitral moderada-severa') ||
    riesgos.includes('¬°AVISO! Valvulopat√≠a mec√°nica/Estenosis mitral mod-severa (Requiere AVK)');

  const elCondValvular = document.getElementById('condValvular');
  if (elCondValvular) {
    if (isValvularForced) {
      elCondValvular.checked = true;
      autoCheckedState['condValvular'] = true;
    } else {
      elCondValvular.checked = false;
      delete autoCheckedState['condValvular'];
    }
  }

  autoCheckByInputs();
}

function checkAutoCheckedAlarm(controlId) {
  const el = document.getElementById(controlId);
  if (autoCheckedState[controlId] && !el.checked) {
    el.checked = true;
    showToast('‚ö†Ô∏è Esta casilla fue marcada autom√°ticamente por la Patolog√≠a Embol√≠gena y NO debe desmarcarse (coherencia cl√≠nica).', 'warn');
  }
}

document.addEventListener('DOMContentLoaded', () => {
  ['cStroke', 'hStroke', 'condValvular', 'cCongest', 'cHTN', 'cDiab', 'cVasc'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('change', () => checkAutoCheckedAlarm(id));
  });
});

function actualizarPatologia() {
  aplicarAutoChecks();
  updateEscalasVisibility();
  mostrarRecomendacionPatologia(true);
}

function mostrarFactoresPatologia() {
  const div = document.getElementById("patologia-factores");
  const resultadoDiv = document.getElementById("patologia-resultado");
  const patologia = document.getElementById("patologia").value;
  div.innerHTML = "";
  resultadoDiv.innerHTML = "";



  if (factoresPatologia[patologia]) {
    factoresPatologia[patologia].forEach(factor => {
      const label = document.createElement("label");
      label.classList.add("row");
      label.innerHTML = `<input type='checkbox' value="${factor}"> ${factor}`;
      div.appendChild(label);
    });
    document.querySelectorAll("#patologia-factores input[type='checkbox']").forEach(cb => {
      cb.addEventListener('change', actualizarPatologia);
    });
    actualizarPatologia();
  } else {
    aplicarAutoChecks();
    resultadoDiv.textContent = "Seleccione una patolog√≠a para ver los factores de riesgo espec√≠ficos.";
    updateEscalasVisibility();
  }
}

function mostrarRecomendacionPatologia(preliminar = false) {
  const patologia = document.getElementById("patologia").value;
  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => el.value);
  const resultadoDiv = document.getElementById("patologia-resultado");
  
  let texto = "", recomendacion = "", fuerza = "INSUFICIENTE";
  let score = 0;
  const isFemale = riesgos.includes('Sexo Femenino (1 pto)');
   if (patologia) {
  document.getElementById('botones-patologia').style.display = 'block';
} else {
  document.getElementById('botones-patologia').style.display = 'none';
}
  riesgos.forEach(r => {
    if (r.includes('2 ptos')) score += 2;
    else if (r.includes('1 pto')) score += 1;


});

  switch(patologia) {
    case "hipertrofica":
      texto = "<b>üìå Miocardiopat√≠a hipertr√≥fica</b> ‚Äì Riesgo emb√≥lico elevado si coexistencia de FA.";
      if (riesgos.includes("FA parox√≠stica")) {
        recomendacion = "Anticoagulaci√≥n indefinida (preferiblemente ACOD si no contraindicado), independientemente del CHA‚ÇÇDS‚ÇÇ-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion = "No se indica anticoagulaci√≥n si no hay FA.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "iam":
  texto = "<b>üìå Infarto agudo de miocardio</b> ‚Äì Mayor riesgo emb√≥lico si trombo cavitario o ictus periinfarto.";


      const tieneTromboCavitario = riesgos.includes("Trombo cavitario");
      const tieneIctusPeriinfarto = riesgos.includes("Ictus periinfarto");

      // 1Ô∏è‚É£ Ictus periinfarto ‚Üí anticoagulaci√≥n TRANSITORIA 3‚Äì6 meses
      if (tieneIctusPeriinfarto) {
        recomendacion =
          "Anticoagulaci√≥n (ACOD o AVK) durante 3‚Äì6 meses tras el ictus periinfarto, " +
          "con reevaluaci√≥n por imagen cardiaca. Si no persiste trombo ni otra fuente cardioemb√≥lica, " +
          "no se mantiene anticoagulaci√≥n indefinida.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";

      // 2Ô∏è‚É£ Trombo cavitario sin ictus periinfarto ‚Üí tambi√©n transitoria
      } else if (tieneTromboCavitario) {
        recomendacion =
          "Anticoagulaci√≥n (ACOD o AVK) 3‚Äì6 meses, con control ecocardiogr√°fico hasta la resoluci√≥n del trombo cavitario.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";

      // 3Ô∏è‚É£ IAM sin trombo ni ictus periinfarto ‚Üí no AC sistem√°tica
      } else {
        recomendacion =
          "En ausencia de ictus periinfarto o trombo cavitario, no se recomienda anticoagulaci√≥n sistem√°tica " +
          "por el solo hecho del IAM.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;


    case "dilatada":
  texto = "<b>üìå Miocardiopat√≠a dilatada</b> ‚Äì Riesgo emb√≥lico si trombo apical o FA concomitante.";

  // PRIORIDAD CORRECTA

  // 1Ô∏è‚É£ FA ‚Üí anticoagulaci√≥n indefinida
  if (riesgos.includes("FA concomitante")) {
    recomendacion = "Anticoagulaci√≥n indefinida (ACOD o AVK). ";
    fuerza = "ACODS_PREFERIDOS";

  // 2Ô∏è‚É£ Trombo apical ‚Üí anticoagulaci√≥n transitoria
  } else if (riesgos.includes("Trombo apical")) {
    recomendacion = "Anticoagulaci√≥n (ACOD o AVK) 3‚Äì6 meses, con reevaluaci√≥n por imagen hasta resoluci√≥n del trombo.";
    fuerza = "ANTICOAGULACION_TRANSITORIA";

  // 3Ô∏è‚É£ Sin FA y sin trombo
  } else {
    recomendacion = "No se indica anticoagulaci√≥n sistem√°tica sin trombo ni FA.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;


case "isquemica":
      texto = "<b>üìå Miocardiopat√≠a isqu√©mica</b> ‚Äì Riesgo emb√≥lico si hay zonas acin√©ticas, trombos murales o ictus cardioemb√≥lico " +
              "atribuible a una disfunci√≥n ventricular persistente.";

      const tieneTromboMural     = riesgos.includes("Trombo mural documentado");
      const tieneFEbaja          = riesgos.includes("FE ‚â§ 35%");
      const tieneAcinesia        = riesgos.includes("Zonas acin√©ticas o hipocin√©ticas");
      const ictusCardioPrevio    = riesgos.includes("Antecedente de ictus cardioemb√≥lico");

      // 1Ô∏è‚É£ Trombo mural ‚Üí anticoagulaci√≥n TRANSITORIA 3‚Äì6 meses
      if (tieneTromboMural) {
        recomendacion =
          "Anticoagulaci√≥n (AVK o ACOD) durante 3‚Äì6 meses, con reevaluaci√≥n por imagen hasta la resoluci√≥n del trombo mural. " +
          "Si el trombo desaparece y no hay FA ni otra fuente emb√≥lica persistente, no se mantiene anticoagulaci√≥n indefinida.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";

      // 2Ô∏è‚É£ Ictus cardioemb√≥lico + disfunci√≥n estructural (FE baja o acinesia) ‚Üí AC INDEFINIDA
      } else if (ictusCardioPrevio && (tieneFEbaja || tieneAcinesia)) {
        recomendacion =
          "Ictus cardioemb√≥lico en el contexto de miocardiopat√≠a isqu√©mica con disfunci√≥n ventricular relevante " +
          "(FE ‚â§35% y/o zonas acin√©ticas). Recomendable anticoagulaci√≥n (ACOD o AVK) indefinida como prevenci√≥n secundaria, " +
          "si no hay contraindicaciones.";
        fuerza = "ACODS_PREFERIDOS";

      // 3Ô∏è‚É£ Ictus cardioemb√≥lico pero SIN FE baja ni acinesia ‚Üí NO justifica AC indefinida
      } else if (ictusCardioPrevio && !tieneFEbaja && !tieneAcinesia) {
        recomendacion =
          "Ictus cardioemb√≥lico previo sin disfunci√≥n sist√≥lica significativa ni zonas acin√©ticas demostradas. " +
          "La miocardiopat√≠a isqu√©mica sin alteraciones estructurales relevantes no se considera fuente cardioemb√≥lica " +
          "cr√≥nica por s√≠ misma. No se recomienda anticoagulaci√≥n indefinida; debe reevaluarse la etiolog√≠a (p. ej. ESUS, FA oculta) " +
          "y seguir las gu√≠as de ictus criptog√©nico.";
        fuerza = "NO_ANTICOAGULAR";

      // 4Ô∏è‚É£ Sin trombo ni ictus cardioemb√≥lico ‚Üí no AC sistem√°tica
      } else {
        recomendacion =
          "Sin trombo mural documentado ni ictus cardioemb√≥lico atribuible a disfunci√≥n ventricular, " +
          "no se indica anticoagulaci√≥n sistem√°tica en la miocardiopat√≠a isqu√©mica. Manejo habitual con antiagregaci√≥n " +
          "y tratamiento √≥ptimo de la cardiopat√≠a.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "restrictiva":
      texto = "<b>üìå Miocardiopat√≠a restrictiva</b> ‚Äì FA y trombos auriculares frecuentes, especialmente en amiloidosis.";
      if (riesgos.includes("FA documentada") || riesgos.includes("Trombos auriculares")) {
        recomendacion = "Anticoagulaci√≥n (ACOD o AVK) indefinida independientemente del CHA‚ÇÇDS‚ÇÇ-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion = "Sin FA ni trombos, no se indica anticoagulaci√≥n sistem√°tica.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "tako":
      texto = "<b>üìå Miocardiopat√≠a de Tako-Tsubo</b> ‚Äì Riesgo emb√≥lico bajo; individualizar.";
      if (riesgos.includes("FA concomitante")) {
        recomendacion = "Anticoagulaci√≥n indefinida (ACOD o AVK) independientemente del CHA‚ÇÇDS‚ÇÇ-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (riesgos.includes("Trombo ventricular")) {
        recomendacion = "Anticoagulaci√≥n (AVK o ACOD) 3 meses o hasta resoluci√≥n del trombo.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else {
        recomendacion = "No se recomienda anticoagulaci√≥n por defecto; valorar si persiste disfunci√≥n grave.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "mixoma":
      texto = "<b>üìå Mixoma auricular</b> ‚Äì Riesgo emb√≥lico relevante; indicaci√≥n principal: cirug√≠a.";
      if (riesgos.includes("Ictus cardioemb√≥lico") || riesgos.includes("Trombo en aur√≠cula")) {
        recomendacion = "Anticoagulaci√≥n (preferiblemente AVK, pudiendo valorar ACOD) transitoria hasta la resecci√≥n quir√∫rgica.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else {
        recomendacion = "Sin ictus ni trombo visible, se prioriza la cirug√≠a; anticoagulaci√≥n no sistem√°tica.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

   case "valvular":
  texto = "<b>üìå Patolog√≠a valvular / Pr√≥tesis valvulares</b> ‚Äì Riesgo emb√≥lico variable seg√∫n tipo de v√°lvula y presencia de FA.";

  const hasFAv = riesgos.includes("FA concomitante") || riesgos.includes("FA documentada") || riesgos.includes("FA Parox√≠stica/Cr√≥nica documentada");
  const hasTEPrevio = riesgos.includes("Complicaciones tromboemb√≥licas previas");

  const isMec√°nica = riesgos.includes("V√°lvula mec√°nica");
  const isEM_MS = riesgos.includes("Estenosis mitral moderada-severa");
  const isBioMitral = riesgos.includes("Pr√≥tesis Biol√≥gica Mitral/Tric√∫spide");
  const isBioAortica = riesgos.includes("Pr√≥tesis Biol√≥gica A√≥rtica (TAVI/Quir√∫rgica)");

  // ============================================================
  // 1Ô∏è‚É£ V√ÅLVULA MEC√ÅNICA ‚Üí AVK SIEMPRE (ACOD CONTRAINDICADOS)
  // ============================================================
  if (isMec√°nica) {
    recomendacion =
      "Anticoagulaci√≥n de por vida con AVK (INR seg√∫n posici√≥n y tipo de pr√≥tesis). " +
      "Los ACOD est√°n contraindicados en v√°lvulas mec√°nicas.";
    fuerza = "VKA_OBLIGATORIO";
    break;
  }

  // ============================================================
  // 2Ô∏è‚É£ ESTENOSIS MITRAL MODERADA-SEVERA (RMS/EM-MS)
  // ============================================================
  if (isEM_MS) {
    if (hasFAv || hasTEPrevio) {
      recomendacion =
        "Anticoagulaci√≥n indefinida con AVK. " +
        "Los ACOD est√°n contraindicados en estenosis mitral moderada-severa con FA.";
      fuerza = "VKA_OBLIGATORIO";
    } else {
      recomendacion =
        "En estenosis mitral moderada-severa en ritmo sinusal, no se recomienda anticoagulaci√≥n sistem√°tica. " ;
      fuerza = "ANTIAGREGACION_PREFERIDA";
    }
    break;
  }

  // ============================================================
  // 3Ô∏è‚É£ PR√ìTESIS BIOL√ìGICA MITRAL O TRIC√öSPIDE
  // ============================================================
  if (isBioMitral) {
    if (hasFAv || hasTEPrevio) {
      recomendacion =
        "Anticoagulaci√≥n indefinida (ACOD o AVK) por presencia de FA o eventos tromboemb√≥licos previos.";
      fuerza = "ACODS_PREFERIDOS";
    } else {
      recomendacion =
        "Anticoagulaci√≥n con AVK o ACOD durante 3‚Äì6 meses tras el implante (especialmente si posici√≥n mitral). " +
        "Despu√©s, AAS en monoterapia si ritmo sinusal. " +
        "En pr√≥tesis tric√∫spide aislada, suele ser suficiente AAS desde el inicio.";
      fuerza = "";
    }
    break;
  }

  // ============================================================
  // 4Ô∏è‚É£ PR√ìTESIS BIOL√ìGICA A√ìRTICA (TAVI o quir√∫rgica)
  // ============================================================
  if (isBioAortica) {
    if (hasFAv || hasTEPrevio) {
      recomendacion =
        "Anticoagulaci√≥n indefinida (ACOD o AVK) por presencia de FA o eventos tromboemb√≥licos previos.";
      fuerza = "ACODS_PREFERIDOS";
    } else {
      recomendacion =
        "AAS en monoterapia como estrategia est√°ndar. " +
        "La DAPT solo est√° indicada si existe un stent coronario implantado < 3 meses; no por la TAVI en s√≠.";
      fuerza = "ANTIAGREGACION_PREFERIDA";
    }
    break;
  }

  // ============================================================
  // 5Ô∏è‚É£ RESTO DE CARDIOPAT√çA VALVULAR NO PRINCIPAL
  // ============================================================
  if (hasFAv) {
    recomendacion =
      "Anticoagulaci√≥n (ACOD o AVK) seg√∫n CHA‚ÇÇDS‚ÇÇ-VASc, por la presencia de FA en el contexto de valvulopat√≠a no mec√°nica.";
    fuerza = "ACODS_PREFERIDOS";
  } else {
    recomendacion =
      "Sin FA ni pr√≥tesis mec√°nica, no se recomienda anticoagulaci√≥n sistem√°tica. " +
      "Suele bastar antiagregaci√≥n (AAS) o vigilancia cl√≠nica.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;


case "endocarditis":
  texto = "<b>üìå Endocarditis infecciosa</b> ‚Äì Riesgo extremadamente alto de hemorragia intracraneal, incluso en ictus isqu√©micos.";

  const neuro = riesgos.includes("Complicaciones neurol√≥gicas");
  const micoticos = riesgos.includes("Aneurismas mic√≥ticos");

  if (neuro || micoticos) {
    recomendacion =
      "Evitar anticoagulaci√≥n. Suspender AVK/ACOD si estaban en uso salvo indicaci√≥n absolutamente imprescindible (p. ej., v√°lvula mec√°nica). " +
      "Tras un ictus isqu√©mico en el contexto de endocarditis, la anticoagulaci√≥n aumenta el riesgo de transformaci√≥n hemorr√°gica y de ruptura de aneurismas mic√≥ticos. " +
      "Reevaluaci√≥n tras 1‚Äì2 semanas y tras neuroimagen de control.";
    fuerza = "NO_ANTICOAGULAR";

  } else {
    recomendacion =
      "No se recomienda anticoagulaci√≥n durante la endocarditis activa salvo indicaci√≥n esencial (p. ej., v√°lvula mec√°nica). " +
      "Decisi√≥n a individualizar en equipo multidisciplinar.";
    fuerza = "NO_ANTICOAGULAR";
  }

  break;


case "sicksinus":
  texto = "<b>üìå S√≠ndrome del seno enfermo</b> ‚Äì La FA puede ser parox√≠stica u oculta; la estratificaci√≥n de riesgo sigue el CHA‚ÇÇDS‚ÇÇ-VASc.";
 
 // 2Ô∏è‚É£ ICTUS CARDIOEMB√ìLICO PREVIO (sin FA documentada)
  if (riesgos.includes("Antecedente de ictus/embolia sist√©mica")) {

    recomendacion =
      "Anticoagulaci√≥n indefinida (ACOD o AVK). Incluso en ausencia de FA documentada, un ictus cardioemb√≥lico en contexto de SSE es altamente sugestivo de FA oculta.";
    fuerza = "ACODS_PREFERIDOS";

  }

  // 1Ô∏è‚É£ FA DOCUMENTADA ‚Üí AC seg√∫n CHA‚ÇÇDS‚ÇÇ-VASc
  else if (riesgos.includes("FA Parox√≠stica/Cr√≥nica documentada")) {

    recomendacion =
      "Anticoagulaci√≥n si el CHA‚ÇÇDS‚ÇÇ-VASc lo indica. En el SSE la FA suele ser intermitente, por lo que debe evaluarse el riesgo emb√≥lico real mediante la escala.";
    fuerza = "ACODS_PREFERIDOS";

  }

  // 3Ô∏è‚É£ SIN FA NI ICTUS ‚Üí no AC
  else {

    recomendacion =
      "No se recomienda anticoagulaci√≥n en ausencia de FA documentada o ictus cardioemb√≥lico previo. Se aconseja monitorizaci√≥n prolongada por riesgo de FA silente.";
    fuerza = "NO_ANTICOAGULAR";

  }
  break;


case "auricula":
  texto = "<b>üìå Aur√≠cula izquierda / orejuela</b> ‚Äì El riesgo emb√≥lico depende de la presencia de trombo, valvulopat√≠a mitral, FA y del remodelado auricular.";

  const tieneTrombo = riesgos.includes("Trombo en aur√≠cula izquierda / orejuela");
  const estenosisMitral = riesgos.includes("Estenosis mitral moderada-severa");
  const tieneFA = riesgos.includes("FA concomitante");
  const dilatacionSevera = riesgos.includes("Dilataci√≥n auricular severa");
  const feviBaja = riesgos.includes("FEVI < 35%");
  const ictusPrevio = riesgos.includes("Ictus cardioemb√≥lico previo");

  // 1Ô∏è‚É£ ESTENOSIS MITRAL ‚Üí AVK siempre
  if (estenosisMitral) {
    recomendacion =
      "Anticoagulaci√≥n obligatoria con AVK (ACOD contraindicados). Si existe trombo, mantener AVK y realizar control por imagen hasta su resoluci√≥n.";
    fuerza = "VKA_OBLIGATORIO";
  }

  // 2Ô∏è‚É£ FA CONCOMITANTE ‚Üí INDICACI√ìN ABSOLUTA
  else if (tieneFA) {
    recomendacion =
      "Anticoagulaci√≥n indefinida (ACOD o AVK). La FA implica estasis auricular y riesgo cardioemb√≥lico incluso sin trombo visible.";
    fuerza = "ACODS_PREFERIDOS";
  }

  // 3Ô∏è‚É£ TROMBO DOCUMENTADO (sin EM y sin FA)
  else if (tieneTrombo) {
    recomendacion =
      "Anticoagulaci√≥n 3‚Äì6 meses (ACOD o AVK) con control por imagen hasta resoluci√≥n. Tras la resoluci√≥n, individualizar si mantener antiagregaci√≥n o suspender.";
    fuerza = "ANTICOAGULACION_TRANSITORIA";
  }

  // 4Ô∏è‚É£ Aur√≠cula muy enferma sin trombo
  else if (dilatacionSevera && feviBaja) {
    recomendacion =
      "Considerar anticoagulaci√≥n (ACOD o AVK) por alto riesgo emb√≥lico asociado a dilataci√≥n severa y FEVI <35%, especialmente si sospecha de FA subcl√≠nica.";
    fuerza = "CONSIDERAR_ACOD";
  }

  // 5Ô∏è‚É£ Ictus previo emb√≥lico atribuible a aur√≠cula
  else if (ictusPrevio) {
  recomendacion =
    "Ictus cardioemb√≥lico previo. Sin FA, trombo o estenosis mitral moderada‚Äìsevera, no se indica anticoagulaci√≥n indefinida. Reevaluar etiolog√≠a y monitorizar FA oculta.";
  fuerza = "NO_ANTICOAGULAR";
}


  // 6Ô∏è‚É£ Caso basal (sin nada relevante)
  else {
    recomendacion =
      "Sin trombo, sin FA y sin valvulopat√≠a mitral significativa, no se recomienda anticoagulaci√≥n sistem√°tica.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;




    default:
      texto = "Seleccione una patolog√≠a.";
      recomendacion = "A la espera de selecci√≥n y factores de riesgo.";
      fuerza = "INSUFICIENTE";
  }
// === COLETILLA SEG√öN FUERZA ===
let coletilla = "";

switch (fuerza) {
  case "ACODS_PREFERIDOS":
    coletilla = " ACOD preferidos por mejor perfil eficacia/seguridad.";
    break;
  case "ANTICOAGULACION_TRANSITORIA":
    coletilla = " Anticoagulaci√≥n temporal con reevaluaci√≥n por imagen.";
    break;
  case "VKA_OBLIGATORIO":
    coletilla = " ACOD contraindicados: solo AVK.";
    break;
  case "NO_ANTICOAGULAR":
    coletilla = " No se recomienda anticoagulaci√≥n.";
    break;
  case "ANTIAGREGACION_PREFERIDA":
    coletilla = " Antiagregaci√≥n seg√∫n perfil cl√≠nico.";
    break;
}



// A√±adir coletilla al texto de recomendaci√≥n
recomendacion += coletilla;

  const resumen = riesgos.length > 0 ? riesgos.join(", ") : "Ninguno";
  resultadoDiv.innerHTML = `${texto}<br><b>üìé Factores de riesgo presentes:</b> ${resumen}.<br><b>‚úÖ Recomendaci√≥n orientativa:</b> ${recomendacion}`;

/* ============================
   RECOMENDACI√ìN PRINCIPAL
=============================== */
resultadoDiv.classList.remove("fade-in");
void resultadoDiv.offsetWidth; // Forzar repaint
resultadoDiv.classList.add("fade-in");


  const patTxt = patologia === "" ? "No seleccionada" : texto.replace(/<\/?b>/g, '');
  document.getElementById('patologia-rec-final').innerHTML =
    `<b>Patolog√≠a:</b> ${patTxt}<br><b>Recomendaci√≥n:</b> ${recomendacion}`;

  return {fuerza, recomendacion};
}



/* ============================
   MOSTRAR FACTORES
=============================== */
function mostrarFactoresPatologia() {
  const div = document.getElementById("patologia-factores");
  const res = document.getElementById("patologia-resultado");
  const p = document.getElementById("patologia").value;

  div.innerHTML = "";
  res.innerHTML = "";

  if (!p) return;

  factoresPatologia[p].forEach(f => {
    const l = document.createElement("label");
    l.classList.add("row");
    l.innerHTML = `<input type="checkbox" value="${f}"> ${f}`;
    div.appendChild(l);
  });

  document.querySelectorAll("#patologia-factores input")
    .forEach(cb => cb.addEventListener("change", () => mostrarRecomendacionPatologia()));

  mostrarRecomendacionPatologia();
}




function borrarFormulario() {
document.getElementById("patologia").value = "";
document.getElementById("patologia-factores").innerHTML = "";
document.getElementById("patologia-resultado").innerHTML = "<h3>‚úÖ Recomendaci√≥n</h3><p>Seleccione un escenario cl√≠nico para mostrar la recomendaci√≥n orientativa de tratamiento.</p>";
document.getElementById("botones-patologia").style.display = "none";
}


function copiarResumen() {
const texto = document.getElementById("patologia-resultado").innerText;
navigator.clipboard.writeText(texto).then(() => {
showToast("‚úÖ Recomendaci√≥n copiada al portapapeles.", "info");
});
}

function toggleBiblio(){
  const contenido = document.getElementById("biblio-contenido");
  const arrow = document.getElementById("biblio-arrow");

  if(contenido.classList.contains("open")){
    contenido.classList.remove("open");
    contenido.style.maxHeight = "0px";
    arrow.style.transform = "rotate(0deg)";
  } else {
    contenido.classList.add("open");
    contenido.style.maxHeight = contenido.scrollHeight + "px";
    arrow.style.transform = "rotate(180deg)";
  }
}
 
document.querySelectorAll('.biblio-toggle').forEach(btn => {
  btn.addEventListener('click', () => {
    const content = btn.nextElementSibling;
    content.style.display = (content.style.display === "none") ? "block" : "none";
  });
});

</script>


</main>

<footer>
  <img src="../img/uibanner.png" alt="Ictus GPS">
</footer>

</body>
</html>
