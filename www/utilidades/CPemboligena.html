<!DOCTYPE html>
<html lang="es">
  <head>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Otras cardiopat√≠as embol√≠genas</title>
    <meta name="theme-color" content="#0f3d83">
    <link rel="icon" type="image/png" sizes="192x192"
      href="../iconos/ictusgps.png">
    <link rel="apple-touch-icon" sizes="180x180"
      href="../iconos/ictusgps.png">
    <style>
/* VARIABLES B√ÅSICAS */
:root{
  --bg:#f8fafc; 
  --ink:#0e1a33;
  --azul:#0f3d83;
  --border:#e5e9f2;
  --muted:#64748b;
  --azul-light:#e4edfa;
  --azul-mid:#2563eb;
  --azul-dark:#0d2d63;
}

/* TIPOGRAF√çA */
html, body { font-family: Verdana, Geneva, sans-serif; }
*{box-sizing:border-box}

/* SAFE-TOP */
body{
  margin:0;
  padding-top:calc(env(safe-area-inset-top, 0px) + 52px);
  background:var(--bg);
  color:var(--ink);
}

.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top) + 60px);
  background: var(--azul);
  z-index: 1001;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: env(safe-area-inset-top);
}

.safe-content{
  width:100%;
  max-width:1080px;
  padding: 6px 16px 8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.safe-left{
  display:flex; align-items:center; gap:10px;
}
.safe-mini{width:44px;height:44px;object-fit:contain;padding:4px;}
.safe-logo{height:44px;width:auto;}

.safe-actions{display:flex; gap:10px;}
.safe-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:40px;height:40px;
  background:rgba(255,255,255,0.15);
  border:1px solid white;
  border-radius:50%;
}
.safe-btn:hover{background:#01c5fe;}
.safe-icon{width:32px;height:32px;}

/* CABECERA */
header{
  position:sticky;
  top:calc(env(safe-area-inset-top) + 52px);
  z-index:1002;
  background:var(--azul);
  color:#fff;
  height:52px;
  display:flex;
  justify-content:center;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,.08);
}

.title{display:flex;align-items:center;font-size:1.3rem;font-weight:700;}
.title img{width:32px;height:32px;margin-right:8px;}

/* CONTENIDO */
.wrap{max-width:1080px;margin:0 auto;padding:1rem;}
.howto{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 2px 2px var(--muted);
  padding:1rem;
  margin:.3rem 0 1rem;
  font-size:14px;
}
.panel{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 3px 14px rgba(16,71,119,.12);
  border:1px solid var(--border);
}

.block{
  background: linear-gradient(to bottom, #f2f7ff, #e9f1ff);
  border-left:4px solid #2563eb;
  border-radius:14px;
  padding:16px;
  margin:18px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}


/* Botones copiar / borrar */
.actions{
  margin-left:auto;
}

.actions{
  display:none;
  gap:10px;
  margin:0px;
}
.boton-opcion{
  flex:1 1 20%;
  border:none;
  border-radius:10px;
  padding:12px;
  font-size:15px;
  font-weight:700;
  cursor:pointer
}

.boton-clear{
  background:#fff;
  color:#0f3d83;
  border:1px solid #2563eb
}

.boton-clear:hover{
  background:#0f3d83;
  color:#fff;
}

.boton-copy{
  background:#fff;
  color:#0f3d83;
  border:1px solid #2563eb
}

.boton-copy:hover{
  background:#0f3d83;
  color:#fff;
}
.boton-copy.copiado {
  background: #0f3d83 !important;
  color: #fff !important;
  border-color: #0f3d83 !important;
}

select{
  padding:12px;
  border-radius:10px;
  border:1px solid #d4e2ff;
  background:#ffffff;
  font-size:1rem;
  width:100%;
  box-shadow:0 2px 6px rgba(0,0,0,0.03);
}
select:focus{
  outline:none;
  border:1px solid #0f3d83;
  box-shadow:0 0 0 1px rgba(15,61,131,0.2);
}


.block h3{
  margin:0 0 10px;
  font-size:1.1rem;
  font-weight:800;
  display:flex;
  gap:6px;
}
.icon-h3{
  width:20px;
  height:20px;
  margin-right:6px;
}

/* FACTORES */
label.row{
  display:flex;
  gap:8px;
  margin:6px 0;
  font-size:.93rem;
  align-items:flex-start;
}
label.row input{transform:scale(1.1);margin-top:3px;accent-color:#0f3d83;}
label.row:hover{
  background:#f1f6ff;
  border-radius:8px;
}


#patologia-resultado{
  background: #F7FFF7;
  border-left:4px solid green;
  border-radius:14px;
  padding:16px;
  margin:8px 0;
  box-shadow:0 2px 8px rgba(15,61,131,0.08);
}
#patologia-resultado b{
  color:#0f3d83;
}

.note{
  color:var(--muted);
  font-size:.85rem;
  margin-top:8px;
}

/* =======================
   TOAST INSTITUCIONAL
======================= */
.toast {
  position: fixed;
  top: calc(env(safe-area-inset-top, 0px) + 100px);
  right: 16px;
  min-width: 220px;
  max-width: 420px;
  padding: 12px 16px;
  border-radius: 12px;
  color: #0f3d83;
  font-size: 0.95rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;

  opacity: 0;
  transform: translateX(40px);
  pointer-events: none;

  box-shadow: 0 4px 16px rgba(0,0,0,0.16);
  transition: opacity 0.3s ease, transform 0.35s ease;

  z-index: 2000;
}

.toast.show {
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}

.toast-icon {
  font-size: 1.25rem;
}

/* DISCLAIMER FINAL */
.disclaimer-red{
  background:#fef2f2;
  border:1px solid #fecaca;
  border-radius:12px;
  margin:8px auto;
  padding:1rem;
  max-width:1080px;
  box-shadow:0 2px 8px rgba(185,28,28,0.05);
}
.disclaimer-red{
  background:#fff7f7;
  border-left:4px solid #d9534f;
  box-shadow:0 1px 4px rgba(217,83,79,0.05);
}
.disclaimer-red p{
  color:#7d1a1a;
}

.arrow{
  font-size:1.1rem;
  transition:transform 0.25s ease;
  color:#0f3d83;
}

.biblio-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  padding:4px 0;
}

.biblio-content {
  max-height: 0;
  overflow-y: auto;
  margin-top: 10px;
  padding: 0px;
  font-size:0.65rem;
  transition:max-height 0.35s ease, padding 0.3s ease;
}

.biblio-content.open{
  max-height:300;
  padding-top:10px;
}

/* Pie */
footer{
  width:100%;
  margin:2rem 0 0;
  padding:1.5rem 0;
  border-top:1px solid #e5e7eb;
  background:#ffffff;
  text-align:center;
  box-shadow:0 -2px 6px rgba(0,0,0,0.04);
}
footer img{max-width:320px;height:auto;opacity:.95}


/* =========================================================
   MEDIA QUERIES / BODY PADDING
========================================================= */
@media(max-width:768px){
  header{font-size:1.05rem;}
  body{font-size:0.96rem;}
}

/* Empuja el contenido real por debajo de la barra superior */
body{
  padding-top:calc(env(safe-area-inset-top, 0px) + 52px);
  background-color:#f8fafc;
}

/* Animaci√≥n para actualizaci√≥n suave */
.fade-in{
  animation: fadeIn 0.25s ease-out;
}

@keyframes fadeIn{
  from{
    opacity:0;
    transform:translateY(4px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}

</style>
  </head>
  <body>
    <!-- SAFE TOP -->
    <div class="safe-top">
      <div class="safe-content">
        <div class="safe-left"> <img src="../iconos/utilidadesico.png"
            class="safe-mini"> <img src="../img/topbar.png"
            class="safe-logo"> </div>
        <div class="safe-actions"> <a href="javascript:history.back()"
            class="safe-btn"> <img
              src="../iconos/atrastransparente.png" class="safe-icon"> </a>
          <a href="../index.html" class="safe-btn"> <img
              src="../iconos/hometransparente.png" class="safe-icon"> </a>
        </div>
      </div>
    </div>
    <header>
      <div class="title"> <img src="../iconos/cardiopatiasico.png">
        Otras cardiopat√≠as embol√≠genas </div>
    </header>
    <main class="wrap">
      <div class="howto" align="justify">Las <b>cardiopat√≠as
          embol√≠genas</b> cuya etiolog√≠a <b>primaria</b> es distinta de
        la fibrilaci√≥n auricular o del foramen oval permeable presentan
        mecanismos <b>propios</b> de generaci√≥n de embolias, aunque
        algunas de ellas puedan <b>coexistir o evolucionar</b> hacia
        fibrilaci√≥n auricular. Esta herramienta permite identificar los
        factores de riesgo emb√≥lico espec√≠ficos de cada entidad y
        orientar la estrategia antitromb√≥tica m√°s adecuada seg√∫n la
        evidencia disponible.</div>
      <!-- √öNICO BLOQUE -->
      <div class="block" id="patologia-section">
        <h3>ü©∫ Patolog√≠a card√≠aca embol√≠gena</h3>
        <label><b>Seleccione la entidad principal:</b></label>
        <select id="patologia" onchange="mostrarFactoresPatologia()">
          <option value="" disabled="disabled" selected="selected">Seleccione
            una patolog√≠a‚Ä¶</option>
          <option value="hipertrofica">Miocardiopat√≠a hipertr√≥fica</option>
          <option value="iam">Infarto agudo de miocardio</option>
          <option value="dilatada">Miocardiopat√≠a dilatada</option>
          <option value="isquemica">Miocardiopat√≠a isqu√©mica</option>
          <option value="restrictiva">Miocardiopat√≠a restrictiva</option>
          <option value="tako">Miocardiopat√≠a de Tako-Tsubo</option>
          <option value="mixoma">Mixoma auricular</option>
          <option value="valvular">Pr√≥tesis valvulares / Cardiopat√≠a
            valvular</option>
          <option value="endocarditis">Endocarditis infecciosa</option>
          <option value="sicksinus">S√≠ndrome del seno enfermo</option>
          <option value="auricula">Aur√≠cula izquierda / orejuela</option>
        </select>
        <div id="patologia-factores" style="margin-top:12px;"></div>
      </div>
      <div id="patologia-resultado">
        <h3>‚úÖ Recomendaci√≥n</h3>
        <p id="patologia-texto">Seleccione un escenario cl√≠nico para
          mostrar la recomendaci√≥n orientativa de tratamiento.</p>
      </div>
      <div id="botones-patologia" style="display:none; margin-top: 2px;
        text-align:center;"></div>
      <!-- BOTONES DE ACCION -->
      <div class="actions"> <button onclick="borrarFormulario()"
          class="boton-opcion boton-clear">Borrar</button> <button
          onclick="copiarResumen()" class="boton-opcion boton-copy">Copiar
          recomendaci√≥n</button> </div>
      <!-- DISCLAIMER -->
      <section class="disclaimer-red">
        <p align="justify"> <b>üìõAdvertencia.</b> Esta herramienta
          tiene car√°cter orientativo y no sustituye el juicio cl√≠nico
          del profesional ni los protocolos locales. Las recomendaciones
          deben integrarse con la situaci√≥n individual del paciente, las
          gu√≠as vigentes y la discusi√≥n multidisciplinar cuando proceda.
        </p>
      </section>
      <div class="howto">
        <details style="margin-top:1px;">
          <summary style="cursor:pointer;font-weight:700;color:#0f3d83;">üìö
            Bibliograf√≠a</summary>
          <div style=" margin-top:14px; background:#ffffff; border:1px
            solid #d0d7e1; border-radius:10px; box-shadow:0 2px 6px
            rgba(0,0,0,0.05); overflow:hidden; font-size:13px;
            line-height:1.55; color:#1e293b; ">
            <!-- Barra superior tipo guideline -->
            <div style=" background:#0f3d83; color:#ffffff; padding:10px
              14px; font-size:14px; font-weight:700;
              letter-spacing:0.3px; "> üìò Referencias bibliogr√°ficas </div>
            <!-- Contenido -->
            <div style="padding:16px 18px;">
              <ol style="margin:8px; padding-left:20px; font-size:10px;
                line-height:1.45;">
                <!-- GENERAL DE CARDIOEMBOLISMO -->
                <li>Arboix A, Ali√≥ J. Cardioembolic stroke: clinical
                  features, cardiac disorders and prognosis. <i>Cerebrovasc
                    Dis</i>. 2010;29:321‚Äì330.</li>
                <li>Sacchetti D, Furie KL, Yaghi S. Cardioembolic
                  Stroke: Mechanisms &amp; Therapeutics. <i>Semin
                    Neurol</i>. 2017;37:370‚Äì387.</li>
                <li>Yaghi S, Bernstein RA, Passman R, Okin PM.
                  Cryptogenic stroke: targeted workup for occult cardiac
                  disease. <i>Stroke</i>. 2024.</li>
                <li>Peci√±a JL et al. Cardiac imaging for embolic stroke
                  of undetermined source. <i>JACC</i>.
                  2021;77(8):1024‚Äì1038.</li>
                <!-- MIOCARDIOPAT√çA HIPERTR√ìFICA -->
                <li>Guttmann OP et al. Atrial fibrillation and
                  thromboembolism in hypertrophic cardiomyopathy. <i>Heart</i>.
                  2014;100:465‚Äì472.</li>
                <li>O'Mahony C et al. Atrial Fibrillation in HCM:
                  disease mechanisms and outcomes. <i>JACC</i>. 2019.</li>
                <!-- INFARTO AGUDO DE MIOCARDIO / TROMBO VENTRICULAR -->
                <li>McCarthy CP et al. Left ventricular thrombus after
                  acute MI. <i>JAMA Cardiol</i>. 2019;4:642‚Äì651.</li>
                <li>Attenhofer Jost CH et al. Imaging of LV thrombus:
                  echo, CT and MRI. <i>JACC Img</i>. 2020.</li>
                <li>Delewi R, et al. LV thrombus prevention &amp;
                  management after MI. <i>EHJ</i>. 2012;33:917‚Äì923.</li>
                <!-- MIOCARDIOPAT√çA DILATADA -->
                <li>de Gregorio C. Ventricular thrombus in DCM:
                  incidence &amp; management. <i>Cardiology</i>. 2020.</li>
                <li>Hsu JC et al. Thromboembolism risk in dilated
                  cardiomyopathy. <i>Heart Rhythm</i>. 2016.</li>
                <!-- MIOCARDIOPAT√çA ISQU√âMICA -->
                <li>Solomon SD et al. Ventricular remodeling after MI
                  and embolic risk. <i>NEJM</i>. 2010.</li>
                <li>Weinsaft JW et al. LV thrombus: MRI vs echo
                  accuracy. <i>JACC Img</i>. 2009.</li>
                <li>Yaghi S, Kamel H. Ischemic cardiomyopathy &amp;
                  embolic stroke. <i>Stroke</i>. 2017.</li>
                <!-- MIOCARDIOPAT√çA RESTRICTIVA -->
                <li>Damy T, et al. Thromboembolic complications in
                  amyloidosis. <i>EHJ</i>. 2021.</li>
                <li>Dubrey S, Hawkins PN. Amyloid heart disease review.
                  <i>BMJ</i>. 2020.</li>
                <!-- TAKO-TSUBO -->
                <li>Templin C et al. Takotsubo cardiomyopathy registry.
                  <i>NEJM</i>. 2015.</li>
                <li>Stiermaier T et al. LV thrombus in Tako-Tsubo:
                  incidence &amp; outcomes. <i>JACC</i>. 2016.</li>
                <!-- MIXOMA AURICULAR / TUMORES CARD√çACOS -->
                <li>Reynen K. Cardiac myxomas. <i>NEJM</i>.
                  1995;333:1610‚Äì1617.</li>
                <li>Gowda RM et al. Embolic stroke from cardiac tumors.
                  <i>Int J Cardiol</i>. 2003.</li>
                <!-- ENDOCARDITIS INFECCIOSA -->
                <li>Baddour LM et al. AHA Infective Endocarditis
                  Guidelines. <i>Circulation</i>. 2015.</li>
                <li>Habib G et al. ESC Guidelines for Infective
                  Endocarditis. <i>Eur Heart J</i>. 2015.</li>
                <li>Murdoch DR, et al. Neurological complications in
                  endocarditis. <i>Lancet Neurol</i>. 2009.</li>
                <!-- VALVULOPAT√çAS / PR√ìTESIS -->
                <li>Baumgartner H et al. 2021 ESC/EACTS Guidelines for
                  valvular heart disease.</li>
                <li>Nishimura RA et al. 2020 ACC/AHA Guidelines for
                  valve disease.</li>
                <li>Kernan WN et al. Stroke prevention in valvular
                  disease. <i>Stroke</i>. 2014.</li>
                <li>Pibarot P, et al. TAVI: antithrombotic strategies. <i>JACC</i>.
                  2020.</li>
                <!-- S√çNDROME DEL SENO ENFERMO / FA OCULTA -->
                <li>Sanna T et al. CRYSTAL-AF: detection of occult AF
                  after stroke. <i>NEJM</i>. 2014.</li>
                <li>Steinberg JS et al. LOOP Study: AF screening and
                  stroke risk. <i>Lancet</i>. 2021.</li>
                <!-- AUR√çCULA IZQUIERDA / OREJUELA -->
                <li>Di Biase L et al. LA/LAA morphology &amp; stroke
                  risk. <i>Heart Rhythm</i>. 2012.</li>
                <li>Fatkin D et al. LA enlargement as predictor of
                  stroke. <i>EHJ</i>. 1994.</li>
                <li>Glikson M et al. EHRA consensus on LAA occlusion.
                  2020.</li>
                <!-- MASAS Y TROMBOS CARD√çACOS (GENERAL) -->
                <li>Goyal P et al. Cardiac masses &amp; thrombi:
                  multimodality imaging. <i>JACC Img</i>. 2020.</li>
                <li>Weinsaft JW et al. MRI vs echo for thrombus
                  detection. <i>Circulation</i>. 2008.</li>
                <!-- PREVENCI√ìN / ESTRATEGIA ANTITROMB√ìTICA -->
                <li>Kernan WN et al. AHA/ASA Stroke Prevention
                  Guidelines. <i>Stroke</i>. 2021.</li>
                <li>Hindricks G et al. 2020 ESC Guidelines for Atrial
                  Fibrillation (fundamentales para ACOD/AVK).</li>
                <!-- SISTEM√ÅTICAS / REVISI√ìN GLOBAL -->
                <li>Giacalone G et al. Prevention strategies for
                  cardioembolic stroke. <i>Open Neurol J</i>. 2010.</li>
                <li>Bhat R et al. Embolic strokes of undetermined
                  source: diagnosis &amp; management. <i>Stroke</i>.
                  2021.</li>
                <li>Yoshihara S et al. Cardiac causes of embolic stroke.
                  <i>World J Radiol</i>. 2023.</li>
              </ol>
            </div>
          </div>
        </details>
      </div>
      <div id="toast" class="toast"></div>
    </main>
    <footer> <img src="../img/uibanner.png" alt="Ictus GPS">
    </footer>
    <script>
/* ============================
   FACTORES POR PATOLOG√çA
=============================== */
const factoresPatologia = {
  hipertrofica: [
    'FA parox√≠stica',
    'Ictus isqu√©mico agudo'
  ],
  iam: [
    'IAM anterior extenso',
    'FE < 40%',
    'Trombo cavitario',
    'Ictus isqu√©mico agudo'
  ],
  dilatada: [
    'FE ‚â§ 28%',
    'Trombo apical',
    'FA concomitante',
    'Ictus isqu√©mico agudo'
  ],
  isquemica: [
    'Zonas acin√©ticas o hipocin√©ticas',
    'Trombo mural documentado',
    'FE ‚â§ 35%',
    'Ictus isqu√©mico agudo'
  ],
  restrictiva: [
    'FA documentada',
    'Trombos auriculares',
    'Amiloidosis confirmada',
    'Ictus isqu√©mico agudo'
  ],
  tako: [
    'FA concomitante',
    'Trombo ventricular',
    'FE < 40%',
    'Ictus isqu√©mico agudo'
  ],
  mixoma: [
  'Trombo en aur√≠cula',
  'FA concomitante',
  'Retraso quir√∫rgico',
  'Ictus isqu√©mico agudo'
],
  valvular: [
    'V√°lvula mec√°nica',
    'Pr√≥tesis Biol√≥gica A√≥rtica (TAVI/Quir√∫rgica)',
    'Pr√≥tesis Biol√≥gica Mitral/Tric√∫spide',
    'Estenosis mitral moderada-severa',
    'FA concomitante',
    'Trombo valvular',
    'Complicaciones tromboemb√≥licas previas',
    'Ictus isqu√©mico agudo'
  ],
  endocarditis: [
    'Complicaciones neurol√≥gicas',
    'Aneurismas mic√≥ticos',
    'Ictus isqu√©mico agudo'
  ],
  sicksinus: [
    'FA Parox√≠stica/Cr√≥nica documentada',
    'Antecedente de ictus/embolia sist√©mica',
    'Ictus isqu√©mico agudo'
  ],
  auricula: [
    'Trombo en aur√≠cula izquierda / orejuela',
    'Estenosis mitral moderada-severa',
    'FA concomitante',
    'Dilataci√≥n auricular severa',
    'FEVI < 35%',
    'Evento cardioemb√≥lico previo',
    'Ictus isqu√©mico agudo'
  ]
};

const patologiaAutoChecks = {
  'Insuficiencia Card√≠aca (1 pto)': {cCongest: true},
  'Hipertensi√≥n (1 pto)': {cHTN: true},
  'Diabetes (1 pto)': {cDiab: true},
  'Ictus/AIT/TE previo (2 ptos)': {cStroke: true, hStroke: true},
  'Enfermedad Vascular (1 pto)': {cVasc: true},
  'FA parox√≠stica': {cCongest: true}, 
  'FA concomitante': {cCongest: true}, 
  'FA documentada': {cCongest: true}, 
  'FA Parox√≠stica/Cr√≥nica documentada': {cCongest: true}, 
  'Ictus periinfarto': {cStroke: true, hStroke: true},
  'Antecedente de ictus cardioemb√≥lico': {cStroke: true, hStroke: true},
  'Complicaciones tromboemb√≥licas previas': {cStroke: true, hStroke: true},
};

let autoCheckedState = {};

/* Mostrar/ocultar bloque de escalas seg√∫n presencia de FA en los factores seleccionados */
function updateEscalasVisibility() {
  const escalasBlock = document.getElementById('escalas-block');
  if (!escalasBlock) return;

  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => (el.value || '').toUpperCase());

  const hasFA = riesgos.some(txt =>
    txt.includes('FA ') || txt.startsWith('FA')
  );

  escalasBlock.style.display = hasFA ? '' : 'none';
}

function aplicarAutoChecks() {
  Object.keys(autoCheckedState).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.checked = false;
  });
  autoCheckedState = {};

  const patologia = document.getElementById("patologia").value;
  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => el.value);

  riesgos.forEach(riesgo => {
    if (patologiaAutoChecks[riesgo]) {
      const targets = patologiaAutoChecks[riesgo];
      for (const id in targets) {
        if (targets[id]) {
          const el = document.getElementById(id);
          if (el) {
            el.checked = true;
            autoCheckedState[id] = true;
          }
        }
      }
    }
  });

  const isValvularForced =
    riesgos.includes('V√°lvula mec√°nica') ||
    riesgos.includes('Estenosis mitral moderada-severa') ||
    riesgos.includes('¬°AVISO! Valvulopat√≠a mec√°nica/Estenosis mitral mod-severa (Requiere AVK)');

  const elCondValvular = document.getElementById('condValvular');
  if (elCondValvular) {
    if (isValvularForced) {
      elCondValvular.checked = true;
      autoCheckedState['condValvular'] = true;
    } else {
      elCondValvular.checked = false;
      delete autoCheckedState['condValvular'];
    }
  }

  autoCheckByInputs();
}

function autoCheckByInputs(){
  // Funci√≥n placeholder por si est√° definida en otras p√°ginas/JS compartido
}

function checkAutoCheckedAlarm(controlId) {
  const el = document.getElementById(controlId);
  if (autoCheckedState[controlId] && el && !el.checked) {
    el.checked = true;
    showToast('Esta casilla fue marcada autom√°ticamente por la Patolog√≠a Embol√≠gena y NO debe desmarcarse (coherencia cl√≠nica).', 'warn');
  }
}

document.addEventListener('DOMContentLoaded', () => {
  ['cStroke', 'hStroke', 'condValvular', 'cCongest', 'cHTN', 'cDiab', 'cVasc'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('change', () => checkAutoCheckedAlarm(id));
  });
});

/* ============================
   MOSTRAR FACTORES
=============================== */
function mostrarFactoresPatologia() {
  const div = document.getElementById("patologia-factores");
  const res = document.getElementById("patologia-resultado");
  const p = document.getElementById("patologia").value;

  div.innerHTML = "";
  res.innerHTML = "";

  if (!p || !factoresPatologia[p]) {
    res.innerHTML = "<h3>‚úÖ Recomendaci√≥n</h3><p>Seleccione una patolog√≠a para ver los factores de riesgo espec√≠ficos.</p>";
    document.querySelector('.actions').style.display = "none";
    return;
  }

  factoresPatologia[p].forEach(f => {
    const l = document.createElement("label");
    l.classList.add("row");
    l.innerHTML = `<input type="checkbox" value="${f}"> ${f}`;
    div.appendChild(l);
  });

  document.querySelectorAll("#patologia-factores input[type='checkbox']")
    .forEach(cb => cb.addEventListener("change", actualizarPatologia));

  aplicarAutoChecks();
  updateEscalasVisibility();
  actualizarPatologia();
}

function actualizarPatologia() {
  aplicarAutoChecks();
  updateEscalasVisibility();
  mostrarRecomendacionPatologia(true);
}

/* ============================
   RECOMENDACI√ìN PRINCIPAL
=============================== */
function mostrarRecomendacionPatologia(preliminar = false) {
  const patologia = document.getElementById("patologia").value;
  const checks = document.querySelectorAll("#patologia-factores input[type='checkbox']:checked");
  const riesgos = Array.from(checks).map(el => el.value);
  const resultadoDiv = document.getElementById("patologia-resultado");
  const actions = document.querySelector('.actions');

  let texto = "", recomendacion = "", fuerza = "INSUFICIENTE";
  let score = 0;
  const isFemale = riesgos.includes('Sexo Femenino (1 pto)');
  const hasIctus = riesgos.includes('Ictus isqu√©mico agudo');

  if (patologia) {
    actions.style.display = "flex";
  } else {
    actions.style.display = "none";
  }

  riesgos.forEach(r => {
    if (r.includes('2 ptos')) score += 2;
    else if (r.includes('1 pto')) score += 1;
  });

  switch(patologia) {
    case "hipertrofica":
      texto = "<b>üìå Miocardiopat√≠a hipertr√≥fica</b> ‚Äì Riesgo emb√≥lico elevado si coexistencia de FA.";
      if (riesgos.includes("FA parox√≠stica")) {
        recomendacion = "Anticoagulaci√≥n indefinida (preferiblemente ACOD si no contraindicado), independientemente del CHA‚ÇÇDS‚ÇÇ-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (hasIctus) {
        recomendacion = "Ictus isqu√©mico agudo en paciente con miocardiopat√≠a hipertr√≥fica sin FA documentada: no se indica anticoagulaci√≥n por la cardiopat√≠a. Manejo como ictus criptog√©nico/ESUS y b√∫squeda de FA oculta.";
        fuerza = "NO_ANTICOAGULAR";
      } else {
        recomendacion = "Sin FA documentada, no se indica anticoagulaci√≥n sistem√°tica.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "iam":
      texto = "<b>üìå Infarto agudo de miocardio</b> ‚Äì Mayor riesgo emb√≥lico si trombo cavitario o ictus periinfarto.";
      const tieneTromboCavitario = riesgos.includes("Trombo cavitario");
      const tieneIctusPeriinfarto = riesgos.includes("Ictus periinfarto");
      const feBajaIAM = riesgos.includes("FE < 40%");

      if (tieneIctusPeriinfarto || hasIctus) {
        recomendacion =
          "Ictus isqu√©mico en el contexto de IAM: se recomienda anticoagulaci√≥n (ACOD o AVK) durante 3‚Äì6 meses, con reevaluaci√≥n por imagen card√≠aca. " +
          "Si no persiste trombo ni otra fuente cardioemb√≥lica, no se mantiene anticoagulaci√≥n indefinida.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else if (tieneTromboCavitario) {
        recomendacion =
          "Trombo cavitario tras IAM: anticoagulaci√≥n (ACOD o AVK) 3‚Äì6 meses, con control ecocardiogr√°fico hasta la resoluci√≥n del trombo.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else {
        recomendacion =
          "En ausencia de ictus isqu√©mico agudo, ictus periinfarto o trombo cavitario, no se recomienda anticoagulaci√≥n sistem√°tica solo por el IAM.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "dilatada":
      texto = "<b>üìå Miocardiopat√≠a dilatada</b> ‚Äì Riesgo emb√≥lico si trombo apical, FE muy deprimida o FA concomitante.";

      const tieneFADilatada = riesgos.includes("FA concomitante");
      const tieneTromboApical = riesgos.includes("Trombo apical");
      const feMuyBaja = riesgos.includes("FE ‚â§ 28%");

      if (tieneFADilatada) {
        recomendacion = "Anticoagulaci√≥n indefinida (ACOD o AVK), independientemente del CHA‚ÇÇDS‚ÇÇ-VASc, por presencia de FA en el contexto de miocardiopat√≠a dilatada.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (tieneTromboApical) {
        recomendacion = "Trombo apical en miocardiopat√≠a dilatada: anticoagulaci√≥n (ACOD o AVK) 3‚Äì6 meses, con reevaluaci√≥n por imagen hasta la resoluci√≥n del trombo.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else if (hasIctus && feMuyBaja) {
        recomendacion =
          "Ictus isqu√©mico agudo en miocardiopat√≠a dilatada con FE muy deprimida (‚â§ 28%): considerar anticoagulaci√≥n temporal (3‚Äì6 meses), individualizando seg√∫n riesgo hemorr√°gico. " +
          "El mecanismo puede ser cardioemb√≥lico por estasis ventricular severa.";
        fuerza = "CONSIDERAR_ACOD";
      } else if (hasIctus && !feMuyBaja) {
        recomendacion =
          "Ictus isqu√©mico agudo en miocardiopat√≠a dilatada sin FA, sin trombo y sin FE muy deprimida: la miocardiopat√≠a no justifica anticoagulaci√≥n por s√≠ sola. Manejo como ictus criptog√©nico/ESUS.";
        fuerza = "NO_ANTICOAGULAR";
      } else {
        recomendacion = "Sin FA, sin trombo apical y sin FE muy deprimida, no se indica anticoagulaci√≥n sistem√°tica por la miocardiopat√≠a dilatada.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "isquemica":
      texto = "<b>üìå Miocardiopat√≠a isqu√©mica</b> ‚Äì Riesgo emb√≥lico si hay zonas acin√©ticas, trombos murales o ictus cardioemb√≥lico atribuible a una disfunci√≥n ventricular persistente.";

      const tieneTromboMural     = riesgos.includes("Trombo mural documentado");
      const tieneFEbaja          = riesgos.includes("FE ‚â§ 35%");
      const tieneAcinesia        = riesgos.includes("Zonas acin√©ticas o hipocin√©ticas");
      const ictusCardioPrevio    = riesgos.includes("Antecedente de ictus cardioemb√≥lico");

      if (tieneTromboMural) {
        recomendacion =
          "Trombo mural en miocardiopat√≠a isqu√©mica: anticoagulaci√≥n (AVK o ACOD) durante 3‚Äì6 meses, con reevaluaci√≥n por imagen hasta la resoluci√≥n del trombo. " +
          "Si el trombo desaparece y no hay FA ni otra fuente emb√≥lica persistente, no se mantiene anticoagulaci√≥n indefinida.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else if ((ictusCardioPrevio || (hasIctus && (tieneFEbaja || tieneAcinesia))) && (tieneFEbaja || tieneAcinesia)) {
        recomendacion =
          "Ictus cardioemb√≥lico en el contexto de miocardiopat√≠a isqu√©mica con disfunci√≥n ventricular relevante (FE ‚â§ 35% y/o zonas acin√©ticas). " +
          "Es razonable anticoagulaci√≥n (ACOD o AVK) indefinida como prevenci√≥n secundaria, si no hay contraindicaciones.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (ictusCardioPrevio && !tieneFEbaja && !tieneAcinesia) {
        recomendacion =
          "Antecedente de ictus cardioemb√≥lico sin disfunci√≥n sist√≥lica significativa ni zonas acin√©ticas demostradas. " +
          "La miocardiopat√≠a isqu√©mica sin alteraciones estructurales relevantes no se considera fuente cardioemb√≥lica cr√≥nica por s√≠ misma. " +
          "No se recomienda anticoagulaci√≥n indefinida; reevaluar la etiolog√≠a (p. ej., ESUS, FA oculta).";
        fuerza = "NO_ANTICOAGULAR";
      } else if (hasIctus && !tieneFEbaja && !tieneAcinesia && !tieneTromboMural) {
        recomendacion =
          "Ictus isqu√©mico agudo sin trombo mural ni disfunci√≥n ventricular relevante: la miocardiopat√≠a isqu√©mica estable no explica de forma clara el ictus. " +
          "Manejo como ictus criptog√©nico/ESUS y b√∫squeda dirigida de FA oculta u otras fuentes emb√≥licas.";
        fuerza = "NO_ANTICOAGULAR";
      } else {
        recomendacion =
          "Sin trombo mural, sin ictus cardioemb√≥lico atribuible a disfunci√≥n ventricular y sin FE muy reducida o zonas acin√©ticas extensas, " +
          "no se indica anticoagulaci√≥n sistem√°tica en la miocardiopat√≠a isqu√©mica. Manejo habitual con antiagregaci√≥n y tratamiento √≥ptimo de la cardiopat√≠a.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "restrictiva":
      texto = "<b>üìå Miocardiopat√≠a restrictiva / amiloidosis</b> ‚Äì FA y trombos auriculares frecuentes, con riesgo tromboemb√≥lico elevado incluso en ritmo sinusal.";
      if (hasIctus) {
        recomendacion =
          "Ictus isqu√©mico agudo en el contexto de miocardiopat√≠a restrictiva/amiloidosis: se recomienda anticoagulaci√≥n (ACOD o AVK) indefinida " +
          "independientemente del CHA‚ÇÇDS‚ÇÇ-VASc, salvo contraindicaci√≥n mayor.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (riesgos.includes("FA documentada") || riesgos.includes("Trombos auriculares")) {
        recomendacion = "Anticoagulaci√≥n (ACOD o AVK) indefinida independientemente del CHA‚ÇÇDS‚ÇÇ-VASc, por alto riesgo tromboemb√≥lico intr√≠nseco.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion = "Sin FA, sin trombos y sin ictus, no se indica anticoagulaci√≥n sistem√°tica, aunque debe mantenerse alta sospecha y seguimiento estrecho.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "tako":
      texto = "<b>üìå Miocardiopat√≠a de Tako-Tsubo</b> ‚Äì Riesgo emb√≥lico global bajo; aumenta si existe trombo ventricular, FE muy reducida o FA.";

      const tieneFATako = riesgos.includes("FA concomitante");
      const tieneTromboV = riesgos.includes("Trombo ventricular");
      const feBajaTako   = riesgos.includes("FE < 40%");

      if (tieneTromboV) {
        recomendacion = "Trombo ventricular en miocardiopat√≠a de Tako-Tsubo: anticoagulaci√≥n (AVK o ACOD) durante unos 3 meses o hasta la completa resoluci√≥n del trombo en los estudios de imagen.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      } else if (tieneFATako) {
        recomendacion = "FA concomitante en Tako-Tsubo: anticoagulaci√≥n indefinida (ACOD o AVK), independientemente del CHA‚ÇÇDS‚ÇÇ-VASc.";
        fuerza = "ACODS_PREFERIDOS";
      } else if (feBajaTako && hasIctus) {
        recomendacion =
          "Ictus isqu√©mico agudo en miocardiopat√≠a de Tako-Tsubo con FE < 40%: considerar anticoagulaci√≥n temporal (4‚Äì12 semanas), " +
          "con reevaluaci√≥n por ecocardiograf√≠a o RM card√≠aca, dado el posible origen cardioemb√≥lico.";
        fuerza = "CONSIDERAR_ACOD";
      } else if (feBajaTako && !hasIctus) {
        recomendacion =
          "FE < 40% sin ictus ni trombo en Tako-Tsubo: no se recomienda anticoagulaci√≥n sistem√°tica; valorar caso a caso seg√∫n extensi√≥n de la acinesia apical y otros factores de riesgo.";
        fuerza = "NO_ANTICOAGULAR";
      } else if (hasIctus && !feBajaTako) {
        recomendacion =
          "Ictus isqu√©mico agudo en Tako-Tsubo con FE preservada y sin trombo: el s√≠ndrome de Tako-Tsubo no se considera la causa demostrada del ictus; " +
          "manejo como ictus criptog√©nico/ESUS.";
        fuerza = "NO_ANTICOAGULAR";
      } else {
        recomendacion = "No se recomienda anticoagulaci√≥n por defecto en Tako-Tsubo sin trombo, sin FE muy reducida ni FA concomitante.";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "mixoma":
  texto = "<b>üìå Mixoma auricular</b> ‚Äì Tumor intracard√≠aco con alto riesgo emb√≥lico de origen tumoral. La resecci√≥n quir√∫rgica es el tratamiento definitivo.";

  const tieneTromboAur = riesgos.includes("Trombo en aur√≠cula");
  const tieneFAMixoma  = riesgos.includes("FA concomitante");
  const retrasoQx      = riesgos.includes("Retraso quir√∫rgico");
  const ictusMixoma    = riesgos.includes("Ictus isqu√©mico agudo"); // Ictus tumoral, NO cardioemb√≥lico por FA

  /* ============================================================
     1) TROMBO AURICULAR ‚Üí AC TRANSITORIA SIEMPRE
     (Es la √∫nica situaci√≥n donde la AC previene embolia)
     ============================================================ */
  if (tieneTromboAur) {
    // Si adem√°s hay FA: AC es obligada durante el trombo,
    // y luego depender√° del CHA2DS2-VASc real del paciente.
    if (tieneFAMixoma) {
      recomendacion =
        "Mixoma auricular con trombo y fibrilaci√≥n auricular: se recomienda anticoagulaci√≥n (ACOD o AVK) de forma transitoria hasta la resecci√≥n quir√∫rgica. " +
        "Tras ello, la necesidad de anticoagulaci√≥n indefinida depender√° del CHA‚ÇÇDS‚ÇÇ-VASc (sin sumar el ictus tumoral).";
      fuerza = "";
      break;
    }

    // Trombo SIN FA
    recomendacion =
      "Mixoma auricular con trombo asociado: se recomienda anticoagulaci√≥n (ACOD o AVK) de forma transitoria hasta la resecci√≥n quir√∫rgica. " +
      "El trombo es una fuente emb√≥lica prevenible mediante anticoagulaci√≥n.";
    fuerza = "";
    break;
  }

  /* ============================================================
     2) FA + ICTUS TUMORAL ‚Üí NO sumar 2 puntos al CHA2DS2-VASc
     ============================================================ */
  if (tieneFAMixoma && ictusMixoma) {
    recomendacion =
      "Fibrilaci√≥n auricular concomitante con ictus tumoral (por mixoma): el ictus NO debe contabilizarse como evento previo en el CHA‚ÇÇDS‚ÇÇ-VASc. " +
      "Anticoagulaci√≥n solo si el CHA‚ÇÇDS‚ÇÇ-VASc lo indica por los dem√°s factores del paciente. ";
    fuerza = "AC_SEGUN_CHA2DS2VASc";
    break;
  }

  /* ============================================================
     3) FA SIN ICTUS TUMORAL NI TROMBO ‚Üí CHA2DS2-VASc REAL
     ============================================================ */
  if (tieneFAMixoma) {
    recomendacion =
      "Fibrilaci√≥n auricular concomitante: anticoagulaci√≥n seg√∫n CHA‚ÇÇDS‚ÇÇ-VASc, sin considerar el ictus tumoral como evento previo. " +
      "El mixoma no altera la indicaci√≥n de anticoagulaci√≥n en FA.";
    fuerza = "AC_SEGUN_CHA2DS2VASc";
    break;
  }

  /* ============================================================
     4) ICTUS TUMORAL SIN FA NI TROMBO ‚Üí NO anticoagulaci√≥n
     ============================================================ */
  if (ictusMixoma) {
    recomendacion =
      "Ictus isqu√©mico en el contexto de mixoma auricular sin trombo ni FA: la embolia es de origen tumoral y la anticoagulaci√≥n no previene recurrencias. " +
      "La resecci√≥n quir√∫rgica urgente es el tratamiento definitivo.";
    fuerza = "NO_ANTICOAGULAR";
    break;
  }

  /* ============================================================
     5) RETRASO QUIR√öRGICO ‚Üí AC opcional (beneficio incierto)
     ============================================================ */
  if (retrasoQx) {
    recomendacion =
      "Retraso temporal en la cirug√≠a del mixoma: la anticoagulaci√≥n puede considerarse individualmente como estrategia puente, " +
      "aunque su eficacia para prevenir embolias de origen tumoral es limitada. Decisi√≥n caso por caso.";
    fuerza = "CONSIDERAR_ACOD";
    break;
  }

  /* ============================================================
     6) MIXOMA SIN FACTORES ‚Üí NO anticoagular
     ============================================================ */
  recomendacion =
    "Mixoma auricular sin ictus, sin trombo y sin FA: no se recomienda anticoagulaci√≥n. La resecci√≥n quir√∫rgica precoz es prioritaria.";
  fuerza = "NO_ANTICOAGULAR";
  break;




    case "valvular":
  texto = "<b>üìå Patolog√≠a valvular / Pr√≥tesis valvulares</b> ‚Äì Riesgo emb√≥lico variable seg√∫n tipo de v√°lvula, presencia de FA, trombo y eventos previos.";

  const hasFAv        = riesgos.includes("FA concomitante") || riesgos.includes("FA documentada") || riesgos.includes("FA Parox√≠stica/Cr√≥nica documentada");
  const hasTEPrevio   = riesgos.includes("Complicaciones tromboemb√≥licas previas");
  const hasTromboValv = riesgos.includes("Trombo valvular");

  const isMec√°nica    = riesgos.includes("V√°lvula mec√°nica");
  const isEM_MS       = riesgos.includes("Estenosis mitral moderada-severa");
  const isBioMitral   = riesgos.includes("Pr√≥tesis Biol√≥gica Mitral/Tric√∫spide");
  const isBioAortica  = riesgos.includes("Pr√≥tesis Biol√≥gica A√≥rtica (TAVI/Quir√∫rgica)");

if (hasFAv && (hasIctus || hasTEPrevio)) {
    recomendacion =
      "Fibrilaci√≥n auricular con ictus isqu√©mico agudo o evento cardioemb√≥lico previo: se recomienda anticoagulaci√≥n indefinida. " +
      "La indicaci√≥n no depende del CHA‚ÇÇDS‚ÇÇ-VASc, porque el riesgo emb√≥lico ya est√° demostrado.";
    fuerza = "ACODS_PREFERIDOS"; // o AVK si est√° en contexto valvular/EM-MS
    break;
}
  /* =========================================================
     1) V√ÅLVULA MEC√ÅNICA (CON O SIN TROMBO)
     ========================================================= */
  if (isMec√°nica) {
    if (hasTromboValv) {
      recomendacion =
        "Trombo en pr√≥tesis valvular mec√°nica: situaci√≥n de alto riesgo. Se recomienda anticoagulaci√≥n con AVK (ACOD contraindicados), " +
        "asociada a valoraci√≥n urgente para posible fibrin√≥lisis o cirug√≠a seg√∫n gradiente y situaci√≥n cl√≠nica. Mantener AVK de por vida.";
    } else {
      recomendacion =
        "V√°lvula mec√°nica: anticoagulaci√≥n de por vida con AVK (INR seg√∫n posici√≥n y tipo de pr√≥tesis). Los ACOD est√°n contraindicados.";
    }
    fuerza = "VKA_OBLIGATORIO";
    break;
  }

  /* =========================================================
     2) ESTENOSIS MITRAL MODERADA‚ÄìSEVERA (V√ÅLVULA NATIVA)
     ========================================================= */
  if (isEM_MS) {
    if (hasFAv || hasTEPrevio || hasIctus || hasTromboValv) {
      recomendacion =
        "Estenosis mitral moderada-severa con FA, trombo auricular/valvular o evento emb√≥lico (ictus/embolia sist√©mica) previo: " +
        "se recomienda anticoagulaci√≥n indefinida con AVK. Los ACOD est√°n contraindicados.";
      fuerza = "VKA_OBLIGATORIO";
    } else {
      recomendacion =
        "Estenosis mitral moderada-severa en ritmo sinusal, sin trombo ni eventos emb√≥licos previos: no se recomienda anticoagulaci√≥n sistem√°tica. " +
        "Seguimiento estrecho y tratamiento de la valvulopat√≠a seg√∫n gu√≠as.";
      fuerza = "ANTIAGREGACION_PREFERIDA";
    }
    break;
  }

  /* =========================================================
     3) PR√ìTESIS BIOL√ìGICA MITRAL / TRIC√öSPIDE
     ========================================================= */
  if (isBioMitral) {
    if (hasTromboValv) {
      if (hasFAv || hasTEPrevio || hasIctus) {
        recomendacion =
          "Trombo en pr√≥tesis biol√≥gica mitral/tric√∫spide con FA o evento tromboemb√≥lico previo: " +
          "anticoagulaci√≥n (AVK o ACOD) al menos 3‚Äì6 meses, con control de imagen hasta la resoluci√≥n del trombo, " +
          "y posteriormente mantenimiento de anticoagulaci√≥n indefinida por la FA/evento previo.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion =
          "Trombo en pr√≥tesis biol√≥gica mitral/tric√∫spide sin FA ni eventos previos: anticoagulaci√≥n (AVK o ACOD) durante 3‚Äì6 meses, " +
          "con control de imagen hasta la resoluci√≥n del trombo. Tras la resoluci√≥n, reevaluar necesidad de continuar o suspender la anticoagulaci√≥n.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      }
    } else {
      if (hasFAv || hasTEPrevio || hasIctus) {
        recomendacion =
          "Pr√≥tesis biol√≥gica mitral/tric√∫spide con FA o eventos tromboemb√≥licos previos: anticoagulaci√≥n indefinida (ACOD o AVK).";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion =
          "Pr√≥tesis biol√≥gica mitral/tric√∫spide sin FA ni eventos previos: anticoagulaci√≥n (preferentemente AVK, pudiendo valorar ACOD) " +
          "durante los primeros 3‚Äì6 meses tras el implante, especialmente en posici√≥n mitral, y posteriormente AAS en monoterapia si se mantiene el ritmo sinusal.";
        fuerza = "ANTIAGREGACION_PREFERIDA";
      }
    }
    break;
  }

  /* =========================================================
     4) PR√ìTESIS BIOL√ìGICA A√ìRTICA (TAVI / QUIR√öRGICA)
     ========================================================= */
  if (isBioAortica) {
    if (hasTromboValv) {
      if (hasFAv || hasTEPrevio || hasIctus) {
        recomendacion =
          "Trombo en pr√≥tesis biol√≥gica a√≥rtica con FA o evento tromboemb√≥lico previo: anticoagulaci√≥n (AVK o ACOD) al menos 3‚Äì6 meses " +
          "hasta resoluci√≥n del trombo, con posterior mantenimiento indefinido por la FA/evento.";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion =
          "Trombo en pr√≥tesis biol√≥gica a√≥rtica sin FA ni eventos previos: anticoagulaci√≥n (AVK o ACOD) 3‚Äì6 meses con control de imagen. " +
          "Tras la resoluci√≥n, puede suspenderse la anticoagulaci√≥n si no aparece FA u otra indicaci√≥n.";
        fuerza = "ANTICOAGULACION_TRANSITORIA";
      }
    } else {
      if (hasFAv || hasTEPrevio || hasIctus) {
        recomendacion =
          "Pr√≥tesis biol√≥gica a√≥rtica (TAVI/quir√∫rgica) con FA o eventos tromboemb√≥licos previos: anticoagulaci√≥n indefinida (ACOD o AVK).";
        fuerza = "ACODS_PREFERIDOS";
      } else {
        recomendacion =
          "Pr√≥tesis biol√≥gica a√≥rtica sin FA ni eventos previos: AAS en monoterapia como estrategia est√°ndar. " +
          "La doble antiagregaci√≥n solo est√° indicada si existe un stent coronario implantado recientemente, no por la pr√≥tesis a√≥rtica en s√≠.";
        fuerza = "ANTIAGREGACION_PREFERIDA";
      }
    }
    break;
  }

  /* =========================================================
     5) OTRA VALVULOPAT√çA NO MEC√ÅNICA, SIN PR√ìTESIS
     (insuficiencia mitral/a√≥rtica, EM ligera, etc.)
     ========================================================= */
  if (hasTromboValv) {
    if (hasFAv || hasTEPrevio || hasIctus) {
      recomendacion =
        "Trombo valvular en contexto de valvulopat√≠a no mec√°nica con FA o evento tromboemb√≥lico previo: " +
        "anticoagulaci√≥n (ACOD o AVK) al menos 3‚Äì6 meses hasta la resoluci√≥n del trombo, y posteriormente mantenimiento indefinido " +
        "por la FA o la embolia previa.";
      fuerza = "ACODS_PREFERIDOS";
    } else {
      recomendacion =
        "Trombo valvular en valvulopat√≠a no mec√°nica sin FA ni eventos previos: anticoagulaci√≥n (ACOD o AVK) 3‚Äì6 meses " +
        "con control de imagen hasta la resoluci√≥n. Tras la resoluci√≥n, la anticoagulaci√≥n puede suspenderse si no aparece FA u otra indicaci√≥n independiente.";
      fuerza = "ANTICOAGULACION_TRANSITORIA";
    }
  } else if (hasFAv) {
    recomendacion =
      "Valvulopat√≠a no mec√°nica con FA: anticoagulaci√≥n (ACOD o AVK) seg√∫n CHA‚ÇÇDS‚ÇÇ-VASc, como en cualquier FA no valvular significativa.";
    fuerza = "ACODS_PREFERIDOS";
  } else if (hasIctus) {
    recomendacion =
      "Ictus isqu√©mico agudo en paciente con valvulopat√≠a no mec√°nica, sin FA ni trombo valvular: no se recomienda anticoagulaci√≥n " +
      "por la valvulopat√≠a; manejo como ictus criptog√©nico/ESUS con b√∫squeda dirigida de FA oculta u otras fuentes emb√≥licas.";
    fuerza = "NO_ANTICOAGULAR";
  } else {
    recomendacion =
      "Valvulopat√≠a no mec√°nica sin FA, sin trombo valvular y sin eventos emb√≥licos previos: no se recomienda anticoagulaci√≥n sistem√°tica.";
    fuerza = "NO_ANTICOAGULAR";
  }
  break;



    case "endocarditis":
      texto = "<b>üìå Endocarditis infecciosa</b> ‚Äì Riesgo muy elevado de hemorragia intracraneal, incluso en ictus isqu√©micos.";
      const neuro = riesgos.includes("Complicaciones neurol√≥gicas");
      const micoticos = riesgos.includes("Aneurismas mic√≥ticos");

      if (hasIctus || neuro || micoticos) {
        recomendacion =
          "Ictus isqu√©mico o complicaciones neurol√≥gicas en el contexto de endocarditis: evitar anticoagulaci√≥n. " +
          "Suspender AVK/ACOD si estaban en uso salvo indicaci√≥n absolutamente imprescindible (p. ej., v√°lvula mec√°nica). " +
          "El riesgo de transformaci√≥n hemorr√°gica y de rotura de aneurismas mic√≥ticos es muy alto. Reevaluar tras 1‚Äì2 semanas y neuroimagen de control.";
        fuerza = "NO_ANTICOAGULAR";
      } else {
        recomendacion =
          "Durante la fase activa de la endocarditis infecciosa no se recomienda anticoagulaci√≥n, salvo indicaci√≥n esencial (p. ej., v√°lvula mec√°nica). " +
          "Decisi√≥n a individualizar en equipo multidisciplinar (cardiolog√≠a, neurolog√≠a, infecciosas, cirug√≠a card√≠aca).";
        fuerza = "NO_ANTICOAGULAR";
      }
      break;

    case "sicksinus":
  texto = "<b>üìå S√≠ndrome del seno enfermo</b> ‚Äì La FA puede ser parox√≠stica u oculta; la estratificaci√≥n de riesgo sigue el CHA‚ÇÇDS‚ÇÇ-VASc, salvo en pacientes con ictus previo, donde se asume FA subcl√≠nica como mecanismo probable.";

  const ictusPrevioSSE = riesgos.includes("Antecedente de ictus/embolia sist√©mica");
  const faSSE          = riesgos.includes("FA Parox√≠stica/Cr√≥nica documentada");
  const ictusAgudoSSE  = riesgos.includes("Ictus isqu√©mico agudo");

 
  if (ictusAgudoSSE && faSSE) {
    recomendacion =
      "S√≠ndrome del seno enfermo con ictus isqu√©mico agudo y FA documentada: se recomienda anticoagulaci√≥n indefinida (ACOD o AVK). ";
    fuerza = "ACODS_PREFERIDOS";
    break;
  }

  if (ictusPrevioSSE && faSSE) {
    recomendacion =
      "S√≠ndrome del seno enfermo con antecedente de ictus/embolia sist√©mica y FA documentada: se recomienda anticoagulaci√≥n indefinida (ACOD o AVK). ";
    fuerza = "ACODS_PREFERIDOS";
    break;
  }

 // 1) PRIORIDAD M√ÅXIMA: ANTECEDENTE DE ICTUS ‚Üí AC INDEFINIDA
  if (ictusPrevioSSE) {
    recomendacion =
      "S√≠ndrome del seno enfermo con antecedente de ictus/embolia sist√©mica: se recomienda anticoagulaci√≥n indefinida (ACOD o AVK), " +
      "al considerarse muy probable la existencia de FA oculta como origen del evento. ACOD preferidos salvo contraindicaci√≥n.";
    fuerza = "ACODS_PREFERIDOS";
    break;
  }

  // 2) FA DOCUMENTADA ‚Üí AC seg√∫n CHA2DS2-VASc
  if (faSSE) {
    recomendacion =
      "Fibrilaci√≥n auricular documentada: la anticoagulaci√≥n debe seguir el CHA‚ÇÇDS‚ÇÇ-VASc. ACOD preferidos salvo contraindicaci√≥n.";
    fuerza = "ACODS_PREFERIDOS";
    break;
  }

  // 3) ICTUS AGUDO ‚Üí Considerar AC por sospecha de FA oculta
  if (ictusAgudoSSE) {
    recomendacion =
      "Ictus isqu√©mico agudo sin FA documentada en un paciente con s√≠ndrome del seno enfermo: existe alta probabilidad de FA oculta. " +
      "Se recomienda anticoagulaci√≥n indefinida (ACOD o AVK), al considerarse muy probable la existencia de FA oculta como origen del evento. ACOD preferidos salvo contraindicaci√≥n.";
    fuerza = "ACODS_PREFERIDOS";
    break;
  }

  // 4) Sin FA ni ictus ‚Üí No anticoagular
  recomendacion =
    "S√≠ndrome del seno enfermo sin FA documentada ni ictus previo: no se recomienda anticoagulaci√≥n. " +
    "Monitorizaci√≥n peri√≥dica/prolongada por riesgo de FA silente.";
  fuerza = "NO_ANTICOAGULAR";
  break;


    case "auricula":
  texto = "<b>üìå Aur√≠cula izquierda / orejuela</b> ‚Äì El riesgo emb√≥lico depende sobre todo de la presencia de trombo, valvulopat√≠a mitral significativa o FA; el remodelado auricular severo contribuye al riesgo principalmente como marcador de FA subcl√≠nica.";

  const tieneTrombo     = riesgos.includes("Trombo en aur√≠cula izquierda / orejuela");
  const estenosisMitral = riesgos.includes("Estenosis mitral moderada-severa");
  const tieneFA         = riesgos.includes("FA concomitante");
  const dilatacionSevera= riesgos.includes("Dilataci√≥n auricular severa");
  const feviBaja        = riesgos.includes("FEVI < 35%");
  const ictusPrevioLA   = riesgos.includes("Evento cardioemb√≥lico previo");
  const ictusAgudoLA    = hasIctus;   // "Ictus isqu√©mico agudo" marcado

  // 1) ESTENOSIS MITRAL MODERADA-SEVERA
  if (estenosisMitral) {
    if (tieneFA || tieneTrombo || ictusPrevioLA || ictusAgudoLA) {
      // EM-MS + FA y/o trombo y/o ictus ‚Üí AVK indefinido
      recomendacion =
        "Estenosis mitral moderada-severa con FA, trombo auricular o evento emb√≥lico previo: " +
        "se recomienda anticoagulaci√≥n indefinida con AVK (ACOD contraindicados). " +
        "Si existe trombo, mantener AVK y realizar control por imagen hasta su resoluci√≥n.";
      fuerza = "VKA_OBLIGATORIO";
    } else {
      // EM-MS en ritmo sinusal, sin trombo ni eventos previos
      recomendacion =
        "Estenosis mitral moderada-severa en ritmo sinusal, sin trombo ni eventos emb√≥licos previos: " +
        "no se recomienda anticoagulaci√≥n sistem√°tica. Suele bastar antiagregaci√≥n y vigilancia cl√≠nica, " +
        "de acuerdo con las gu√≠as de valvulopat√≠a mitral.";
      fuerza = "ANTIAGREGACION_PREFERIDA";
    }
    break;
  }

if (tieneFA && (hasIctus || ictusPrevioLA)) {
    recomendacion =
      "Fibrilaci√≥n auricular con ictus isqu√©mico agudo o evento cardioemb√≥lico previo: se recomienda anticoagulaci√≥n indefinida. " +
      "La indicaci√≥n no depende del CHA‚ÇÇDS‚ÇÇ-VASc, porque el riesgo emb√≥lico ya est√° demostrado.";
    fuerza = "ACODS_PREFERIDOS"; // o AVK si est√° en contexto valvular/EM-MS
    break;
}

  // 2) TROMBO EN AUR√çCULA / OREJUELA (sin EM-MS)
  if (tieneTrombo && tieneFA) {
    // Trombo + FA
    recomendacion =
      "Trombo en aur√≠cula izquierda/orejuela en paciente con FA: anticoagulaci√≥n con AVK o ACOD al menos 3‚Äì6 meses, " +
      "con control por imagen hasta la completa resoluci√≥n del trombo. Tras la resoluci√≥n, mantener anticoagulaci√≥n indefinida " +
      "por la FA, seg√∫n CHA‚ÇÇDS‚ÇÇ-VASc y riesgo hemorr√°gico.";
    fuerza = "ACODS_PREFERIDOS";
    break;
  } else if (tieneTrombo) {
    // Trombo sin FA ni EM-MS
    recomendacion =
      "Trombo en aur√≠cula izquierda/orejuela sin estenosis mitral moderada-severa ni FA: " +
      "anticoagulaci√≥n 3‚Äì6 meses (ACOD o AVK) con control por imagen hasta su resoluci√≥n. " +
      "Tras la resoluci√≥n, si no existe FA, estenosis mitral moderada-severa ni otras indicaciones vasculares, puede suspenderse toda terapia antitromb√≥tica. La antiagregaci√≥n solo debe mantenerse o iniciarse si est√° indicada por otra patolog√≠a (p. ej., enfermedad ateroscler√≥tica), no por el trombo auricular. ";
    fuerza = "ANTICOAGULACION_TRANSITORIA";
    break;
  }

  // 3) FA CONCOMITANTE (sin EM-MS ni trombo)
  if (tieneFA) {
    recomendacion =
      "FA concomitante con remodelado auricular: anticoagulaci√≥n indefinida (ACOD o AVK) seg√∫n CHA‚ÇÇDS‚ÇÇ-VASc. " +
      "La FA implica estasis auricular y riesgo cardioemb√≥lico incluso sin trombo visible.";
    fuerza = "ACODS_PREFERIDOS";
    break;
  }

  // 4) AUR√çCULA MUY DILATADA + FEVI BAJA, CON ICTUS AGUDO
  if (dilatacionSevera && feviBaja && ictusAgudoLA) {
    recomendacion =
      "Ictus isqu√©mico agudo en el contexto de aur√≠cula muy dilatada y FEVI < 35%, sin FA ni trombo visibles: " +
      "puede considerarse anticoagulaci√≥n (ACOD o AVK) por alto riesgo emb√≥lico, especialmente si se sospecha FA subcl√≠nica. " +
      "Decisi√≥n individualizada seg√∫n riesgo hemorr√°gico y posibilidad de monitorizaci√≥n prolongada.";
    fuerza = "CONSIDERAR_ACOD";
    break;
  }

  // 5) AUR√çCULA MUY DILATADA + FEVI BAJA, SIN ICTUS
  if (dilatacionSevera && feviBaja && !ictusAgudoLA) {
    recomendacion =
      "Aur√≠cula muy dilatada con FEVI < 35% sin ictus ni trombo: la anticoagulaci√≥n no es sistem√°tica, " +
      "pero puede considerarse en presencia de otros factores de riesgo y sospecha de FA subcl√≠nica. " +
      "Es razonable monitorizaci√≥n prolongada para detectar FA oculta.";
    fuerza = "CONSIDERAR_ACOD";
    break;
  }

  // 6) ICTUS CARDIOEMB√ìLICO PREVIO ATRIBUIDO A LA AUR√çCULA (situaci√≥n actual estable)
  if (ictusPrevioLA) {
    recomendacion =
      "Ictus cardioemb√≥lico previo atribuido a la aur√≠cula izquierda, pero actualmente sin FA, trombo ni estenosis mitral moderada-severa: " +
      "no se indica autom√°ticamente anticoagulaci√≥n indefinida. Es necesario reevaluar la etiolog√≠a, optimizar la b√∫squeda de FA oculta " +
      "y decidir individualmente seg√∫n nuevos hallazgos.";
    fuerza = "NO_ANTICOAGULAR";
    break;
  }

  // 7) ICTUS AGUDO SIN HALLAZGOS ESTRUCTURALES RELEVANTES
  if (ictusAgudoLA) {
    recomendacion =
      "Ictus isqu√©mico agudo sin trombo, sin FA y sin estenosis mitral moderada-severa: " +
      "no se recomienda anticoagulaci√≥n por defecto en base a la aur√≠cula. Manejo como ictus criptog√©nico/ESUS, " +
      "con vigilancia estrecha y b√∫squeda de FA oculta.";
    fuerza = "NO_ANTICOAGULAR";
    break;
  }

  // 8) SITUACI√ìN BASAL SIN MARCADORES DE ALTO RIESGO
  recomendacion =
    "Sin trombo, sin FA y sin valvulopat√≠a mitral significativa, no se recomienda anticoagulaci√≥n sistem√°tica " +
    "por la aur√≠cula izquierda/orejuela. Mantener control cl√≠nico y ecocardiogr√°fico seg√∫n la cardiopat√≠a de base.";
  fuerza = "NO_ANTICOAGULAR";
  break;


    default:
      texto = "Seleccione una patolog√≠a.";
      recomendacion = "A la espera de selecci√≥n y factores de riesgo.";
      fuerza = "INSUFICIENTE";
  }

  // Coletillas seg√∫n fuerza
  let coletilla = "";

  switch (fuerza) {
    case "ACODS_PREFERIDOS":
      coletilla = " ACOD preferidos por mejor perfil eficacia/seguridad, salvo contraindicaciones espec√≠ficas.";
      break;
    case "ANTICOAGULACION_TRANSITORIA":
      coletilla = " Anticoagulaci√≥n temporal con reevaluaci√≥n por imagen y situaci√≥n cl√≠nica.";
      break;
    case "VKA_OBLIGATORIO":
      coletilla = " ACOD contraindicados: se recomienda solo AVK.";
      break;
    case "NO_ANTICOAGULAR":
      coletilla = " No se recomienda anticoagulaci√≥n sistem√°tica por esta cardiopat√≠a en el escenario descrito.";
      break;
    case "ANTIAGREGACION_PREFERIDA":
      coletilla = " Antiagregaci√≥n seg√∫n perfil cl√≠nico y gu√≠as de prevenci√≥n secundaria de ictus.";
      break;
    case "CONSIDERAR_ACOD":
      coletilla = " Decisi√≥n de anticoagulaci√≥n a individualizar, valorando riesgo emb√≥lico y hemorr√°gico.";
      break;
  }

  recomendacion += coletilla;

  const resumen = riesgos.length > 0 ? riesgos.join(", ") : "Ninguno";
  resultadoDiv.innerHTML = `${texto}<br><b>üìé Factores de riesgo presentes:</b> ${resumen}.<br><br><b>‚úÖ Recomendaci√≥n orientativa:</b> ${recomendacion}`;

  resultadoDiv.classList.remove("fade-in");
  void resultadoDiv.offsetWidth;
  resultadoDiv.classList.add("fade-in");

  return {fuerza, recomendacion};
}

function borrarFormulario() {
  document.getElementById("patologia").value = "";
  document.getElementById("patologia-factores").innerHTML = "";
  document.getElementById("patologia-resultado").innerHTML =
    "<h3>‚úÖ Recomendaci√≥n</h3><p>Seleccione un escenario cl√≠nico para mostrar la recomendaci√≥n orientativa de tratamiento.</p>";

  document.querySelector('.actions').style.display = "none";

  // üîµ Scroll al inicio suavemente
  window.scrollTo({
    top: 0,
    behavior: "smooth"
  });
}


function copiarResumen() {
  // Obtener el texto plano del panel
  const texto = document.getElementById("patologia-resultado").innerText.trim();
  if (!texto || texto.includes("Seleccione un escenario cl√≠nico")) {
    return; // Nada que copiar
  }

  // Copiar al portapapeles
  navigator.clipboard.writeText(texto)
    .then(() => {
      const btn = document.querySelector(".boton-copy");
      
      // Guardar texto original del bot√≥n
      const oldText = btn.textContent;

      // Cambiar apariencia temporal
      btn.classList.add("copiado");
      btn.textContent = "Copiado";

      // Volver al estado inicial tras 1,5 s
      setTimeout(() => {
        btn.classList.remove("copiado");
        btn.textContent = oldText;
      }, 1500);
    })
    .catch(() => {});
}

function toggleBiblio(){
  const contenido = document.getElementById("biblio-contenido");
  const arrow = document.getElementById("biblio-arrow");

  if(!contenido || !arrow) return;

  if(contenido.classList.contains("open")){
    contenido.classList.remove("open");
    contenido.style.maxHeight = "0px";
    arrow.style.transform = "rotate(0deg)";
  } else {
    contenido.classList.add("open");
    contenido.style.maxHeight = contenido.scrollHeight + "px";
    arrow.style.transform = "rotate(180deg)";
  }
}

document.querySelectorAll('.biblio-toggle').forEach(btn => {
  btn.addEventListener('click', () => {
    const content = btn.nextElementSibling;
    content.style.display = (content.style.display === "none") ? "block" : "none";
  });
});

/* ============================
   TOAST GLOBAL INSTITUCIONAL
=============================== */
function showToast(message, type = "info") {
  const toast = document.getElementById("toast");

  const icons = {
    info: "‚ÑπÔ∏è",
    ok: "‚úÖ",
    warn: "‚ö†Ô∏è",
    error: "‚ùå"
  };

  const colors = {
    info: "#fff",
    ok: "#166534",
    warn: "#b45309",
    error: "#b91c1c"
  };

  toast.style.background = colors[type] || colors.info;

  toast.innerHTML = `
    <span class="toast-icon">${icons[type] || icons.info}</span>
    <span>${message}</span>
  `;

  toast.classList.add("show");

  clearTimeout(toast.hideTimer);
  toast.hideTimer = setTimeout(() => {
    toast.classList.remove("show");
  }, 3000);
}
</script>
  </body>
</html>
