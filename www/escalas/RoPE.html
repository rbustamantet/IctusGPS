<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="../site.webmanifest">
<link rel="icon" type="image/png" sizes="192x192" href="../iconos/ictusgps.png">
<link rel="apple-touch-icon" sizes="180x180" href="../iconos/ictusgps.png">
<link rel="shortcut icon" href="../iconos/ictusgps.png">
<meta name="theme-color" content="#0f3d83">
<title>Escala RoPE — Risk of Paradoxical Embolism</title>

<style>
:root{
  --bg:#f8fafc; --ink:#0f172a; --borde:#e5e7eb;
  --accent:#2563eb; 
  --bg:#f9fafc;
  --ink:#0e1a33;
  --accent-dark:#0f3d83;
  --accent-light:#2563eb;
  --border:#e5e9f2;
  --muted:#64748b;
  --ok:#166534; --ok-bg:#e9fce7; --ok-ring:#bbf7d0;
  --mid:#92400e; --mid-bg:#fff7ed; --mid-ring:#fed7aa;
  --bad:#991b1b; --bad-bg:#fef2f2; --bad-ring:#fecaca;
  --azul-institucional:#0f3d83;
}

*{box-sizing:border-box}


/* =========================================================
   SAFE-TOP
========================================================= */
.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top, 0px) + 60px);
  background: var(--azul-institucional);
  z-index: 1001;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: env(safe-area-inset-top, 0px);
}
.safe-content {
  width: 100%;
  max-width: 1080px;
  padding: 6px 16px 8px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start; 
  /* Añadir un padding-top para empujar los iconos ligeramente hacia abajo y no pegarlos al borde */
  padding-top: 5px; /* Ajuste manual para bajar los iconos un poco */
  padding-bottom: 0; /* Eliminar padding inferior para reservar ese espacio */
}
.safe-left {
  display: flex;
  align-items: center;
  gap: 10px;
}
.safe-mini {
  width: 44px;
  height: 44px;
  object-fit: contain;
  padding: 4px;
  box-shadow: 0 0 4px rgba(0,0,0,0.1);
}
.safe-logo {
  height: 44px;
  width: auto;
}
.hover-icon {
  height: 28px;
  width: auto;
  transition: transform 0.3s, filter 0.3s;
}
.hover-icon:hover {
  transform: scale(1.15);
  filter: brightness(1.2) saturate(0.8);
}

.safe-actions {
  display: flex;
  gap: 10px;
}
.safe-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: rgba(255,255,255,0.15);
  border: 1px solid white;
  border-radius: 50%;
  transition: background .25s, border-color .25s, transform .1s;
}
.safe-btn:hover {
  background: #01c5fe;
  border: 1px solid white;
}
.safe-btn:active { transform: scale(0.95); }
.safe-icon {
  width: 32px;
  height: 32px;
  object-fit: contain;
}
/* =========================================================
   CABECERA INFERIOR (STICKY)
========================================================= */
header {
  position: sticky;
  top: calc(env(safe-area-inset-top, 0px) + 52px);
  z-index: 1002;
  backdrop-filter: blur(6px);
  background: var(--accent-dark);
  border-bottom: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  color: #fff;
}
.bar {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  height: 52px;
  padding: 0 16px;
}
.title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #fff;
}
/* =========================================================
   CABECERA
========================================================= */
/* ... (reglas existentes) ... */
.bar {
  display:flex;
  justify-content:center;
  align-items:center;
  gap: 10px;
  height:52px;
  padding:4px 16px;
}

.title {
  display: flex; /* <-- NUEVO: Habilita flexbox para alinear el icono */
  align-items: center; /* <-- NUEVO: Centra el icono y el texto verticalmente */
  /* ... (otras reglas de title) ... */
}
.title img {
  width: 32px; /* Define el tamaño del icono */
  height: 32px;
  margin-right: 8px; /* Espacio entre el icono y el texto "ABCD²" */
}
.pill{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:38px; height:25px; padding:6px 10px;
  border-radius:999px; font-size:13px; font-weight:700;
  border:1px solid transparent; background:#dbeafe; color:#1e3a8a;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.pill-init {background:#dbeafe; color:#1e3a8a; border-color:#bfdbfe;}
.pill-ok   {background:#dcfce7; color:#065f46; border-color:#86efac;}
.pill-warn {background:#fef3c7; color:#92400e; border-color:#fde68a;}
.pill-bad  {background:#fee2e2; color:#991b1b; border-color:#fecaca;}

/* =========================================================
   PADDING SUPERIOR DEL CONTENIDO
========================================================= */

/* Empuja el contenido real por debajo de la barra superior */
body {
  margin: 0;
  padding-top: calc(env(safe-area-inset-top, 0px) + 52px);
  background-color: #fff;
}

/* INTRO */
.howto{
  background:#fff;
  border:1px solid var(--borde);
  border-radius:14px;
  box-shadow:0 2px 2px var(--muted);
  padding:.5rem;
  margin:.5rem 0 1rem;
  font-size:14px;
}
/* ===== CUERPO ===== */
body{margin:0;background:var(--bg);color:var(--ink);font-family:Verdana, Geneva, sans-serif;}
.wrap{max-width:980px;margin:16px auto 48px;padding:2px 16px;}
.panel{background:#fff;border:1px solid var(--borde);border-radius:16px;padding:16px;box-shadow:0 2px 10px rgba(15,23,42,.06);}
label{font-weight:900;color:#0b1f44;margin-top:2px;display:block;}
select{width:100%;padding:8px 12px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;font-size:14px;}
select:focus{outline:none;box-shadow:0 0 0 1px #dbeafe;}
.note{color:#64748b;font-size:12px;margin-top:8px;}
.grid{display:grid;gap:20px;}
@media(min-width:720px){.grid{grid-template-columns:1fr 1fr;}}

/* ===== CHECKS ===== */
.check{display:flex;align-items:center;gap:8px;margin:6px 0;color:#0b1f44;font-weight:300;}
.check input{transform:scale(1.1);}

/* ===== RESULTADOS ===== */
.kpi{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;}
.box{border:1.5px dashed #c7dbff;border-radius:14px;padding:14px;background:#f8fbff;text-align:center;}
.ttl{font-size:14px;color:#334155;font-weight:800;margin-bottom:2px;}
.val{font-size:24px;font-weight:900;color:#0b2c5f;}
.mini{font-size:12px;color:#64748b;margin-top:4px;}
.ok{background:var(--ok-bg);border-color:var(--ok-ring);} 
.warn{background:var(--mid-bg);border-color:var(--mid-ring);} 
.bad{background:var(--bad-bg);border-color:var(--bad-ring);} 
.ok .val{color:var(--ok);} .warn .val{color:var(--mid);} .bad .val{color:var(--bad);}

/* ===== BOTONES ===== */
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px;}
.btn-action{
  flex:1 1 48%;
  border:none;border-radius:10px;padding:12px;
  font-size:15px;font-weight:700;cursor:pointer;
  transition:background .2s;
}
.btn-clear {background:#fff; color:#0b2c5f; border:1px solid #2563eb;}
.btn-clear:hover {background:#eff6ff;}
.btn-copy {background:#fff; color:#0f3d83; border:1px solid #2563eb;}
.btn-copy:hover {background:#eff6ff;}
.btn-copy.copiado{background:#0f3d83!important;color:#fff!important;}

/* ===== RESUMEN ===== */
#resumenText{
  white-space:pre-wrap;font-size:13px;color:#0f172a;margin-top:12px;
  border:1px dashed var(--borde);border-radius:10px;padding:10px 12px;
  background:#f8fafc;line-height:1.45;
}

/* ===== DETALLES ===== */
details summary{
  cursor:pointer;font-weight:700;color:#0b2c5f;
  margin-top:14px;
}
details[open] summary{color:#2563eb;}
details ul{margin-top:6px;font-size:13px;color:#334155;line-height:1.4;}

/* Pie */
footer{
  width:100%;
  margin:2rem 0 0;
  padding:1.5rem 0;
  border-top:1px solid #e5e7eb;
  background:#ffffff;
  text-align:center;
  box-shadow:0 -2px 6px rgba(0,0,0,0.04);
}
footer img{max-width:320px;height:auto;opacity:.95}
}

</style>
</head>
<body>
  
<!-- SAFE-TOP -->
<div class="safe-top">
  <div class="safe-content">
    <div class="safe-left">
      <img src="../iconos/escalasico.png" alt="Icono Escalas" class="safe-mini">
      <img src="../img/topbar.png" alt="IctusGPS" class="safe-logo">
    </div>
    <div class="safe-actions">
      <a href="javascript:history.back()" class="safe-btn" title="Volver atrás">
        <img src="../iconos/atrastransparente.png" alt="Atrás" class="safe-icon">
      </a>
      <a href="../index.html" class="safe-btn" title="Volver al inicio">
        <img src="../iconos/hometransparente.png" alt="Inicio" class="safe-icon">
      </a>
    </div>
  </div>
</div>

<header>
  <div class="bar">
    <div class="title"><img src="../iconos/rope.png" alt="RoPE">RoPE</div>
      <output id="pill" class="pill pill-init" aria-live="polite" aria-atomic="true">—</output>
  </div>
</header>


</header>

<main class="wrap">
<div class="howto">La escala <b>RoPE (Risk of Paradoxical Embolism)</b> es una herramienta clínica utilizada para estimar la <b>probabilidad de que un ictus isquémico sea causado por un Foramen Oval Permeable (FOP)</b>. La escala asigna puntos basándose en la edad del paciente y la ausencia de factores de riesgo vascular convencionales, proporcionando una puntuación final (0–10) que ayuda a determinar si el FOP es la causa probable del ictus (embolia paradójica) y orienta la decisión sobre el cierre percutáneo.</div>

  <section class="panel">
    <!-- Entradas -->
    <div class="grid">
      <div>
        <label for="age">Edad</label>
        <select id="age">
  <option value="">Selecciona…</option>
  <option value="5">18–29 años</option>
  <option value="4">30–39 años</option>
  <option value="3">40–49 años</option>
  <option value="2">50–59 años</option>
  <option value="1">60–69 años</option>
  <option value="0">≥70 años</option>
</select>
      </div>

      <div>
        <label>Factores clínicos y neuroimagen</label>
        <label class="check"><input type="checkbox" id="noHTN" value="1"> No hipertensión (+1)</label>
        <label class="check"><input type="checkbox" id="noDM" value="1"> No diabetes (+1)</label>
        <label class="check"><input type="checkbox" id="noSmoke" value="1"> No tabaquismo activo (+1)</label>
        <label class="check"><input type="checkbox" id="noPrior" value="1"> No ictus/AIT previo (+1)</label>
        <label class="check"><input type="checkbox" id="cortical" value="1"> Infarto cortical en neuroimagen (+1)</label>
      </div>
    </div>

    <!-- Resultados -->
    <div class="panel" id="resultCard" style="margin-top:16px; display:none;">
      <div class="kpi">
        <div class="box"><div class="ttl">RoPE</div><div class="val" id="scoreVal">-</div></div>
        <div class="box" id="probBox"><div class="ttl">Probabilidad FOP causal</div><div class="val" id="probVal">-</div></div>
      </div>

      <div class="kpi">
        <div class="box" id="classBox"><div class="ttl">Clasificación</div><div class="val" id="classVal">-</div></div>
        <div class="box"><div class="ttl">Interpretación</div><div class="val" id="interpVal" style="font-size:16px">-</div></div>
      </div>

      <div class="actions">
        <button id="btnClear" class="btn-action btn-clear">Borrar</button>
        <button id="btnCopy" class="btn-action btn-copy">Copiar resumen</button>
      </div>
      <div id="resumenText"></div>
    </div>

    <details>
      <summary>Abreviaturas y referencia</summary>
      <ul>
        <li><b>RoPE:</b> Risk of Paradoxical Embolism.</li>
        <li><b>FOP:</b> Foramen Oval Permeable.</li>
        <li><b>AIT:</b> Ataque Isquémico Transitorio.</li>
        <li><b>Referencia:</b> Kent DM et al. <em>Neurology</em>. 2013;81(7):619–625.</li>
      </ul>
    </details>
  </section>

</main>

<script>
const PROB={0:'28%',1:'30%',2:'35%',3:'44%',4:'55%',5:'61%',6:'67%',7:'78%',8:'84%',9:'88%',10:'90%'};

function toneFor(score){
  if(score>=7) return 'bad';
  if(score>=4) return 'warn';
  return 'ok';
}
function labelFor(score){
  if(score>=7) return 'Alta';
  if(score>=4) return 'Intermedia';
  return 'Baja';
}
function interpFor(score){
  if(score>=7)  return 'Probabilidad alta: valorar cierre percutáneo del FOP (perfil típico: joven, sin FR y cortical).';
  if(score>=4)  return 'Probabilidad intermedia: discutir en sesión multidisciplinar beneficio-riesgo.';
  return 'Probabilidad baja: suele preferirse manejo médico (antiagregación) salvo otros hallazgos.';
}
const ids = ['age','noHTN','noDM','noSmoke','noPrior','cortical'];
const $ = id => document.getElementById(id);

function calc(){
  const age = $('age').value;
  if(age===''){
    $('resultCard').style.display='none';
    const pill=$('pill');
    pill.className='pill pill-init';
    pill.textContent='RoPE: —';
    return;
  }
  let s = parseInt(age,10);
  ['noHTN','noDM','noSmoke','noPrior','cortical'].forEach(id=>{
    if($(id).checked) s += parseInt($(id).value,10);
  });
  s = Math.max(0, Math.min(10, s));

  const prob = PROB[s] || '—';
  const cat  = labelFor(s);
  const tone = toneFor(s);

  $('scoreVal').textContent = s;
  $('probVal').textContent  = prob;
  $('classVal').textContent = cat;
  $('interpVal').innerHTML = `<span style="font-size:13px; display: flex; align-items: center; justify-content: center; gap: 10px; text-align: center;">
  Consulte en Utilidades
  <a href="../Utilidades/fop.html">
    <img src="../iconos/fopico.png" class="hover-icon">
  </a>
</span>`;


  ['probBox','classBox'].forEach(id=>{
    const el=$(id); el.classList.remove('ok','warn','bad'); el.classList.add(tone);
  });

  $('resultCard').style.display='block';

  const pill=$('pill');
  pill.className='pill pill-'+tone;
  pill.textContent = `RoPE: ${s} — ${prob} (${cat})`;

  mostrarResumen(s, prob, cat);
}

function mostrarResumen(s, prob, cat){
  let t = 'Escala RoPE (Risk of Paradoxical Embolism)\n';
  t += '===========================\n';
  t += `Puntuación: ${s}/10\nProbabilidad FOP causal: ${prob} (${cat})\n\nDetalle de variables:\n`;

  const ageText = $('age').options[$('age').selectedIndex].textContent;
  t += `- Edad: ${ageText}\n`;
  [
    ['noHTN','No hipertensión (+1)'],
    ['noDM','No diabetes (+1)'],
    ['noSmoke','No tabaquismo activo (+1)'],
    ['noPrior','No ictus/AIT previo (+1)'],
    ['cortical','Infarto cortical (+1)']
  ].forEach(([id,label])=>{
    t += `- ${label}: ${$(id).checked ? 'Sí' : 'No'}\n`;
  });
  $('resumenText').textContent = t;
}

function borrar(){
  $('age').value='';
  ['noHTN','noDM','noSmoke','noPrior','cortical'].forEach(id=>$(id).checked=false);
  $('resultCard').style.display='none';
  const pill=$('pill'); pill.className='pill pill-init'; pill.textContent='RoPE: —';
  $('resumenText').textContent='';
}

function copiar(){
  const t = $('resumenText').textContent.trim();
  if(!t) return;
  navigator.clipboard.writeText(t).then(()=>{
    const b=$('btnCopy');
    b.classList.add('copiado'); b.textContent='Copiado';
    setTimeout(()=>{b.classList.remove('copiado'); b.textContent='Copiar resumen';}, 1500);
  });
}

ids.forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener(el.type==='select-one'?'change':'input', calc);
});
document.getElementById('btnClear')?.addEventListener('click', borrar);
document.getElementById('btnCopy')?.addEventListener('click', copiar);
</script>

<footer>
  <img src="../img/uibanner.png" alt="Ictus GPS">
</footer>
<script src="js/index.js"></script>
</body>
</html>
